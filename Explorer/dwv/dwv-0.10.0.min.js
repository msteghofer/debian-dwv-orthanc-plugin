/*! dwv 0.10.0 26-05-2015 */
var dwv=dwv||{},Kinetic=Kinetic||{};dwv.App=function(){function a(a){q.reset(),w=a.length;var b=new dwv.io.File;b.onload=function(a){var b=!0;if(r&&(D.append(a.view),b=!1),p(a),N){var c=new Kinetic.Layer({listening:!1,hitGraphEnabled:!1,visible:b});M.push(c),N.add(c)}},b.onerror=function(a){n(a)},b.load(a)}function b(a){var b=new dwv.io.File;b.onload=function(a){var b=new dwv.State(q);b.fromJSON(a,d)},b.onerror=function(a){n(a)},b.load(a)}function c(a){var b=new dwv.io.Url;b.onload=function(a){var b=new dwv.State(q);b.fromJSON(a,d)},b.onerror=function(a){n(a)},b.load(a)}function d(a){if("undefined"!=typeof T[a.type])for(var b=0;b<T[a.type].length;++b)T[a.type][b](a)}function e(){D.generateImageData(t),L.setImageData(t),L.draw()}function f(){if(L&&(L.zoom(A,A,B.x,B.y),L.draw()),N){var a={x:A,y:A},b=N.scale(),c=N.offset(),d=B.x/b.x+c.x-B.x/a.x,e=B.y/b.y+c.y-B.y/a.y,f={x:d,y:e};N.offset(f),N.scale(a),N.draw()}}function g(){if(L&&(L.translate(C.x,C.y),L.draw()),N&&L){var a=-L.getOrigin().x/A-C.x,b=-L.getOrigin().y/A-C.y;N.offset({x:a,y:b}),N.draw()}}function h(){D.addEventListener("wlchange",G.update),D.addEventListener("wlchange",I.update),D.addEventListener("wlchange",F.update),D.addEventListener("colourchange",I.update),D.addEventListener("positionchange",H.update),J=!0}function i(){D.removeEventListener("wlchange",G.update),D.removeEventListener("wlchange",I.update),D.removeEventListener("wlchange",F.update),D.removeEventListener("colourchange",I.update),D.removeEventListener("positionchange",H.update),J=!1}function j(a){var b=!1,c=null,d=null;if("touchstart"===a.type||"touchmove"===a.type?(a.preventDefault(),c=dwv.html.getEventOffset(a),a._xs=c[0].x,a._ys=c[0].y,d=q.getImageLayer().displayToIndex(c[0]),a._x=parseInt(d.x,10),a._y=parseInt(d.y,10),2===c.length&&(a._x1s=c[1].x,a._y1s=c[1].y,d=q.getImageLayer().displayToIndex(c[1]),a._x1=parseInt(d.x,10),a._y1=parseInt(d.y,10)),b=!0):"mousemove"===a.type||"mousedown"===a.type||"mouseup"===a.type||"mouseout"===a.type||"mousewheel"===a.type||"dblclick"===a.type||"DOMMouseScroll"===a.type?(c=dwv.html.getEventOffset(a),a._xs=c[0].x,a._ys=c[0].y,d=q.getImageLayer().displayToIndex(c[0]),a._x=parseInt(d.x,10),a._y=parseInt(d.y,10),b=!0):("keydown"===a.type||"touchend"===a.type)&&(b=!0),b){var e=q.getToolbox().getSelectedTool()[a.type];e&&e(a)}}function k(a){a.stopPropagation(),a.preventDefault();var b=x+"-dropBox",c=document.getElementById(b);c&&(c.className="dropBox hover")}function l(a){a.stopPropagation(),a.preventDefault();var b=x+"-dropBox",c=document.getElementById(b);c&&(c.className="dropBox")}function m(a){a.stopPropagation(),a.preventDefault(),q.loadFiles(a.dataTransfer.files)}function n(a){a.name&&a.message?alert(a.name+": "+a.message+"."):alert("Error: "+a+"."),a.stack&&console.error(a.stack)}function o(a,b){L=new dwv.html.Layer(x+"-imageLayer"),L.initialise(a,b),L.fillContext(),L.setStyleDisplay(!0);var c=x+"-drawDiv";null!==document.getElementById(c)&&(N=new Kinetic.Stage({container:c,width:a,height:b,listening:!1}),N.getContent().setAttribute("style","")),z?q.fitToSize(dwv.gui.getWindowSize()):q.fitToSize({width:$("#"+x).width(),height:$("#"+x).height()}),q.resetLayout()}function p(a){if(!D){D=a.view,E=new dwv.ViewController(D),K&&K.initialise(a.info),s=D.getImage(),r=s;var b=r.getGeometry().getSize();u=b.getNumberOfColumns(),v=b.getNumberOfRows(),o(u,v),t=L.getContext().createImageData(u,v),D.addEventListener("wlchange",q.onWLChange),D.addEventListener("colourchange",q.onColourChange),D.addEventListener("slicechange",q.onSliceChange),E.updatePresets(r,!0),P&&(q.addLayerListeners(L.getCanvas()),window.addEventListener("keydown",j,!0),P.init(),P.display(!0));var c=x+"-dropBox",d=document.getElementById(c);if(d){d.removeEventListener("dragover",k),d.removeEventListener("dragleave",l),d.removeEventListener("drop",m),dwv.html.removeNode(c);var e=document.getElementById(x);e.addEventListener("dragover",k),e.addEventListener("dragleave",l),e.addEventListener("drop",m)}var f=x+"-infoLayer";document.getElementById(f)&&(G=new dwv.info.Windowing(q),G.create(),H=new dwv.info.Position(q),H.create(),I=new dwv.info.MiniColourMap(q),I.create(),F=new dwv.info.Plot(q),F.create(),h()),q.initWLDisplay()}}var q=this,r=null,s=null,t=null,u=0,v=0,w=0,x=null,y=1,z=!1,A=1,B={x:0,y:0},C={x:0,y:0},D=null,E=null,F=null,G=null,H=null,I=null,J=!1,K=null,L=null,M=[],N=null,O=new dwv.html.Style,P=null,Q=null,R=null,S=null,T={};this.getVersion=function(){return"v0.10.0"},this.getImage=function(){return r},this.setImage=function(a){r=a,D.setImage(a)},this.restoreOriginalImage=function(){r=s,D.setImage(s)},this.getImageData=function(){return t},this.getNSlicesToLoad=function(){return w},this.getContainerDivId=function(){return x},this.getScale=function(){return A/y},this.getScaleCenter=function(){return B},this.getTranslation=function(){return C},this.getViewController=function(){return E},this.getImageLayer=function(){return L},this.getDrawLayer=function(a){return"undefined"==typeof a?M[D.getCurrentPosition().k]:M[a]},this.getDrawStage=function(){return N},this.getStyle=function(){return O},this.getToolbox=function(){return P},this.getToolboxController=function(){return Q},this.getUndoStack=function(){return S},this.getLoaders=function(){return{file:dwv.io.File,url:dwv.io.Url}},this.init=function(a){if(x=a.containerDivId,a.tools&&0!==a.tools.length){for(var b={},e=0;e<a.tools.length;++e)switch(a.tools[e]){case"Window/Level":b["Window/Level"]=new dwv.tool.WindowLevel(this);break;case"Zoom/Pan":b["Zoom/Pan"]=new dwv.tool.ZoomAndPan(this);break;case"Scroll":b.Scroll=new dwv.tool.Scroll(this);break;case"Draw":if(0!==a.shapes){for(var f={},g=0;g<a.shapes.length;++g)switch(a.shapes[g]){case"Line":f.Line=dwv.tool.LineFactory;break;case"Protractor":f.Protractor=dwv.tool.ProtractorFactory;break;case"Rectangle":f.Rectangle=dwv.tool.RectangleFactory;break;case"Roi":f.Roi=dwv.tool.RoiFactory;break;case"Ellipse":f.Ellipse=dwv.tool.EllipseFactory}b.Draw=new dwv.tool.Draw(this,f),b.Draw.addEventListener("draw-create",d),b.Draw.addEventListener("draw-change",d),b.Draw.addEventListener("draw-move",d),b.Draw.addEventListener("draw-delete",d)}break;case"Livewire":b.Livewire=new dwv.tool.Livewire(this);break;case"Filter":if(0!==a.filters.length){for(var h={},i=0;i<a.filters.length;++i)switch(a.filters[i]){case"Threshold":h.Threshold=new dwv.tool.filter.Threshold(this);break;case"Sharpen":h.Sharpen=new dwv.tool.filter.Sharpen(this);break;case"Sobel":h.Sobel=new dwv.tool.filter.Sobel(this)}b.Filter=new dwv.tool.Filter(h,this)}break;default:throw new Error("Unknown tool: '"+a.tools[e]+"'")}P=new dwv.tool.Toolbox(b,this),Q=new dwv.ToolboxController(P)}if(a.gui){if(-1!==a.gui.indexOf("tool")&&P&&P.setup(),-1!==a.gui.indexOf("load")){var j=new dwv.gui.FileLoad(this),n=new dwv.gui.UrlLoad(this);R=new dwv.gui.Loadbox(this,{file:j,url:n}),R.setup(),j.setup(),n.setup(),j.display(!0),n.display(!1)}if(-1!==a.gui.indexOf("undo")&&(S=new dwv.tool.UndoStack,S.setup()),-1!==a.gui.indexOf("tags")&&(K=new dwv.gui.DicomTags),-1!==a.gui.indexOf("version")&&dwv.gui.appendVersionHtml(this.getVersion()),-1!==a.gui.indexOf("help")){var o=!0;a.isMobile&&(o=a.isMobile),dwv.gui.appendHelpHtml(P.getToolList(),o)}}var p=x+"-dropBox",q=document.getElementById(p);if(q){q.addEventListener("dragover",k),q.addEventListener("dragleave",l),q.addEventListener("drop",m);var r=dwv.gui.getWindowSize(),s=2*r.height/3;$("#"+p).height(s),$("#"+p).width(s)}if("undefined"==typeof a.skipLoadUrl){var t=dwv.html.getUriParam(window.location.href);if(t&&"undefined"!=typeof t.input)if(t.type&&"manifest"===t.type)dwv.html.decodeManifestUri(t.input,t.nslices,this.onInputURLs);else{var u=dwv.html.decodeKeyValueUri(t.input,t.dwvReplaceMode);if(this.loadURL(u),"undefined"!=typeof t.state){var v=function(){c([t.state])};this.addEventListener("onloadend",v)}}}else console.log("Not loading url from address since skipLoadUrl is defined.");a.fitToWindow&&(z=!0,window.onresize=this.onResize)},this.reset=function(){P&&P.reset(),N&&(M=[]),r=null,D=null,w=0,S&&(S=new dwv.tool.UndoStack,S.initialise())},this.resetLayout=function(){A=y,B={x:0,y:0},C={x:0,y:0},L&&(L.resetLayout(y),L.draw()),N&&(N.offset({x:0,y:0}),N.scale({x:y,y:y}),N.draw())},this.addEventListener=function(a,b){"undefined"==typeof T[a]&&(T[a]=[]),T[a].push(b)},this.removeEventListener=function(a,b){if("undefined"!=typeof T[a])for(var c=0;c<T[a].length;++c)T[a][c]===b&&T[a].splice(c,1)},this.loadFiles=function(c){var d=c[0].name.split(".").pop().toLowerCase();"json"===d?b(c):a(c)},this.loadURL=function(a){this.reset(),w=a.length;var b=new dwv.io.Url;b.onload=function(a){var b=!0;if(r&&(D.append(a.view),b=!1),p(a),N){var c=new Kinetic.Layer({listening:!1,hitGraphEnabled:!1,visible:b});M.push(c),N.add(c)}},b.onerror=function(a){n(a)},b.onloadend=function(){d({type:"onloadend"})},b.load(a)},this.fitToSize=function(a){var b=parseInt(y*u,10);y=Math.min(a.width/u,a.height/v);var c=parseInt(y*u,10),d=parseInt(y*v,10),e=c/b;A*=e,O.setScale(y);var f="#"+x;if($(f).width(c),$(f).height(d),L&&(L.setWidth(c),L.setHeight(d),L.zoom(A,A,0,0),L.draw()),N){var g="#"+x+"-drawDiv";$(g).width(c),$(g).height(d),N.setWidth(c),N.setHeight(d),N.scale({x:A,y:A}),N.draw()}},this.toggleInfoLayerDisplay=function(){var a=x+"-infoLayer";dwv.html.toggleDisplay(a),J?i():h()},this.initWLDisplay=function(){var a=E.getPresets(),b=Object.keys(a);E.setWindowLevel(a[b[0]].center,a[b[0]].width),E.setCurrentPosition2D(0,0)},this.addLayerListeners=function(a){a.setAttribute("style","pointer-events: auto;"),a.addEventListener("mousedown",j),a.addEventListener("mousemove",j),a.addEventListener("mouseup",j),a.addEventListener("mouseout",j),a.addEventListener("mousewheel",j),a.addEventListener("DOMMouseScroll",j),a.addEventListener("dblclick",j),a.addEventListener("touchstart",j),a.addEventListener("touchmove",j),a.addEventListener("touchend",j)},this.removeLayerListeners=function(a){a.setAttribute("style","pointer-events: none;"),a.removeEventListener("mousedown",j),a.removeEventListener("mousemove",j),a.removeEventListener("mouseup",j),a.removeEventListener("mouseout",j),a.removeEventListener("mousewheel",j),a.removeEventListener("DOMMouseScroll",j),a.removeEventListener("dblclick",j),a.removeEventListener("touchstart",j),a.removeEventListener("touchmove",j),a.removeEventListener("touchend",j)},this.render=function(){e()},this.zoom=function(a,b,c){A=a*y,.1>=A&&(A=.1),B={x:b,y:c},f()},this.stepZoom=function(a,b,c){A+=a,.1>=A&&(A=.1),B={x:b,y:c},f()},this.translate=function(a,b){C={x:a,y:b},g()},this.stepTranslate=function(a,b){var c=C.x+a/A,d=C.y+b/A;C={x:c,y:d},g()},this.onWLChange=function(){e()},this.onColourChange=function(){e()},this.onSliceChange=function(){if(e(),N){for(var a=0;a<M.length;++a)M[a].visible(!1);var b=M[D.getCurrentPosition().k];b.visible(!0),b.draw()}},this.onKeydown=function(a){90===a.keyCode&&a.ctrlKey?S.undo():89===a.keyCode&&a.ctrlKey&&S.redo()},this.onResize=function(){q.fitToSize(dwv.gui.getWindowSize())},this.onZoomReset=function(){q.resetLayout()},this.onChangeLoader=function(){R.displayLoader(this.value)},this.onChangeURL=function(a){q.loadURL([a.target.value])},this.onInputURLs=function(a){q.loadURL(a)},this.onChangeFiles=function(a){var b=a.target.files;0!==b.length&&q.loadFiles(b)},this.onStateSave=function(){var a=new dwv.State(q),b=document.getElementById("download-state");b.href="data:application/json,"+a.toJSON()},this.onChangeColourMap=function(){E.setColourMapFromName(this.value)},this.onChangeWindowLevelPreset=function(){var a=this.value,b=E.getPresets()[a];if(!b)throw new Error("Unknown window level preset: '"+a+"'");E.setWindowLevel(b.center,b.width)},this.onChangeTool=function(){Q.setSelectedTool(this.value)},this.onChangeShape=function(){Q.setSelectedShape(this.value)},this.onChangeFilter=function(){Q.setSelectedFilter(this.value)},this.onRunFilter=function(){Q.runSelectedFilter()},this.onChangeLineColour=function(){Q.setLineColour(this.value)},this.onChangeMinMax=function(a){Q.setRange(a)},this.onUndo=function(){S.undo()},this.onRedo=function(){S.redo()},this.onToggleInfoLayer=function(){q.toggleInfoLayerDisplay()},this.onDisplayReset=function(){q.resetLayout(),q.initWLDisplay();var a=document.getElementById("presetSelect");a.selectedIndex=0,dwv.gui.refreshSelect("#presetSelect")}};var dwv=dwv||{},Kinetic=Kinetic||{};dwv.State=function(a){this.toJSON=function(){for(var b=a.getImage().getGeometry().getSize().getNumberOfSlices(),c=[],d=0;b>d;++d){for(var e=a.getDrawLayer(d).getChildren(),f=0;f<e.length;++f)for(var g=e[f].find(".anchor"),h=0;h<g.length;++h)g[h].remove();c.push(e)}return JSON.stringify({"window-center":a.getViewController().getWindowLevel().center,"window-width":a.getViewController().getWindowLevel().width,position:a.getViewController().getCurrentPosition(),scale:a.getScale(),scaleCenter:a.getScaleCenter(),translation:a.getTranslation(),drawings:c})},this.fromJSON=function(b,c){var d=JSON.parse(b);a.getViewController().setWindowLevel(d["window-center"],d["window-width"]),a.getViewController().setCurrentPosition(d.position),a.zoom(d.scale,d.scaleCenter.x,d.scaleCenter.y),a.translate(d.translation.x,d.translation.y);for(var e=a.getImage().getGeometry().getSize().getNumberOfSlices(),f=function(a){return"shape"===a.name()},g=0;e>g;++g)for(var h=0;h<d.drawings[g].length;++h){var i=Kinetic.Node.create(d.drawings[g][h]),j=i.getChildren(f)[0],k=new dwv.tool.DrawGroupCommand(i,j.className,a.getDrawLayer(g));"undefined"!=typeof c&&(k.onExecute=c,k.onUndo=c),k.execute(),a.getUndoStack().add(k)}}};var dwv=dwv||{};dwv.ToolboxController=function(a){this.setSelectedTool=function(b){a.setSelectedTool(b)},this.setSelectedShape=function(b){a.getSelectedTool().setShapeName(b)},this.setSelectedFilter=function(b){a.getSelectedTool().setSelectedFilter(b)},this.runSelectedFilter=function(){a.getSelectedTool().getSelectedFilter().run()},this.setLineColour=function(b){a.getSelectedTool().setLineColour(b)},this.setRange=function(b){a&&a.getSelectedTool()&&a.getSelectedTool().getSelectedFilter()&&a.getSelectedTool().getSelectedFilter().run(b)}};var dwv=dwv||{};dwv.ViewController=function(a){var b=null;this.getPresets=function(){return b},this.getCurrentPosition=function(){return a.getCurrentPosition()},this.setCurrentPosition=function(b){return a.setCurrentPosition(b)},this.setCurrentPosition2D=function(b,c){return a.setCurrentPosition({i:b,j:c,k:a.getCurrentPosition().k})},this.incrementSliceNb=function(){return a.setCurrentPosition({i:a.getCurrentPosition().i,j:a.getCurrentPosition().j,k:a.getCurrentPosition().k+1})},this.decrementSliceNb=function(){return a.setCurrentPosition({i:a.getCurrentPosition().i,j:a.getCurrentPosition().j,k:a.getCurrentPosition().k-1})},this.goFirstSlice=function(){return a.setCurrentPosition({i:a.getCurrentPosition().i,j:a.getCurrentPosition().j,k:0})},this.getWindowLevel=function(){return{width:a.getWindowLut().getWidth(),center:a.getWindowLut().getCenter()}},this.setWindowLevel=function(b,c){a.setWindowLevel(b,c)},this.updatePresets=function(c){var d=null;b&&(d=b.manual),b={};var e=a.getWindowPresets();if(e)for(var f=0;f<e.length;++f)b[e[f].name.toLowerCase()]=e[f];var g=c.getRescaledDataRange(),h=g.max-g.min,i=g.min+h/2;if(b["min/max"]={center:i,width:h},"undefined"!=typeof dwv.tool.defaultpresets){var j=c.getMeta().Modality;for(var k in dwv.tool.defaultpresets[j])b[k]=dwv.tool.defaultpresets[j][k]}d&&(b.manual=d)},this.getColourMap=function(){return a.getColourMap()},this.setColourMap=function(b){a.setColourMap(b)},this.setColourMapFromName=function(a){if(!dwv.tool.colourMaps[a])throw new Error("Unknown colour map: '"+a+"'");this.setColourMap(dwv.tool.colourMaps[a])}};var dwv=dwv||{};dwv.dicom=dwv.dicom||{};var JpxImage=JpxImage||{};dwv.dicom.DataReader=function(a,b){"undefined"==typeof b&&(b=!0);var c=new Int8Array(new Int16Array([1]).buffer)[0]>0,d=b!==c,e=new DataView(a);this.flipArrayEndianness=function(a){for(var b,c=new Uint8Array(a.buffer,a.byteOffset,a.byteLength),d=0;d<a.byteLength;d+=a.BYTES_PER_ELEMENT)for(var e=d+a.BYTES_PER_ELEMENT-1,f=d;e>f;e--,f++)b=c[f],c[f]=c[e],c[e]=b;return a},this.readUint8=function(a){return e.getUint8(a,b)},this.readUint16=function(a){return e.getUint16(a,b)},this.readUint32=function(a){return e.getUint32(a,b)},this.readFloat32=function(a){return e.getFloat32(a,b)},this.readUint8Array=function(b,c){var e=new Uint8Array(a,b,c);return d&&this.flipArrayEndianness(e),e},this.readUint16Array=function(b,c){var e=new Uint16Array(a,b,c/2);return d&&this.flipArrayEndianness(e),e},this.readUint32Array=function(b,c){var e=c/4,f=null;if(b%4===0)f=new Uint32Array(a,b,e),d&&this.flipArrayEndianness(f);else{f=new Uint32Array(e);for(var g=0;e>g;++g)f[g]=this.readUint32(b+4*g)}return f},this.readHex=function(a){var b=this.readUint16(a).toString(16);return"0x0000".substr(0,6-b.length)+b.toUpperCase()},this.readString=function(a,b){for(var c="",d=this.readUint8Array(a,b),e=0;b>e;++e)c+=String.fromCharCode(d[e]);return c}},dwv.dicom.isJpegTransferSyntax=function(a){return null!==a.match(/1.2.840.10008.1.2.4.5/)||null!==a.match(/1.2.840.10008.1.2.4.6/)||null!==a.match(/1.2.840.10008.1.2.4.7/)},dwv.dicom.isJpeglsTransferSyntax=function(a){return null!==a.match(/1.2.840.10008.1.2.4.8/)},dwv.dicom.isJpeg2000TransferSyntax=function(a){return null!==a.match(/1.2.840.10008.1.2.4.9/)},dwv.dicom.DicomParser=function(){this.dicomElements={},this.pixelBuffer=[];var a=0;this.getNextUnknownCount=function(){return a++,a}},dwv.dicom.DicomParser.prototype.getDicomElements=function(){return this.dicomElements},dwv.dicom.DicomParser.prototype.getPixelBuffer=function(){return this.pixelBuffer},dwv.dicom.DicomParser.prototype.appendDicomElement=function(a,b){if("undefined"==typeof b||0===b.length)this.dicomElements[a.name]={group:a.group,element:a.element,vr:a.vr,vl:a.vl,value:a.value};else{if("Item"===a.name||"ItemDelimitationItem"===a.name||"SequenceDelimitationItem"===a.name)return;for(var c=b[0].name,d=b[0].itemNumber,e=this.dicomElements,f=1;f<b.length;++f)"undefined"!=typeof e[c].value[d]&&(e=e[c].value[d]),c=b[f].name,d=b[f].itemNumber;this.appendElementToSequence(e,c,d,a)}},dwv.dicom.DicomParser.prototype.appendElementToSequence=function(a,b,c,d){"undefined"==typeof a[b]?a[b]={group:d.group,element:d.element,vr:d.vr,vl:d.vl,value:[]}:("undefined"==typeof a[b].value[c]&&(a[b].value[c]={}),a[b].value[c][d.name]={group:d.group,element:d.element,vr:d.vr,vl:d.vl,value:d.value})},dwv.dicom.DicomParser.prototype.readTag=function(a,b){var c=a.readHex(b),d=a.readHex(b+2),e="UN",f=null,g=dwv.dicom.dictionary;return"undefined"!=typeof g[c]&&"undefined"!=typeof g[c][d]?(e=g[c][d][0],f=g[c][d][2]):f="dwv::unknown"+this.getNextUnknownCount().toString(),{group:c,element:d,name:f,vr:e}},dwv.dicom.DicomParser.prototype.readDataElement=function(a,b,c){var d=this.readTag(a,b),e=4,f="",g=0,h=0,i=0,j=!1;"0xFFFE"===d.group?(f="N/A",h=0,g=a.readUint32(b+e),i=4):c?(f=d.vr,j="O"===f[0],h=0,g=a.readUint32(b+e+h),i=4):(f=a.readString(b+e,2),j="O"===f[0],h=2,j||"SQ"===f||"UN"===f?(g=a.readUint32(b+e+h+2),i=6):(g=a.readUint16(b+e+h),i=2));var k="US"===f||"UL"===f,l=g;4294967295===g&&(l="u/l",g=0);var m=null,n=b+e+h+i;"N/A"===f?m=a.readUint8Array(n,g):k?m="US"===f?a.readUint16Array(n,g):a.readUint32Array(n,g):j?("OX"===f&&console.warn("OX value representation for tag: "+d.name+"."),m="OB"===f||"undefined"!=typeof this.dicomElements.BitsAllocated&&8===this.dicomElements.BitsAllocated.value[0]?a.readUint8Array(n,g):a.readUint16Array(n,g)):(m=a.readString(n,g),m=m.split("\\"));var o=e+h+i+g;return{tag:d,vr:f,vl:l,data:m,offset:o}},dwv.dicom.DicomParser.prototype.parse=function(a){var b=0,c=!1,d=!1,e=!1,f=new dwv.dicom.DataReader(a),g=new dwv.dicom.DataReader(a);b=128;var h=f.readString(b,4);if("DICM"!==h)throw new Error("Not a valid DICOM file (no magic DICM word found)");b+=4;var i=this.readDataElement(f,b),j=parseInt(i.data[0],10);b+=i.offset;for(var k=b,l=k+j,m=k;l>m;)i=this.readDataElement(f,m,!1),this.appendDicomElement({name:i.tag.name,group:i.tag.group,vr:i.vr,vl:i.vl,element:i.tag.element,value:i.data}),m+=i.offset;var n=dwv.utils.cleanString(this.dicomElements.TransferSyntaxUID.value[0]);if("1.2.840.10008.1.2"===n)c=!0;else{if("1.2.840.10008.1.2.1.99"===n)throw new Error("Unsupported DICOM transfer syntax (Deflated Explicit VR): "+n);if("1.2.840.10008.1.2.2"===n)g=new dwv.dicom.DataReader(a,!1);else{if(dwv.dicom.isJpegTransferSyntax(n))throw d=!0,new Error("Unsupported DICOM transfer syntax (JPEG): "+n);if(dwv.dicom.isJpeglsTransferSyntax(n))throw new Error("Unsupported DICOM transfer syntax (JPEG-LS): "+n);if(dwv.dicom.isJpeg2000TransferSyntax(n))console.log("JPEG 2000 compressed DICOM data: "+n),e=!0;else{if("1.2.840.10008.1.2.4.100"===n)throw new Error("Unsupported DICOM transfer syntax (MPEG2): "+n);if("1.2.840.10008.1.2.5"===n)throw new Error("Unsupported DICOM transfer syntax (RLE): "+n)}}}for(var o=!1,p="",q=0,r=[];m<a.byteLength;){i=this.readDataElement(g,m,c),p=i.tag.name,q=i.offset;var s="u/l"===i.vl?0:i.vl;if("SQ"===i.vr&&0!==i.vl&&(r.push({name:p,itemNumber:-1,vl:i.vl,vlCount:0}),q-=s),0!==r.length&&"Item"===p?(r[r.length-1].itemNumber+=1,o||(q-=s)):"SequenceDelimitationItem"===p&&(r=r.slice(0,-1)),o)if("Item"===p){if(4===i.data.length)console.log("Skipping Basic Offset Table.");else if(0!==i.data.length){console.log("Concatenating multiple pixel data items, length: "+i.data.length);var t=i.data.length+this.pixelBuffer.length,u=new Uint16Array(t);u.set(this.pixelBuffer,0),u.set(i.data,this.pixelBuffer.length),this.pixelBuffer=u}}else{if("SequenceDelimitationItem"!==p)throw new Error("Unexpected tag in encapsulated pixel data: "+i.tag.name);o=!1}if("PixelData"===p&&(0!==i.data.length?this.pixelBuffer=i.data:o=!0),this.appendDicomElement({name:p,group:i.tag.group,vr:i.vr,vl:i.vl,element:i.tag.element,value:i.data},r),"SQ"!==i.vr&&0!==r.length){var v=r.length-1;r[v].vlCount+=q,r[v].vlCount===r[v].vl&&(r=r.slice(0,-1))}m+=q}if(d);else if(e){var w=new JpxImage;w.parse(this.pixelBuffer),this.pixelBuffer=w.tiles[0].items}};var dwv=dwv||{};dwv.dicom=dwv.dicom||{},dwv.dicom.dictionary={"0x0000":{"0x0000":["UL","1","GroupLength"],"0x0001":["UL","1","CommandLengthToEnd"],"0x0002":["UI","1","AffectedSOPClassUID"],"0x0003":["UI","1","RequestedSOPClassUID"],"0x0010":["CS","1","CommandRecognitionCode"],"0x0100":["US","1","CommandField"],"0x0110":["US","1","MessageID"],"0x0120":["US","1","MessageIDBeingRespondedTo"],"0x0200":["AE","1","Initiator"],"0x0300":["AE","1","Receiver"],"0x0400":["AE","1","FindLocation"],"0x0600":["AE","1","MoveDestination"],"0x0700":["US","1","Priority"],"0x0800":["US","1","DataSetType"],"0x0850":["US","1","NumberOfMatches"],"0x0860":["US","1","ResponseSequenceNumber"],"0x0900":["US","1","Status"],"0x0901":["AT","1-n","OffendingElement"],"0x0902":["LO","1","ErrorComment"],"0x0903":["US","1","ErrorID"],"0x0904":["OT","1-n","ErrorInformation"],"0x1000":["UI","1","AffectedSOPInstanceUID"],"0x1001":["UI","1","RequestedSOPInstanceUID"],"0x1002":["US","1","EventTypeID"],"0x1003":["OT","1-n","EventInformation"],"0x1005":["AT","1-n","AttributeIdentifierList"],"0x1007":["AT","1-n","ModificationList"],"0x1008":["US","1","ActionTypeID"],"0x1009":["OT","1-n","ActionInformation"],"0x1013":["UI","1-n","SuccessfulSOPInstanceUIDList"],"0x1014":["UI","1-n","FailedSOPInstanceUIDList"],"0x1015":["UI","1-n","WarningSOPInstanceUIDList"],"0x1020":["US","1","NumberOfRemainingSuboperations"],"0x1021":["US","1","NumberOfCompletedSuboperations"],"0x1022":["US","1","NumberOfFailedSuboperations"],"0x1023":["US","1","NumberOfWarningSuboperations"],"0x1030":["AE","1","MoveOriginatorApplicationEntityTitle"],"0x1031":["US","1","MoveOriginatorMessageID"],"0x4000":["AT","1","DialogReceiver"],"0x4010":["AT","1","TerminalType"],"0x5010":["SH","1","MessageSetID"],"0x5020":["SH","1","EndMessageSet"],"0x5110":["AT","1","DisplayFormat"],"0x5120":["AT","1","PagePositionID"],"0x5130":["CS","1","TextFormatID"],"0x5140":["CS","1","NormalReverse"],"0x5150":["CS","1","AddGrayScale"],"0x5160":["CS","1","Borders"],"0x5170":["IS","1","Copies"],"0x5180":["CS","1","OldMagnificationType"],"0x5190":["CS","1","Erase"],"0x51A0":["CS","1","Print"],"0x51B0":["US","1-n","Overlays"]},"0x0002":{"0x0000":["UL","1","FileMetaInformationGroupLength"],"0x0001":["OB","1","FileMetaInformationVersion"],"0x0002":["UI","1","MediaStorageSOPClassUID"],"0x0003":["UI","1","MediaStorageSOPInstanceUID"],"0x0010":["UI","1","TransferSyntaxUID"],"0x0012":["UI","1","ImplementationClassUID"],"0x0013":["SH","1","ImplementationVersionName"],"0x0016":["AE","1","SourceApplicationEntityTitle"],"0x0100":["UI","1","PrivateInformationCreatorUID"],"0x0102":["OB","1","PrivateInformation"]},"0x0004":{"0x0000":["UL","1","FileSetGroupLength"],"0x1130":["CS","1","FileSetID"],"0x1141":["CS","8","FileSetDescriptorFileID"],"0x1142":["CS","1","FileSetCharacterSet"],"0x1200":["UL","1","RootDirectoryFirstRecord"],"0x1202":["UL","1","RootDirectoryLastRecord"],"0x1212":["US","1","FileSetConsistencyFlag"],"0x1220":["SQ","1","DirectoryRecordSequence"],"0x1400":["UL","1","NextDirectoryRecordOffset"],"0x1410":["US","1","RecordInUseFlag"],"0x1420":["UL","1","LowerLevelDirectoryOffset"],"0x1430":["CS","1","DirectoryRecordType"],"0x1432":["UI","1","PrivateRecordUID"],"0x1500":["CS","8","ReferencedFileID"],"0x1504":["UL","1","DirectoryRecordOffset"],"0x1510":["UI","1","ReferencedSOPClassUIDInFile"],"0x1511":["UI","1","ReferencedSOPInstanceUIDInFile"],"0x1512":["UI","1","ReferencedTransferSyntaxUIDInFile"],"0x1600":["UL","1","NumberOfReferences"]},"0x0008":{"0x0000":["UL","1","IdentifyingGroupLength"],"0x0001":["UL","1","LengthToEnd"],"0x0005":["CS","1","SpecificCharacterSet"],"0x0008":["CS","1-n","ImageType"],"0x000A":["US","1","SequenceItemNumber"],"0x0010":["CS","1","RecognitionCode"],"0x0012":["DA","1","InstanceCreationDate"],"0x0013":["TM","1","InstanceCreationTime"],"0x0014":["UI","1","InstanceCreatorUID"],"0x0016":["UI","1","SOPClassUID"],"0x0018":["UI","1","SOPInstanceUID"],"0x0020":["DA","1","StudyDate"],"0x0021":["DA","1","SeriesDate"],"0x0022":["DA","1","AcquisitionDate"],"0x0023":["DA","1","ImageDate"],"0x0024":["DA","1","OverlayDate"],"0x0025":["DA","1","CurveDate"],"0x002A":["DT","1","AcquisitionDatetime"],"0x0030":["TM","1","StudyTime"],"0x0031":["TM","1","SeriesTime"],"0x0032":["TM","1","AcquisitionTime"],"0x0033":["TM","1","ImageTime"],"0x0034":["TM","1","OverlayTime"],"0x0035":["TM","1","CurveTime"],"0x0040":["US","1","OldDataSetType"],"0x0041":["LT","1","OldDataSetSubtype"],"0x0042":["CS","1","NuclearMedicineSeriesType"],"0x0050":["SH","1","AccessionNumber"],"0x0052":["CS","1","QueryRetrieveLevel"],"0x0054":["AE","1-n","RetrieveAETitle"],"0x0058":["UI","1-n","DataSetFailedSOPInstanceUIDList"],"0x0060":["CS","1","Modality"],"0x0061":["CS","1-n","ModalitiesInStudy"],"0x0064":["CS","1","ConversionType"],"0x0068":["CS","1","PresentationIntentType"],"0x0070":["LO","1","Manufacturer"],"0x0080":["LO","1","InstitutionName"],"0x0081":["ST","1","InstitutionAddress"],"0x0082":["SQ","1","InstitutionCodeSequence"],"0x0090":["PN","1","ReferringPhysicianName"],"0x0092":["ST","1","ReferringPhysicianAddress"],"0x0094":["SH","1-n","ReferringPhysicianTelephoneNumber"],"0x0100":["SH","1","CodeValue"],"0x0102":["SH","1","CodingSchemeDesignator"],"0x0103":["SH","1","CodingSchemeVersion"],"0x0104":["LO","1","CodeMeaning"],"0x0105":["CS","1","MappingResource"],"0x0106":["DT","1","ContextGroupVersion"],"0x0107":["DT","1","ContextGroupLocalVersion"],"0x010B":["CS","1","CodeSetExtensionFlag"],"0x010C":["UI","1","PrivateCodingSchemeCreatorUID"],"0x010D":["UI","1","CodeSetExtensionCreatorUID"],"0x010F":["CS","1","ContextIdentifier"],"0x0201":["SH","1","TimezoneOffsetFromUTC"],"0x1000":["AE","1","NetworkID"],"0x1010":["SH","1","StationName"],"0x1030":["LO","1","StudyDescription"],"0x1032":["SQ","1","ProcedureCodeSequence"],"0x103E":["LO","1","SeriesDescription"],"0x1040":["LO","1","InstitutionalDepartmentName"],"0x1048":["PN","1-n","PhysicianOfRecord"],"0x1050":["PN","1-n","PerformingPhysicianName"],"0x1060":["PN","1-n","PhysicianReadingStudy"],"0x1070":["PN","1-n","OperatorName"],"0x1080":["LO","1-n","AdmittingDiagnosisDescription"],"0x1084":["SQ","1","AdmittingDiagnosisCodeSequence"],"0x1090":["LO","1","ManufacturerModelName"],"0x1100":["SQ","1","ReferencedResultsSequence"],"0x1110":["SQ","1","ReferencedStudySequence"],"0x1111":["SQ","1","ReferencedStudyComponentSequence"],"0x1115":["SQ","1","ReferencedSeriesSequence"],"0x1120":["SQ","1","ReferencedPatientSequence"],"0x1125":["SQ","1","ReferencedVisitSequence"],"0x1130":["SQ","1","ReferencedOverlaySequence"],"0x1140":["SQ","1","ReferencedImageSequence"],"0x1145":["SQ","1","ReferencedCurveSequence"],"0x114A":["SQ","1","ReferencedInstanceSequence"],"0x114B":["LO","1","ReferenceDescription"],"0x1150":["UI","1","ReferencedSOPClassUID"],"0x1155":["UI","1","ReferencedSOPInstanceUID"],"0x115A":["UI","1-n","SOPClassesSupported"],"0x1160":["IS","1","ReferencedFrameNumber"],"0x1195":["UI","1","TransactionUID"],"0x1197":["US","1","FailureReason"],"0x1198":["SQ","1","FailedSOPSequence"],"0x1199":["SQ","1","ReferencedSOPSequence"],"0x2110":["CS","1","LossyImageCompression"],"0x2111":["ST","1","DerivationDescription"],"0x2112":["SQ","1","SourceImageSequence"],"0x2120":["SH","1","StageName"],"0x2122":["IS","1","StageNumber"],"0x2124":["IS","1","NumberOfStages"],"0x2128":["IS","1","ViewNumber"],"0x2129":["IS","1","NumberOfEventTimers"],"0x212A":["IS","1","NumberOfViewsInStage"],"0x2130":["DS","1-n","EventElapsedTime"],"0x2132":["LO","1-n","EventTimerName"],"0x2142":["IS","1","StartTrim"],"0x2143":["IS","1","StopTrim"],"0x2144":["IS","1","RecommendedDisplayFrameRate"],"0x2200":["CS","1","TransducerPosition"],"0x2204":["CS","1","TransducerOrientation"],"0x2208":["CS","1","AnatomicStructure"],"0x2218":["SQ","1","AnatomicRegionSequence"],"0x2220":["SQ","1","AnatomicRegionModifierSequence"],"0x2228":["SQ","1","PrimaryAnatomicStructureSequence"],"0x2229":["SQ","1","AnatomicStructureSpaceOrRegionSequence"],"0x2230":["SQ","1","PrimaryAnatomicStructureModifierSequence"],"0x2240":["SQ","1","TransducerPositionSequence"],"0x2242":["SQ","1","TransducerPositionModifierSequence"],"0x2244":["SQ","1","TransducerOrientationSequence"],"0x2246":["SQ","1","TransducerOrientationModifierSequence"],"0x4000":["LT","1-n","IdentifyingComments"]},"0x0010":{"0x0000":["UL","1","PatientGroupLength"],"0x0010":["PN","1","PatientName"],"0x0020":["LO","1","PatientID"],"0x0021":["LO","1","IssuerOfPatientID"],"0x0030":["DA","1","PatientBirthDate"],"0x0032":["TM","1","PatientBirthTime"],"0x0040":["CS","1","PatientSex"],"0x0050":["SQ","1","PatientInsurancePlanCodeSequence"],"0x1000":["LO","1-n","OtherPatientID"],"0x1001":["PN","1-n","OtherPatientName"],"0x1005":["PN","1","PatientBirthName"],"0x1010":["AS","1","PatientAge"],"0x1020":["DS","1","PatientSize"],"0x1030":["DS","1","PatientWeight"],"0x1040":["LO","1","PatientAddress"],"0x1050":["LT","1-n","InsurancePlanIdentification"],"0x1060":["PN","1","PatientMotherBirthName"],"0x1080":["LO","1","MilitaryRank"],"0x1081":["LO","1","BranchOfService"],"0x1090":["LO","1","MedicalRecordLocator"],"0x2000":["LO","1-n","MedicalAlerts"],"0x2110":["LO","1-n","ContrastAllergies"],"0x2150":["LO","1","CountryOfResidence"],"0x2152":["LO","1","RegionOfResidence"],"0x2154":["SH","1-n","PatientTelephoneNumber"],"0x2160":["SH","1","EthnicGroup"],"0x2180":["SH","1","Occupation"],"0x21A0":["CS","1","SmokingStatus"],"0x21B0":["LT","1","AdditionalPatientHistory"],"0x21C0":["US","1","PregnancyStatus"],"0x21D0":["DA","1","LastMenstrualDate"],"0x21F0":["LO","1","PatientReligiousPreference"],"0x4000":["LT","1","PatientComments"]},"0x0018":{"0x0000":["UL","1","AcquisitionGroupLength"],"0x0010":["LO","1","ContrastBolusAgent"],"0x0012":["SQ","1","ContrastBolusAgentSequence"],"0x0014":["SQ","1","ContrastBolusAdministrationRouteSequence"],"0x0015":["CS","1","BodyPartExamined"],"0x0020":["CS","1-n","ScanningSequence"],"0x0021":["CS","1-n","SequenceVariant"],"0x0022":["CS","1-n","ScanOptions"],
"0x0023":["CS","1","MRAcquisitionType"],"0x0024":["SH","1","SequenceName"],"0x0025":["CS","1","AngioFlag"],"0x0026":["SQ","1","InterventionDrugInformationSequence"],"0x0027":["TM","1","InterventionDrugStopTime"],"0x0028":["DS","1","InterventionDrugDose"],"0x0029":["SQ","1","InterventionalDrugSequence"],"0x002A":["SQ","1","AdditionalDrugSequence"],"0x0030":["LO","1-n","Radionuclide"],"0x0031":["LO","1-n","Radiopharmaceutical"],"0x0032":["DS","1","EnergyWindowCenterline"],"0x0033":["DS","1-n","EnergyWindowTotalWidth"],"0x0034":["LO","1","InterventionalDrugName"],"0x0035":["TM","1","InterventionalDrugStartTime"],"0x0036":["SQ","1","InterventionalTherapySequence"],"0x0037":["CS","1","TherapyType"],"0x0038":["CS","1","InterventionalStatus"],"0x0039":["CS","1","TherapyDescription"],"0x0040":["IS","1","CineRate"],"0x0050":["DS","1","SliceThickness"],"0x0060":["DS","1","KVP"],"0x0070":["IS","1","CountsAccumulated"],"0x0071":["CS","1","AcquisitionTerminationCondition"],"0x0072":["DS","1","EffectiveSeriesDuration"],"0x0073":["CS","1","AcquisitionStartCondition"],"0x0074":["IS","1","AcquisitionStartConditionData"],"0x0075":["IS","1","AcquisitionTerminationConditionData"],"0x0080":["DS","1","RepetitionTime"],"0x0081":["DS","1","EchoTime"],"0x0082":["DS","1","InversionTime"],"0x0083":["DS","1","NumberOfAverages"],"0x0084":["DS","1","ImagingFrequency"],"0x0085":["SH","1","ImagedNucleus"],"0x0086":["IS","1-n","EchoNumber"],"0x0087":["DS","1","MagneticFieldStrength"],"0x0088":["DS","1","SpacingBetweenSlices"],"0x0089":["IS","1","NumberOfPhaseEncodingSteps"],"0x0090":["DS","1","DataCollectionDiameter"],"0x0091":["IS","1","EchoTrainLength"],"0x0093":["DS","1","PercentSampling"],"0x0094":["DS","1","PercentPhaseFieldOfView"],"0x0095":["DS","1","PixelBandwidth"],"0x1000":["LO","1","DeviceSerialNumber"],"0x1002":["UI","1","DeviceUID"],"0x1003":["LO","1","DeviceID"],"0x1004":["LO","1","PlateID"],"0x1005":["LO","1","GeneratorID"],"0x1006":["LO","1","GridID"],"0x1007":["LO","1","CassetteID"],"0x1008":["LO","1","GantryID"],"0x1010":["LO","1","SecondaryCaptureDeviceID"],"0x1011":["LO","1","HardcopyCreationDeviceID"],"0x1012":["DA","1","DateOfSecondaryCapture"],"0x1014":["TM","1","TimeOfSecondaryCapture"],"0x1016":["LO","1","SecondaryCaptureDeviceManufacturer"],"0x1017":["LO","1","HardcopyDeviceManufacturer"],"0x1018":["LO","1","SecondaryCaptureDeviceManufacturerModelName"],"0x1019":["LO","1-n","SecondaryCaptureDeviceSoftwareVersion"],"0x101A":["LO","1-n","HardcopyDeviceSoftwareVersion"],"0x101B":["LO","1","HardcopyDeviceManfuacturersModelName"],"0x1020":["LO","1-n","SoftwareVersion"],"0x1022":["SH","1","VideoImageFormatAcquired"],"0x1023":["LO","1","DigitalImageFormatAcquired"],"0x1030":["LO","1","ProtocolName"],"0x1040":["LO","1","ContrastBolusRoute"],"0x1041":["DS","1","ContrastBolusVolume"],"0x1042":["TM","1","ContrastBolusStartTime"],"0x1043":["TM","1","ContrastBolusStopTime"],"0x1044":["DS","1","ContrastBolusTotalDose"],"0x1045":["IS","1-n","SyringeCounts"],"0x1046":["DS","1-n","ContrastFlowRate"],"0x1047":["DS","1-n","ContrastFlowDuration"],"0x1048":["CS","1","ContrastBolusIngredient"],"0x1049":["DS","1","ContrastBolusIngredientConcentration"],"0x1050":["DS","1","SpatialResolution"],"0x1060":["DS","1","TriggerTime"],"0x1061":["LO","1","TriggerSourceOrType"],"0x1062":["IS","1","NominalInterval"],"0x1063":["DS","1","FrameTime"],"0x1064":["LO","1","FramingType"],"0x1065":["DS","1-n","FrameTimeVector"],"0x1066":["DS","1","FrameDelay"],"0x1067":["DS","1","ImageTriggerDelay"],"0x1068":["DS","1","MultiplexGroupTimeOffset"],"0x1069":["DS","1","TriggerTimeOffset"],"0x106A":["CS","1","SynchronizationTrigger"],"0x106C":["US","2","SynchronizationChannel"],"0x106E":["UL","1","TriggerSamplePosition"],"0x1070":["LO","1-n","RadionuclideRoute"],"0x1071":["DS","1-n","RadionuclideVolume"],"0x1072":["TM","1-n","RadionuclideStartTime"],"0x1073":["TM","1-n","RadionuclideStopTime"],"0x1074":["DS","1-n","RadionuclideTotalDose"],"0x1075":["DS","1","RadionuclideHalfLife"],"0x1076":["DS","1","RadionuclidePositronFraction"],"0x1077":["DS","1","RadiopharmaceuticalSpecificActivity"],"0x1080":["CS","1","BeatRejectionFlag"],"0x1081":["IS","1","LowRRValue"],"0x1082":["IS","1","HighRRValue"],"0x1083":["IS","1","IntervalsAcquired"],"0x1084":["IS","1","IntervalsRejected"],"0x1085":["LO","1","PVCRejection"],"0x1086":["IS","1","SkipBeats"],"0x1088":["IS","1","HeartRate"],"0x1090":["IS","1","CardiacNumberOfImages"],"0x1094":["IS","1","TriggerWindow"],"0x1100":["DS","1","ReconstructionDiameter"],"0x1110":["DS","1","DistanceSourceToDetector"],"0x1111":["DS","1","DistanceSourceToPatient"],"0x1114":["DS","1","EstimatedRadiographicMagnificationFactor"],"0x1120":["DS","1","GantryDetectorTilt"],"0x1121":["DS","1","GantryDetectorSlew"],"0x1130":["DS","1","TableHeight"],"0x1131":["DS","1","TableTraverse"],"0x1134":["DS","1","TableMotion"],"0x1135":["DS","1-n","TableVerticalIncrement"],"0x1136":["DS","1-n","TableLateralIncrement"],"0x1137":["DS","1-n","TableLongitudinalIncrement"],"0x1138":["DS","1","TableAngle"],"0x113A":["CS","1","TableType"],"0x1140":["CS","1","RotationDirection"],"0x1141":["DS","1","AngularPosition"],"0x1142":["DS","1-n","RadialPosition"],"0x1143":["DS","1","ScanArc"],"0x1144":["DS","1","AngularStep"],"0x1145":["DS","1","CenterOfRotationOffset"],"0x1146":["DS","1-n","RotationOffset"],"0x1147":["CS","1","FieldOfViewShape"],"0x1149":["IS","2","FieldOfViewDimension"],"0x1150":["IS","1","ExposureTime"],"0x1151":["IS","1","XrayTubeCurrent"],"0x1152":["IS","1","Exposure"],"0x1153":["IS","1","ExposureinuAs"],"0x1154":["DS","1","AveragePulseWidth"],"0x1155":["CS","1","RadiationSetting"],"0x1156":["CS","1","RectificationType"],"0x115A":["CS","1","RadiationMode"],"0x115E":["DS","1","ImageAreaDoseProduct"],"0x1160":["SH","1","FilterType"],"0x1161":["LO","1-n","TypeOfFilters"],"0x1162":["DS","1","IntensifierSize"],"0x1164":["DS","2","ImagerPixelSpacing"],"0x1166":["CS","1","Grid"],"0x1170":["IS","1","GeneratorPower"],"0x1180":["SH","1","CollimatorGridName"],"0x1181":["CS","1","CollimatorType"],"0x1182":["IS","1","FocalDistance"],"0x1183":["DS","1","XFocusCenter"],"0x1184":["DS","1","YFocusCenter"],"0x1190":["DS","1-n","FocalSpot"],"0x1191":["CS","1","AnodeTargetMaterial"],"0x11A0":["DS","1","BodyPartThickness"],"0x11A2":["DS","1","CompressionForce"],"0x1200":["DA","1-n","DateOfLastCalibration"],"0x1201":["TM","1-n","TimeOfLastCalibration"],"0x1210":["SH","1-n","ConvolutionKernel"],"0x1240":["IS","1-n","UpperLowerPixelValues"],"0x1242":["IS","1","ActualFrameDuration"],"0x1243":["IS","1","CountRate"],"0x1244":["US","1","PreferredPlaybackSequencing"],"0x1250":["SH","1","ReceivingCoil"],"0x1251":["SH","1","TransmittingCoil"],"0x1260":["SH","1","PlateType"],"0x1261":["LO","1","PhosphorType"],"0x1300":["IS","1","ScanVelocity"],"0x1301":["CS","1-n","WholeBodyTechnique"],"0x1302":["IS","1","ScanLength"],"0x1310":["US","4","AcquisitionMatrix"],"0x1312":["CS","1","PhaseEncodingDirection"],"0x1314":["DS","1","FlipAngle"],"0x1315":["CS","1","VariableFlipAngleFlag"],"0x1316":["DS","1","SAR"],"0x1318":["DS","1","dBdt"],"0x1400":["LO","1","AcquisitionDeviceProcessingDescription"],"0x1401":["LO","1","AcquisitionDeviceProcessingCode"],"0x1402":["CS","1","CassetteOrientation"],"0x1403":["CS","1","CassetteSize"],"0x1404":["US","1","ExposuresOnPlate"],"0x1405":["IS","1","RelativeXrayExposure"],"0x1450":["DS","1","ColumnAngulation"],"0x1460":["DS","1","TomoLayerHeight"],"0x1470":["DS","1","TomoAngle"],"0x1480":["DS","1","TomoTime"],"0x1490":["CS","1","TomoType"],"0x1491":["CS","1","TomoClass"],"0x1495":["IS","1","NumberofTomosynthesisSourceImages"],"0x1500":["CS","1","PositionerMotion"],"0x1508":["CS","1","PositionerType"],"0x1510":["DS","1","PositionerPrimaryAngle"],"0x1511":["DS","1","PositionerSecondaryAngle"],"0x1520":["DS","1-n","PositionerPrimaryAngleIncrement"],"0x1521":["DS","1-n","PositionerSecondaryAngleIncrement"],"0x1530":["DS","1","DetectorPrimaryAngle"],"0x1531":["DS","1","DetectorSecondaryAngle"],"0x1600":["CS","3","ShutterShape"],"0x1602":["IS","1","ShutterLeftVerticalEdge"],"0x1604":["IS","1","ShutterRightVerticalEdge"],"0x1606":["IS","1","ShutterUpperHorizontalEdge"],"0x1608":["IS","1","ShutterLowerHorizontalEdge"],"0x1610":["IS","1","CenterOfCircularShutter"],"0x1612":["IS","1","RadiusOfCircularShutter"],"0x1620":["IS","1-n","VerticesOfPolygonalShutter"],"0x1622":["US","1","ShutterPresentationValue"],"0x1623":["US","1","ShutterOverlayGroup"],"0x1700":["CS","3","CollimatorShape"],"0x1702":["IS","1","CollimatorLeftVerticalEdge"],"0x1704":["IS","1","CollimatorRightVerticalEdge"],"0x1706":["IS","1","CollimatorUpperHorizontalEdge"],"0x1708":["IS","1","CollimatorLowerHorizontalEdge"],"0x1710":["IS","1","CenterOfCircularCollimator"],"0x1712":["IS","1","RadiusOfCircularCollimator"],"0x1720":["IS","1-n","VerticesOfPolygonalCollimator"],"0x1800":["CS","1","AcquisitionTimeSynchronized"],"0x1801":["SH","1","TimeSource"],"0x1802":["CS","1","TimeDistributionProtocol"],"0x1810":["DT","1","AcquisitionTimestamp"],"0x4000":["LT","1-n","AcquisitionComments"],"0x5000":["SH","1-n","OutputPower"],"0x5010":["LO","3","TransducerData"],"0x5012":["DS","1","FocusDepth"],"0x5020":["LO","1","PreprocessingFunction"],"0x5021":["LO","1","PostprocessingFunction"],"0x5022":["DS","1","MechanicalIndex"],"0x5024":["DS","1","ThermalIndex"],"0x5026":["DS","1","CranialThermalIndex"],"0x5027":["DS","1","SoftTissueThermalIndex"],"0x5028":["DS","1","SoftTissueFocusThermalIndex"],"0x5029":["DS","1","SoftTissueSurfaceThermalIndex"],"0x5030":["DS","1","DynamicRange"],"0x5040":["DS","1","TotalGain"],"0x5050":["IS","1","DepthOfScanField"],"0x5100":["CS","1","PatientPosition"],"0x5101":["CS","1","ViewPosition"],"0x5104":["SQ","1","ProjectionEponymousNameCodeSequence"],"0x5210":["DS","6","ImageTransformationMatrix"],"0x5212":["DS","3","ImageTranslationVector"],"0x6000":["DS","1","Sensitivity"],"0x6011":["SQ","1","SequenceOfUltrasoundRegions"],"0x6012":["US","1","RegionSpatialFormat"],"0x6014":["US","1","RegionDataType"],"0x6016":["UL","1","RegionFlags"],"0x6018":["UL","1","RegionLocationMinX0"],"0x601A":["UL","1","RegionLocationMinY0"],"0x601C":["UL","1","RegionLocationMaxX1"],"0x601E":["UL","1","RegionLocationMaxY1"],"0x6020":["SL","1","ReferencePixelX0"],"0x6022":["SL","1","ReferencePixelY0"],"0x6024":["US","1","PhysicalUnitsXDirection"],"0x6026":["US","1","PhysicalUnitsYDirection"],"0x6028":["FD","1","ReferencePixelPhysicalValueX"],"0x602A":["FD","1","ReferencePixelPhysicalValueY"],"0x602C":["FD","1","PhysicalDeltaX"],"0x602E":["FD","1","PhysicalDeltaY"],"0x6030":["UL","1","TransducerFrequency"],"0x6031":["CS","1","TransducerType"],"0x6032":["UL","1","PulseRepetitionFrequency"],"0x6034":["FD","1","DopplerCorrectionAngle"],"0x6036":["FD","1","SteeringAngle"],"0x6038":["UL","1","DopplerSampleVolumeXPosition"],"0x603A":["UL","1","DopplerSampleVolumeYPosition"],"0x603C":["UL","1","TMLinePositionX0"],"0x603E":["UL","1","TMLinePositionY0"],"0x6040":["UL","1","TMLinePositionX1"],"0x6042":["UL","1","TMLinePositionY1"],"0x6044":["US","1","PixelComponentOrganization"],"0x6046":["UL","1","PixelComponentMask"],"0x6048":["UL","1","PixelComponentRangeStart"],"0x604A":["UL","1","PixelComponentRangeStop"],"0x604C":["US","1","PixelComponentPhysicalUnits"],"0x604E":["US","1","PixelComponentDataType"],"0x6050":["UL","1","NumberOfTableBreakPoints"],"0x6052":["UL","1-n","TableOfXBreakPoints"],"0x6054":["FD","1-n","TableOfYBreakPoints"],"0x6056":["UL","1","NumberOfTableEntries"],"0x6058":["UL","1-n","TableOfPixelValues"],"0x605A":["FL","1-n","TableOfParameterValues"],"0x7000":["CS","1","DetectorConditionsNominalFlag"],"0x7001":["DS","1","DetectorTemperature"],"0x7004":["CS","1","DetectorType"],"0x7005":["CS","1","DetectorConfiguration"],"0x7006":["LT","1","DetectorDescription"],"0x7008":["LT","1","DetectorMode"],"0x700A":["SH","1","DetectorID"],"0x700C":["DA","1","DateofLastDetectorCalibration"],"0x700E":["TM","1","TimeofLastDetectorCalibration"],"0x7010":["IS","1","ExposuresOnDetectorSinceLastCalibration"],"0x7011":["IS","1","ExposuresOnDetectorSinceManufactured"],"0x7012":["DS","1","DetectorTimeSinceLastExposure"],"0x7014":["DS","1","DetectorActiveTime"],"0x7016":["DS","1","DetectorActivationOffsetFromExposure"],"0x701A":["DS","2","DetectorBinning"],"0x7020":["DS","2","DetectorElementPhysicalSize"],"0x7022":["DS","2","DetectorElementSpacing"],"0x7024":["CS","1","DetectorActiveShape"],"0x7026":["DS","1-2","DetectorActiveDimensions"],"0x7028":["DS","2","DetectorActiveOrigin"],"0x7030":["DS","2","FieldofViewOrigin"],"0x7032":["DS","1","FieldofViewRotation"],"0x7034":["CS","1","FieldofViewHorizontalFlip"],"0x7040":["LT","1","GridAbsorbingMaterial"],"0x7041":["LT","1","GridSpacingMaterial"],"0x7042":["DS","1","GridThickness"],"0x7044":["DS","1","GridPitch"],"0x7046":["IS","2","GridAspectRatio"],"0x7048":["DS","1","GridPeriod"],"0x704C":["DS","1","GridFocalDistance"],"0x7050":["LT","1-n","FilterMaterial"],"0x7052":["DS","1-n","FilterThicknessMinimum"],"0x7054":["DS","1-n","FilterThicknessMaximum"],"0x7060":["CS","1","ExposureControlMode"],"0x7062":["LT","1","ExposureControlModeDescription"],"0x7064":["CS","1","ExposureStatus"],"0x7065":["DS","1","PhototimerSetting"]},"0x0020":{"0x0000":["UL","1","ImageGroupLength"],"0x000D":["UI","1","StudyInstanceUID"],"0x000E":["UI","1","SeriesInstanceUID"],"0x0010":["SH","1","StudyID"],"0x0011":["IS","1","SeriesNumber"],"0x0012":["IS","1","AcquisitionNumber"],"0x0013":["IS","1","ImageNumber"],"0x0014":["IS","1","IsotopeNumber"],"0x0015":["IS","1","PhaseNumber"],"0x0016":["IS","1","IntervalNumber"],"0x0017":["IS","1","TimeSlotNumber"],"0x0018":["IS","1","AngleNumber"],"0x0019":["IS","1","ItemNumber"],"0x0020":["CS","2","PatientOrientation"],"0x0022":["IS","1","OverlayNumber"],"0x0024":["IS","1","CurveNumber"],"0x0026":["IS","1","LUTNumber"],"0x0030":["DS","3","ImagePosition"],"0x0032":["DS","3","ImagePositionPatient"],"0x0035":["DS","6","ImageOrientation"],"0x0037":["DS","6","ImageOrientationPatient"],"0x0050":["DS","1","Location"],"0x0052":["UI","1","FrameOfReferenceUID"],"0x0060":["CS","1","Laterality"],"0x0062":["CS","1","ImageLaterality"],"0x0070":["LT","1","ImageGeometryType"],"0x0080":["CS","1-n","MaskingImage"],"0x0100":["IS","1","TemporalPositionIdentifier"],"0x0105":["IS","1","NumberOfTemporalPositions"],"0x0110":["DS","1","TemporalResolution"],"0x0200":["UI","1","SynchronizationFrameofReferenceUID"],"0x1000":["IS","1","SeriesInStudy"],"0x1001":["IS","1","AcquisitionsInSeries"],"0x1002":["IS","1","ImagesInAcquisition"],"0x1003":["IS","1","ImagesInSeries"],"0x1004":["IS","1","AcquisitionsInStudy"],"0x1005":["IS","1","ImagesInStudy"],"0x1020":["CS","1-n","Reference"],"0x1040":["LO","1","PositionReferenceIndicator"],"0x1041":["DS","1","SliceLocation"],"0x1070":["IS","1-n","OtherStudyNumbers"],"0x1200":["IS","1","NumberOfPatientRelatedStudies"],"0x1202":["IS","1","NumberOfPatientRelatedSeries"],"0x1204":["IS","1","NumberOfPatientRelatedImages"],"0x1206":["IS","1","NumberOfStudyRelatedSeries"],"0x1208":["IS","1","NumberOfStudyRelatedImages"],"0x1209":["IS","1","NumberOfSeriesRelatedInstances"],"0x3100":["CS","1-n","SourceImageID"],"0x3401":["CS","1","ModifyingDeviceID"],"0x3402":["CS","1","ModifiedImageID"],"0x3403":["DA","1","ModifiedImageDate"],"0x3404":["LO","1","ModifyingDeviceManufacturer"],"0x3405":["TM","1","ModifiedImageTime"],"0x3406":["LT","1","ModifiedImageDescription"],"0x4000":["LT","1","ImageComments"],"0x5000":["AT","1-n","OriginalImageIdentification"],"0x5002":["CS","1-n","OriginalImageIdentificationNomenclature"]},"0x0028":{"0x0000":["UL","1","ImagePresentationGroupLength"],"0x0002":["US","1","SamplesPerPixel"],"0x0004":["CS","1","PhotometricInterpretation"],"0x0005":["US","1","ImageDimensions"],"0x0006":["US","1","PlanarConfiguration"],"0x0008":["IS","1","NumberOfFrames"],"0x0009":["AT","1","FrameIncrementPointer"],"0x0010":["US","1","Rows"],"0x0011":["US","1","Columns"],"0x0012":["US","1","Planes"],"0x0014":["US","1","UltrasoundColorDataPresent"],"0x0030":["DS","2","PixelSpacing"],"0x0031":["DS","2","ZoomFactor"],"0x0032":["DS","2","ZoomCenter"],"0x0034":["IS","2","PixelAspectRatio"],"0x0040":["CS","1","ImageFormat"],"0x0050":["LT","1-n","ManipulatedImage"],"0x0051":["CS","1","CorrectedImage"],"0x005F":["CS","1","CompressionRecognitionCode"],"0x0060":["CS","1","CompressionCode"],"0x0061":["SH","1","CompressionOriginator"],"0x0062":["SH","1","CompressionLabel"],"0x0063":["SH","1","CompressionDescription"],"0x0065":["CS","1-n","CompressionSequence"],"0x0066":["AT","1-n","CompressionStepPointers"],"0x0068":["US","1","RepeatInterval"],"0x0069":["US","1","BitsGrouped"],"0x0070":["US","1-n","PerimeterTable"],"0x0071":["XS","1","PerimeterValue"],"0x0080":["US","1","PredictorRows"],"0x0081":["US","1","PredictorColumns"],"0x0082":["US","1-n","PredictorConstants"],"0x0090":["CS","1","BlockedPixels"],"0x0091":["US","1","BlockRows"],"0x0092":["US","1","BlockColumns"],"0x0093":["US","1","RowOverlap"],"0x0094":["US","1","ColumnOverlap"],"0x0100":["US","1","BitsAllocated"],"0x0101":["US","1","BitsStored"],"0x0102":["US","1","HighBit"],"0x0103":["US","1","PixelRepresentation"],"0x0104":["XS","1","SmallestValidPixelValue"],"0x0105":["XS","1","LargestValidPixelValue"],"0x0106":["XS","1","SmallestImagePixelValue"],"0x0107":["XS","1","LargestImagePixelValue"],"0x0108":["XS","1","SmallestPixelValueInSeries"],"0x0109":["XS","1","LargestPixelValueInSeries"],"0x0110":["XS","1","SmallestPixelValueInPlane"],"0x0111":["XS","1","LargestPixelValueInPlane"],"0x0120":["XS","1","PixelPaddingValue"],"0x0200":["US","1","ImageLocation"],"0x0300":["CS","1","QualityControlImage"],"0x0301":["CS","1","BurnedInAnnotation"],"0x0400":["CS","1","TransformLabel"],"0x0401":["CS","1","TransformVersionNumber"],"0x0402":["US","1","NumberOfTransformSteps"],"0x0403":["CS","1-n","SequenceOfCompressedData"],"0x0404":["AT","1-n","DetailsOfCoefficients"],"0x0410":["US","1","RowsForNthOrderCoefficients"],"0x0411":["US","1","ColumnsForNthOrderCoefficients"],"0x0412":["CS","1-n","CoefficientCoding"],"0x0413":["AT","1-n","CoefficientCodingPointers"],"0x0700":["CS","1","DCTLabel"],"0x0701":["CS","1-n","DataBlockDescription"],"0x0702":["AT","1-n","DataBlock"],"0x0710":["US","1","NormalizationFactorFormat"],"0x0720":["US","1","ZonalMapNumberFormat"],"0x0721":["AT","1-n","ZonalMapLocation"],"0x0722":["US","1","ZonalMapFormat"],"0x0730":["US","1","AdaptiveMapFormat"],"0x0740":["US","1","CodeNumberFormat"],"0x0800":["CS","1-n","CodeLabel"],"0x0802":["US","1","NumberOfTables"],"0x0803":["AT","1-n","CodeTableLocation"],"0x0804":["US","1","BitsForCodeWord"],"0x0808":["AT","1-n","ImageDataLocation"],"0x1040":["CS","1","PixelIntensityRelationship"],"0x1041":["SS","1","PixelIntensityRelationshipSign"],"0x1050":["DS","1-n","WindowCenter"],"0x1051":["DS","1-n","WindowWidth"],"0x1052":["DS","1","RescaleIntercept"],"0x1053":["DS","1","RescaleSlope"],"0x1054":["LO","1","RescaleType"],"0x1055":["LO","1-n","WindowCenterWidthExplanation"],"0x1080":["CS","1","GrayScale"],"0x1090":["CS","1","RecommendedViewingMode"],"0x1100":["XS","3","GrayLookupTableDescriptor"],"0x1101":["XS","3","RedPaletteColorLookupTableDescriptor"],"0x1102":["XS","3","GreenPaletteColorLookupTableDescriptor"],"0x1103":["XS","3","BluePaletteColorLookupTableDescriptor"],"0x1111":["US","4","LargeRedPaletteColorLookupTableDescriptor"],"0x1112":["US","4","LargeGreenPaletteColorLookupTabe"],"0x1113":["US","4","LargeBluePaletteColorLookupTabl"],"0x1199":["UI","1","PaletteColorLookupTableUID"],"0x1200":["XS","1-n","GrayLookupTableData"],"0x1201":["XS","1-n","RedPaletteColorLookupTableData"],"0x1202":["XS","1-n","GreenPaletteColorLookupTableData"],"0x1203":["XS","1-n","BluePaletteColorLookupTableData"],"0x1211":["OW","1","LargeRedPaletteColorLookupTableData"],"0x1212":["OW","1","LargeGreenPaletteColorLookupTableData"],"0x1213":["OW","1","LargeBluePaletteColorLookupTableData"],"0x1214":["UI","1","LargePaletteColorLookupTableUID"],"0x1221":["OW","1","SegmentedRedPaletteColorLookupTableData"],"0x1222":["OW","1","SegmentedGreenPaletteColorLookupTableData"],"0x1223":["OW","1","SegmentedBluePaletteColorLookupTableData"],"0x1300":["CS","1","ImplantPresent"],"0x2110":["CS","1","LossyImageCompression"],"0x2112":["DS","1-n","LossyImageCompressionRatio"],"0x3000":["SQ","1","ModalityLUTSequence"],"0x3002":["XS","3","LUTDescriptor"],"0x3003":["LO","1","LUTExplanation"],"0x3004":["LO","1","ModalityLUTType"],"0x3006":["XS","1-n","LUTData"],"0x3010":["SQ","1","VOILUTSequence"],"0x3110":["SQ","1","SoftcopyVOILUTSequence"],"0x4000":["LT","1-n","ImagePresentationComments"],"0x5000":["SQ","1","BiPlaneAcquisitionSequence"],"0x6010":["US","1","RepresentativeFrameNumber"],"0x6020":["US","1-n","FrameNumbersOfInterest"],"0x6022":["LO","1-n","FrameOfInterestDescription"],"0x6030":["US","1-n","MaskPointer"],"0x6040":["US","1-n","RWavePointer"],"0x6100":["SQ","1","MaskSubtractionSequence"],"0x6101":["CS","1","MaskOperation"],"0x6102":["US","1-n","ApplicableFrameRange"],"0x6110":["US","1-n","MaskFrameNumbers"],"0x6112":["US","1","ContrastFrameAveraging"],"0x6114":["FL","2","MaskSubPixelShift"],"0x6120":["SS","1","TIDOffset"],"0x6190":["ST","1","MaskOperationExplanation"]},"0x0032":{"0x0000":["UL","1","StudyGroupLength"],"0x000A":["CS","1","StudyStatusID"],"0x000C":["CS","1","StudyPriorityID"],"0x0012":["LO","1","StudyIDIssuer"],"0x0032":["DA","1","StudyVerifiedDate"],"0x0033":["TM","1","StudyVerifiedTime"],"0x0034":["DA","1","StudyReadDate"],"0x0035":["TM","1","StudyReadTime"],"0x1000":["DA","1","ScheduledStudyStartDate"],"0x1001":["TM","1","ScheduledStudyStartTime"],"0x1010":["DA","1","ScheduledStudyStopDate"],"0x1011":["TM","1","ScheduledStudyStopTime"],"0x1020":["LO","1","ScheduledStudyLocation"],"0x1021":["AE","1-n","ScheduledStudyLocationAETitle"],"0x1030":["LO","1","ReasonForStudy"],"0x1032":["PN","1","RequestingPhysician"],"0x1033":["LO","1","RequestingService"],"0x1040":["DA","1","StudyArrivalDate"],"0x1041":["TM","1","StudyArrivalTime"],"0x1050":["DA","1","StudyCompletionDate"],"0x1051":["TM","1","StudyCompletionTime"],"0x1055":["CS","1","StudyComponentStatusID"],"0x1060":["LO","1","RequestedProcedureDescription"],"0x1064":["SQ","1","RequestedProcedureCodeSequence"],"0x1070":["LO","1","RequestedContrastAgent"],"0x4000":["LT","1","StudyComments"]},"0x0038":{"0x0000":["UL","1","VisitGroupLength"],"0x0004":["SQ","1","ReferencedPatientAliasSequence"],"0x0008":["CS","1","VisitStatusID"],"0x0010":["LO","1","AdmissionID"],"0x0011":["LO","1","IssuerOfAdmissionID"],"0x0016":["LO","1","RouteOfAdmissions"],"0x001A":["DA","1","ScheduledAdmissionDate"],"0x001B":["TM","1","ScheduledAdmissionTime"],"0x001C":["DA","1","ScheduledDischargeDate"],"0x001D":["TM","1","ScheduledDischargeTime"],"0x001E":["LO","1","ScheduledPatientInstitutionResidence"],"0x0020":["DA","1","AdmittingDate"],"0x0021":["TM","1","AdmittingTime"],"0x0030":["DA","1","DischargeDate"],"0x0032":["TM","1","DischargeTime"],"0x0040":["LO","1","DischargeDiagnosisDescription"],"0x0044":["SQ","1","DischargeDiagnosisCodeSequence"],"0x0050":["LO","1","SpecialNeeds"],"0x0300":["LO","1","CurrentPatientLocation"],"0x0400":["LO","1","PatientInstitutionResidence"],"0x0500":["LO","1","PatientState"],"0x4000":["LT","1","VisitComments"]},"0x003A":{"0x0004":["CS","1","WaveformOriginality"],"0x0005":["US","1","NumberofChannels"],"0x0010":["UL","1","NumberofSamples"],"0x001A":["DS","1","SamplingFrequency"],"0x0020":["SH","1","MultiplexGroupLabel"],"0x0200":["SQ","1","ChannelDefinitionSequence"],"0x0202":["IS","1","WVChannelNumber"],"0x0203":["SH","1","ChannelLabel"],"0x0205":["CS","1-n","ChannelStatus"],"0x0208":["SQ","1","ChannelSourceSequence"],"0x0209":["SQ","1","ChannelSourceModifiersSequence"],"0x020A":["SQ","1","SourceWaveformSequence"],"0x020C":["LO","1","ChannelDerivationDescription"],"0x0210":["DS","1","ChannelSensitivity"],"0x0211":["SQ","1","ChannelSensitivityUnits"],"0x0212":["DS","1","ChannelSensitivityCorrectionFactor"],"0x0213":["DS","1","ChannelBaseline"],"0x0214":["DS","1","ChannelTimeSkew"],"0x0215":["DS","1","ChannelSampleSkew"],"0x0218":["DS","1","ChannelOffset"],"0x021A":["US","1","WaveformBitsStored"],"0x0220":["DS","1","FilterLowFrequency"],"0x0221":["DS","1","FilterHighFrequency"],"0x0222":["DS","1","NotchFilterFrequency"],"0x0223":["DS","1","NotchFilterBandwidth"]},"0x0040":{"0x0000":["UL","1","ModalityWorklistGroupLength"],"0x0001":["AE","1","ScheduledStationAETitle"],"0x0002":["DA","1","ScheduledProcedureStepStartDate"],"0x0003":["TM","1","ScheduledProcedureStepStartTime"],"0x0004":["DA","1","ScheduledProcedureStepEndDate"],"0x0005":["TM","1","ScheduledProcedureStepEndTime"],"0x0006":["PN","1","ScheduledPerformingPhysicianName"],"0x0007":["LO","1","ScheduledProcedureStepDescription"],"0x0008":["SQ","1","ScheduledProcedureStepCodeSequence"],"0x0009":["SH","1","ScheduledProcedureStepID"],"0x0010":["SH","1","ScheduledStationName"],"0x0011":["SH","1","ScheduledProcedureStepLocation"],"0x0012":["LO","1","ScheduledPreOrderOfMedication"],"0x0020":["CS","1","ScheduledProcedureStepStatus"],"0x0100":["SQ","1-n","ScheduledProcedureStepSequence"],"0x0220":["SQ","1","ReferencedStandaloneSOPInstanceSequence"],"0x0241":["AE","1","PerformedStationAETitle"],"0x0242":["SH","1","PerformedStationName"],"0x0243":["SH","1","PerformedLocation"],"0x0244":["DA","1","PerformedProcedureStepStartDate"],"0x0245":["TM","1","PerformedProcedureStepStartTime"],"0x0250":["DA","1","PerformedProcedureStepEndDate"],"0x0251":["TM","1","PerformedProcedureStepEndTime"],"0x0252":["CS","1","PerformedProcedureStepStatus"],"0x0253":["CS","1","PerformedProcedureStepID"],"0x0254":["LO","1","PerformedProcedureStepDescription"],"0x0255":["LO","1","PerformedProcedureTypeDescription"],"0x0260":["SQ","1","PerformedActionItemSequence"],"0x0270":["SQ","1","ScheduledStepAttributesSequence"],"0x0275":["SQ","1","RequestAttributesSequence"],"0x0280":["ST","1","CommentsOnThePerformedProcedureSteps"],"0x0293":["SQ","1","QuantitySequence"],"0x0294":["DS","1","Quantity"],"0x0295":["SQ","1","MeasuringUnitsSequence"],"0x0296":["SQ","1","BillingItemSequence"],"0x0300":["US","1","TotalTimeOfFluoroscopy"],"0x0301":["US","1","TotalNumberOfExposures"],"0x0302":["US","1","EntranceDose"],"0x0303":["US","1-2","ExposedArea"],"0x0306":["DS","1","DistanceSourceToEntrance"],"0x0307":["DS","1","DistanceSourceToSupport"],"0x0310":["ST","1","CommentsOnRadiationDose"],"0x0312":["DS","1","XRayOutput"],"0x0314":["DS","1","HalfValueLayer"],"0x0316":["DS","1","OrganDose"],"0x0318":["CS","1","OrganExposed"],"0x0320":["SQ","1","BillingProcedureStepSequence"],"0x0321":["SQ","1","FilmConsumptionSequence"],"0x0324":["SQ","1","BillingSuppliesAndDevicesSequence"],"0x0330":["SQ","1","ReferencedProcedureStepSequence"],"0x0340":["SQ","1","PerformedSeriesSequence"],"0x0400":["LT","1","CommentsOnScheduledProcedureStep"],"0x050A":["LO","1","SpecimenAccessionNumber"],"0x0550":["SQ","1","SpecimenSequence"],"0x0551":["LO","1","SpecimenIdentifier"],"0x0555":["SQ","1","AcquisitionContextSequence"],"0x0556":["ST","1","AcquisitionContextDescription"],"0x059A":["SQ","1","SpecimenTypeCodeSequence"],"0x06FA":["LO","1","SlideIdentifier"],"0x071A":["SQ","1","ImageCenterPointCoordinatesSequence"],"0x072A":["DS","1","XOffsetInSlideCoordinateSystem"],"0x073A":["DS","1","YOffsetInSlideCoordinateSystem"],"0x074A":["DS","1","ZOffsetInSlideCoordinateSystem"],"0x08D8":["SQ","1","PixelSpacingSequence"],"0x08DA":["SQ","1","CoordinateSystemAxisCodeSequence"],"0x08EA":["SQ","1","MeasurementUnitsCodeSequence"],"0x1001":["SH","1","RequestedProcedureID"],"0x1002":["LO","1","ReasonForRequestedProcedure"],"0x1003":["SH","1","RequestedProcedurePriority"],"0x1004":["LO","1","PatientTransportArrangements"],"0x1005":["LO","1","RequestedProcedureLocation"],"0x1006":["SH","1","PlacerOrderNumberOfProcedure"],"0x1007":["SH","1","FillerOrderNumberOfProcedure"],"0x1008":["LO","1","ConfidentialityCode"],"0x1009":["SH","1","ReportingPriority"],"0x1010":["PN","1-n","NamesOfIntendedRecipientsOfResults"],"0x1400":["LT","1","RequestedProcedureComments"],"0x2001":["LO","1","ReasonForTheImagingServiceRequest"],"0x2002":["LO","1","ImagingServiceRequestDescription"],"0x2004":["DA","1","IssueDateOfImagingServiceRequest"],"0x2005":["TM","1","IssueTimeOfImagingServiceRequest"],"0x2006":["SH","1","PlacerOrderNumberOfImagingServiceRequest"],"0x2007":["SH","0","FillerOrderNumberOfImagingServiceRequest"],"0x2008":["PN","1","OrderEnteredBy"],"0x2009":["SH","1","OrderEntererLocation"],"0x2010":["SH","1","OrderCallbackPhoneNumber"],"0x2016":["LO","1","PlacerOrderNumberImagingServiceRequest"],"0x2017":["LO","1","FillerOrderNumberImagingServiceRequest"],"0x2400":["LT","1","ImagingServiceRequestComments"],"0x3001":["LT","1","ConfidentialityConstraint"],"0xA010":["CS","1","RelationshipType"],"0xA027":["LO","1","VerifyingOrganization"],"0xA030":["DT","1","VerificationDateTime"],"0xA032":["DT","1","ObservationDateTime"],"0xA040":["CS","1","ValueType"],"0xA043":["SQ","1","ConceptNameCodeSequence"],"0xA050":["CS","1","ContinuityOfContent"],"0xA073":["SQ","1","VerifyingObserverSequence"],"0xA075":["PN","1","VerifyingObserverName"],"0xA088":["SQ","1","VerifyingObserverIdentificationCodeSeque"],"0xA0B0":["US","2-2n","ReferencedWaveformChannels"],"0xA120":["DT","1","DateTime"],"0xA121":["DA","1","Date"],"0xA122":["TM","1","Time"],"0xA123":["PN","1","PersonName"],"0xA124":["UI","1","UID"],"0xA130":["CS","1","TemporalRangeType"],"0xA132":["UL","1-n","ReferencedSamplePositionsU"],"0xA136":["US","1-n","ReferencedFrameNumbers"],"0xA138":["DS","1-n","ReferencedTimeOffsets"],"0xA13A":["DT","1-n","ReferencedDatetime"],"0xA160":["UT","1","TextValue"],"0xA168":["SQ","1","ConceptCodeSequence"],"0xA180":["US","1","AnnotationGroupNumber"],"0xA195":["SQ","1","ConceptNameCodeSequenceModifier"],"0xA300":["SQ","1","MeasuredValueSequence"],"0xA30A":["DS","1-n","NumericValue"],"0xA360":["SQ","1","PredecessorDocumentsSequence"],"0xA370":["SQ","1","ReferencedRequestSequence"],"0xA372":["SQ","1","PerformedProcedureCodeSequence"],"0xA375":["SQ","1","CurrentRequestedProcedureEvidenceSequenSequence"],"0xA385":["SQ","1","PertinentOtherEvidenceSequence"],"0xA491":["CS","1","CompletionFlag"],"0xA492":["LO","1","CompletionFlagDescription"],"0xA493":["CS","1","VerificationFlag"],"0xA504":["SQ","1","ContentTemplateSequence"],"0xA525":["SQ","1","IdenticalDocumentsSequence"],"0xA730":["SQ","1","ContentSequence"],"0xB020":["SQ","1","AnnotationSequence"],"0xDB00":["CS","1","TemplateIdentifier"],"0xDB06":["DT","1","TemplateVersion"],"0xDB07":["DT","1","TemplateLocalVersion"],"0xDB0B":["CS","1","TemplateExtensionFlag"],"0xDB0C":["UI","1","TemplateExtensionOrganizationUID"],"0xDB0D":["UI","1","TemplateExtensionCreatorUID"],"0xDB73":["UL","1-n","ReferencedContentItemIdentifier"]},"0x0050":{"0x0000":["UL","1","XRayAngioDeviceGroupLength"],"0x0004":["CS","1","CalibrationObject"],"0x0010":["SQ","1","DeviceSequence"],"0x0012":["CS","1","DeviceType"],"0x0014":["DS","1","DeviceLength"],"0x0016":["DS","1","DeviceDiameter"],"0x0017":["CS","1","DeviceDiameterUnits"],"0x0018":["DS","1","DeviceVolume"],"0x0019":["DS","1","InterMarkerDistance"],"0x0020":["LO","1","DeviceDescription"],"0x0030":["SQ","1","CodedInterventionalDeviceSequence"]},"0x0054":{"0x0000":["UL","1","NuclearMedicineGroupLength"],"0x0010":["US","1-n","EnergyWindowVector"],"0x0011":["US","1","NumberOfEnergyWindows"],"0x0012":["SQ","1","EnergyWindowInformationSequence"],"0x0013":["SQ","1","EnergyWindowRangeSequence"],"0x0014":["DS","1","EnergyWindowLowerLimit"],"0x0015":["DS","1","EnergyWindowUpperLimit"],"0x0016":["SQ","1","RadiopharmaceuticalInformationSequence"],"0x0017":["IS","1","ResidualSyringeCounts"],"0x0018":["SH","1","EnergyWindowName"],"0x0020":["US","1-n","DetectorVector"],"0x0021":["US","1","NumberOfDetectors"],"0x0022":["SQ","1","DetectorInformationSequence"],"0x0030":["US","1-n","PhaseVector"],"0x0031":["US","1","NumberOfPhases"],"0x0032":["SQ","1","PhaseInformationSequence"],"0x0033":["US","1","NumberOfFramesInPhase"],"0x0036":["IS","1","PhaseDelay"],"0x0038":["IS","1","PauseBetweenFrames"],
"0x0050":["US","1-n","RotationVector"],"0x0051":["US","1","NumberOfRotations"],"0x0052":["SQ","1","RotationInformationSequence"],"0x0053":["US","1","NumberOfFramesInRotation"],"0x0060":["US","1-n","RRIntervalVector"],"0x0061":["US","1","NumberOfRRIntervals"],"0x0062":["SQ","1","GatedInformationSequence"],"0x0063":["SQ","1","DataInformationSequence"],"0x0070":["US","1-n","TimeSlotVector"],"0x0071":["US","1","NumberOfTimeSlots"],"0x0072":["SQ","1","TimeSlotInformationSequence"],"0x0073":["DS","1","TimeSlotTime"],"0x0080":["US","1-n","SliceVector"],"0x0081":["US","1","NumberOfSlices"],"0x0090":["US","1-n","AngularViewVector"],"0x0100":["US","1-n","TimeSliceVector"],"0x0101":["US","1","NumberOfTimeSlices"],"0x0200":["DS","1","StartAngle"],"0x0202":["CS","1","TypeOfDetectorMotion"],"0x0210":["IS","1-n","TriggerVector"],"0x0211":["US","1","NumberOfTriggersInPhase"],"0x0220":["SQ","1","ViewCodeSequence"],"0x0222":["SQ","1","ViewAngulationModifierCodeSequence"],"0x0300":["SQ","1","RadionuclideCodeSequence"],"0x0302":["SQ","1","AdministrationRouteCodeSequence"],"0x0304":["SQ","1","RadiopharmaceuticalCodeSequence"],"0x0306":["SQ","1","CalibrationDataSequence"],"0x0308":["US","1","EnergyWindowNumber"],"0x0400":["SH","1","ImageID"],"0x0410":["SQ","1","PatientOrientationCodeSequence"],"0x0412":["SQ","1","PatientOrientationModifierCodeSequence"],"0x0414":["SQ","1","PatientGantryRelationshipCodeSequence"],"0x1000":["CS","2","SeriesType"],"0x1001":["CS","1","Units"],"0x1002":["CS","1","CountsSource"],"0x1004":["CS","1","ReprojectionMethod"],"0x1100":["CS","1","RandomsCorrectionMethod"],"0x1101":["LO","1","AttenuationCorrectionMethod"],"0x1102":["CS","1","DecayCorrection"],"0x1103":["LO","1","ReconstructionMethod"],"0x1104":["LO","1","DetectorLinesOfResponseUsed"],"0x1105":["LO","1","ScatterCorrectionMethod"],"0x1200":["DS","1","AxialAcceptance"],"0x1201":["IS","2","AxialMash"],"0x1202":["IS","1","TransverseMash"],"0x1203":["DS","2","DetectorElementSize"],"0x1210":["DS","1","CoincidenceWindowWidth"],"0x1220":["CS","1-n","SecondaryCountsType"],"0x1300":["DS","1","FrameReferenceTime"],"0x1310":["IS","1","PrimaryPromptsCountsAccumulated"],"0x1311":["IS","1-n","SecondaryCountsAccumulated"],"0x1320":["DS","1","SliceSensitivityFactor"],"0x1321":["DS","1","DecayFactor"],"0x1322":["DS","1","DoseCalibrationFactor"],"0x1323":["DS","1","ScatterFractionFactor"],"0x1324":["DS","1","DeadTimeFactor"],"0x1330":["US","1","ImageIndex"],"0x1400":["CS","1-n","CountsIncluded"],"0x1401":["CS","1","DeadTimeCorrectionFlag"]},"0x0060":{"0x0000":["UL","1","HistogramGroupLength"],"0x3000":["SQ","1","HistogramSequence"],"0x3002":["US","1","HistogramNumberofBins"],"0x3004":["US/SS","1","HistogramFirstBinValue"],"0x3006":["US/SS","1","HistogramLastBinValue"],"0x3008":["US","1","HistogramBinWidth"],"0x3010":["LO","1","HistogramExplanation"],"0x3020":["UL","1-n","HistogramData"]},"0x0070":{"0x0001":["SQ","1","GraphicAnnotationSequence"],"0x0002":["CS","1","GraphicLayer"],"0x0003":["CS","1","BoundingBoxAnnotationUnits"],"0x0004":["CS","1","AnchorPointAnnotationUnits"],"0x0005":["CS","1","GraphicAnnotationUnits"],"0x0006":["ST","1","UnformattedTextValue"],"0x0008":["SQ","1","TextObjectSequence"],"0x0009":["SQ","1","GraphicObjectSequence"],"0x0010":["FL","2","BoundingBoxTopLeftHandCorner"],"0x0011":["FL","2","BoundingBoxBottomRightHandCorner"],"0x0012":["CS","1","BoundingBoxTextHorizontalJustification"],"0x0014":["FL","2","AnchorPoint"],"0x0015":["CS","1","AnchorPointVisibility"],"0x0020":["US","1","GraphicDimensions"],"0x0021":["US","1","NumberOfGraphicPoints"],"0x0022":["FL","2-n","GraphicData"],"0x0023":["CS","1","GraphicType"],"0x0024":["CS","1","GraphicFilled"],"0x0040":["IS","1","ImageRotationFrozenDraftRetired"],"0x0041":["CS","1","ImageHorizontalFlip"],"0x0042":["US","1","ImageRotation"],"0x0050":["US","2","DisplayedAreaTLHCFrozenDraftRetired"],"0x0051":["US","2","DisplayedAreaBRHCFrozenDraftRetired"],"0x0052":["SL","2","DisplayedAreaTopLeftHandCorner"],"0x0053":["SL","2","DisplayedAreaBottomRightHandCorner"],"0x005A":["SQ","1","DisplayedAreaSelectionSequence"],"0x0060":["SQ","1","GraphicLayerSequence"],"0x0062":["IS","1","GraphicLayerOrder"],"0x0066":["US","1","GraphicLayerRecommendedDisplayGrayscaleValue"],"0x0067":["US","3","GraphicLayerRecommendedDisplayRGBValue"],"0x0068":["LO","1","GraphicLayerDescription"],"0x0080":["CS","1","PresentationLabel"],"0x0081":["LO","1","PresentationDescription"],"0x0082":["DA","1","PresentationCreationDate"],"0x0083":["TM","1","PresentationCreationTime"],"0x0084":["PN","1","PresentationCreatorsName"],"0x0100":["CS","1","PresentationSizeMode"],"0x0101":["DS","2","PresentationPixelSpacing"],"0x0102":["IS","2","PresentationPixelAspectRatio"],"0x0103":["FL","1","PresentationPixelMagnificationRatio"]},"0x0088":{"0x0000":["UL","1","StorageGroupLength"],"0x0130":["SH","1","StorageMediaFilesetID"],"0x0140":["UI","1","StorageMediaFilesetUID"],"0x0200":["SQ","1","IconImage"],"0x0904":["LO","1","TopicTitle"],"0x0906":["ST","1","TopicSubject"],"0x0910":["LO","1","TopicAuthor"],"0x0912":["LO","3","TopicKeyWords"]},"0x1000":{"0x0000":["UL","1","CodeTableGroupLength"],"0x0010":["US","3","EscapeTriplet"],"0x0011":["US","3","RunLengthTriplet"],"0x0012":["US","1","HuffmanTableSize"],"0x0013":["US","3","HuffmanTableTriplet"],"0x0014":["US","1","ShiftTableSize"],"0x0015":["US","3","ShiftTableTriplet"]},"0x1010":{"0x0000":["UL","1","ZonalMapGroupLength"],"0x0004":["US","1-n","ZonalMap"]},"0x2000":{"0x0000":["UL","1","FilmSessionGroupLength"],"0x0010":["IS","1","NumberOfCopies"],"0x001E":["SQ","1","PrinterConfigurationSequence"],"0x0020":["CS","1","PrintPriority"],"0x0030":["CS","1","MediumType"],"0x0040":["CS","1","FilmDestination"],"0x0050":["LO","1","FilmSessionLabel"],"0x0060":["IS","1","MemoryAllocation"],"0x0061":["IS","1","MaximumMemoryAllocation"],"0x0062":["CS","1","ColorImagePrintingFlag"],"0x0063":["CS","1","CollationFlag"],"0x0065":["CS","1","AnnotationFlag"],"0x0067":["CS","1","ImageOverlayFlag"],"0x0069":["CS","1","PresentationLUTFlag"],"0x006A":["CS","1","ImageBoxPresentationLUTFlag"],"0x00A0":["US","1","MemoryBitDepth"],"0x00A1":["US","1","PrintingBitDepth"],"0x00A2":["SQ","1","MediaInstalledSequence"],"0x00A4":["SQ","1","OtherMediaAvailableSequence"],"0x00A8":["SQ","1","SupportedImageDisplayFormatsSequence"],"0x0500":["SQ","1","ReferencedFilmBoxSequence"],"0x0510":["SQ","1","ReferencedStoredPrintSequence"]},"0x2010":{"0x0000":["UL","1","FilmBoxGroupLength"],"0x0010":["ST","1","ImageDisplayFormat"],"0x0030":["CS","1","AnnotationDisplayFormatID"],"0x0040":["CS","1","FilmOrientation"],"0x0050":["CS","1","FilmSizeID"],"0x0052":["CS","1","PrinterResolutionID"],"0x0054":["CS","1","DefaultPrinterResolutionID"],"0x0060":["CS","1","MagnificationType"],"0x0080":["CS","1","SmoothingType"],"0x00A6":["CS","1","DefaultMagnificationType"],"0x00A7":["CS","1-n","OtherMagnificationTypesAvailable"],"0x00A8":["CS","1","DefaultSmoothingType"],"0x00A9":["CS","1-n","OtherSmoothingTypesAvailable"],"0x0100":["CS","1","BorderDensity"],"0x0110":["CS","1","EmptyImageDensity"],"0x0120":["US","1","MinDensity"],"0x0130":["US","1","MaxDensity"],"0x0140":["CS","1","Trim"],"0x0150":["ST","1","ConfigurationInformation"],"0x0152":["LT","1","ConfigurationInformationDescription"],"0x0154":["IS","1","MaximumCollatedFilms"],"0x015E":["US","1","Illumination"],"0x0160":["US","1","ReflectedAmbientLight"],"0x0376":["DS","2","PrinterPixelSpacing"],"0x0500":["SQ","1","ReferencedFilmSessionSequence"],"0x0510":["SQ","1","ReferencedImageBoxSequence"],"0x0520":["SQ","1","ReferencedBasicAnnotationBoxSequence"]},"0x2020":{"0x0000":["UL","1","ImageBoxGroupLength"],"0x0010":["US","1","ImageBoxPosition"],"0x0020":["CS","1","Polarity"],"0x0030":["DS","1","RequestedImageSize"],"0x0040":["CS","1","RequestedDecimateCropBehavior"],"0x0050":["CS","1","RequestedResolutionID"],"0x00A0":["CS","1","RequestedImageSizeFlag"],"0x00A2":["CS","1","DecimateCropResult"],"0x0110":["SQ","1","PreformattedGrayscaleImageSequence"],"0x0111":["SQ","1","PreformattedColorImageSequence"],"0x0130":["SQ","1","ReferencedImageOverlayBoxSequence"],"0x0140":["SQ","1","ReferencedVOILUTBoxSequence"]},"0x2030":{"0x0000":["UL","1","AnnotationGroupLength"],"0x0010":["US","1","AnnotationPosition"],"0x0020":["LO","1","TextString"]},"0x2040":{"0x0000":["UL","1","OverlayBoxGroupLength"],"0x0010":["SQ","1","ReferencedOverlayPlaneSequence"],"0x0011":["US","9","ReferencedOverlayPlaneGroups"],"0x0020":["SQ","1","OverlayPixelDataSequence"],"0x0060":["CS","1","OverlayMagnificationType"],"0x0070":["CS","1","OverlaySmoothingType"],"0x0072":["CS","1","OverlayOrImageMagnification"],"0x0074":["US","1","MagnifyToNumberOfColumns"],"0x0080":["CS","1","OverlayForegroundDensity"],"0x0082":["CS","1","OverlayBackgroundDensity"],"0x0090":["CS","1","OverlayMode"],"0x0100":["CS","1","ThresholdDensity"],"0x0500":["SQ","1","ReferencedOverlayImageBoxSequence"]},"0x2050":{"0x0000":["UL","1","PresentationLUTGroupLength"],"0x0010":["SQ","1","PresentationLUTSequence"],"0x0020":["CS","1","PresentationLUTShape"],"0x0500":["SQ","1","ReferencedPresentationLUTSequence"]},"0x2100":{"0x0000":["UL","1","PrintJobGroupLength"],"0x0010":["SH","1","PrintJobID"],"0x0020":["CS","1","ExecutionStatus"],"0x0030":["CS","1","ExecutionStatusInfo"],"0x0040":["DA","1","CreationDate"],"0x0050":["TM","1","CreationTime"],"0x0070":["AE","1","Originator"],"0x0140":["AE","1","DestinationAE"],"0x0160":["SH","1","OwnerID"],"0x0170":["IS","1","NumberOfFilms"],"0x0500":["SQ","1","ReferencedPrintJobSequence"]},"0x2110":{"0x0000":["UL","1","PrinterGroupLength"],"0x0010":["CS","1","PrinterStatus"],"0x0020":["CS","1","PrinterStatusInfo"],"0x0030":["LO","1","PrinterName"],"0x0099":["SH","1","PrintQueueID"]},"0x2120":{"0x0000":["UL","1","QueueGroupLength"],"0x0010":["CS","1","QueueStatus"],"0x0050":["SQ","1","PrintJobDescriptionSequence"],"0x0070":["SQ","1","QueueReferencedPrintJobSequence"]},"0x2130":{"0x0000":["UL","1","PrintContentGroupLength"],"0x0010":["SQ","1","PrintManagementCapabilitiesSequence"],"0x0015":["SQ","1","PrinterCharacteristicsSequence"],"0x0030":["SQ","1","FilmBoxContentSequence"],"0x0040":["SQ","1","ImageBoxContentSequence"],"0x0050":["SQ","1","AnnotationContentSequence"],"0x0060":["SQ","1","ImageOverlayBoxContentSequence"],"0x0080":["SQ","1","PresentationLUTContentSequence"],"0x00A0":["SQ","1","ProposedStudySequence"],"0x00C0":["SQ","1","OriginalImageSequence"]},"0x3002":{"0x0000":["UL","1","RTImageGroupLength"],"0x0002":["SH","1","RTImageLabel"],"0x0003":["LO","1","RTImageName"],"0x0004":["ST","1","RTImageDescription"],"0x000A":["CS","1","ReportedValuesOrigin"],"0x000C":["CS","1","RTImagePlane"],"0x000D":["DS","3","XRayImageReceptorTranslation"],"0x000E":["DS","1","XRayImageReceptorAngle"],"0x0010":["DS","6","RTImageOrientation"],"0x0011":["DS","2","ImagePlanePixelSpacing"],"0x0012":["DS","2","RTImagePosition"],"0x0020":["SH","1","RadiationMachineName"],"0x0022":["DS","1","RadiationMachineSAD"],"0x0024":["DS","1","RadiationMachineSSD"],"0x0026":["DS","1","RTImageSID"],"0x0028":["DS","1","SourceToReferenceObjectDistance"],"0x0029":["IS","1","FractionNumber"],"0x0030":["SQ","1","ExposureSequence"],"0x0032":["DS","1","MetersetExposure"],"0x0034":["DS","4","DiaphragmPosition"]},"0x3004":{"0x0000":["UL","1","RTDoseGroupLength"],"0x0001":["CS","1","DVHType"],"0x0002":["CS","1","DoseUnits"],"0x0004":["CS","1","DoseType"],"0x0006":["LO","1","DoseComment"],"0x0008":["DS","3","NormalizationPoint"],"0x000A":["CS","1","DoseSummationType"],"0x000C":["DS","2-n","GridFrameOffsetVector"],"0x000E":["DS","1","DoseGridScaling"],"0x0010":["SQ","1","RTDoseROISequence"],"0x0012":["DS","1","DoseValue"],"0x0040":["DS","3","DVHNormalizationPoint"],"0x0042":["DS","1","DVHNormalizationDoseValue"],"0x0050":["SQ","1","DVHSequence"],"0x0052":["DS","1","DVHDoseScaling"],"0x0054":["CS","1","DVHVolumeUnits"],"0x0056":["IS","1","DVHNumberOfBins"],"0x0058":["DS","2-2n","DVHData"],"0x0060":["SQ","1","DVHReferencedROISequence"],"0x0062":["CS","1","DVHROIContributionType"],"0x0070":["DS","1","DVHMinimumDose"],"0x0072":["DS","1","DVHMaximumDose"],"0x0074":["DS","1","DVHMeanDose"]},"0x3006":{"0x0000":["UL","1","RTStructureSetGroupLength"],"0x0002":["SH","1","StructureSetLabel"],"0x0004":["LO","1","StructureSetName"],"0x0006":["ST","1","StructureSetDescription"],"0x0008":["DA","1","StructureSetDate"],"0x0009":["TM","1","StructureSetTime"],"0x0010":["SQ","1","ReferencedFrameOfReferenceSequence"],"0x0012":["SQ","1","RTReferencedStudySequence"],"0x0014":["SQ","1","RTReferencedSeriesSequence"],"0x0016":["SQ","1","ContourImageSequence"],"0x0020":["SQ","1","StructureSetROISequence"],"0x0022":["IS","1","ROINumber"],"0x0024":["UI","1","ReferencedFrameOfReferenceUID"],"0x0026":["LO","1","ROIName"],"0x0028":["ST","1","ROIDescription"],"0x002A":["IS","3","ROIDisplayColor"],"0x002C":["DS","1","ROIVolume"],"0x0030":["SQ","1","RTRelatedROISequence"],"0x0033":["CS","1","RTROIRelationship"],"0x0036":["CS","1","ROIGenerationAlgorithm"],"0x0038":["LO","1","ROIGenerationDescription"],"0x0039":["SQ","1","ROIContourSequence"],"0x0040":["SQ","1","ContourSequence"],"0x0042":["CS","1","ContourGeometricType"],"0x0044":["DS","1","ContourSlabThickness"],"0x0045":["DS","3","ContourOffsetVector"],"0x0046":["IS","1","NumberOfContourPoints"],"0x0048":["IS","1","ContourNumber"],"0x0049":["IS","1-n","AttachedContours"],"0x0050":["DS","3-3n","ContourData"],"0x0080":["SQ","1","RTROIObservationsSequence"],"0x0082":["IS","1","ObservationNumber"],"0x0084":["IS","1","ReferencedROINumber"],"0x0085":["SH","1","ROIObservationLabel"],"0x0086":["SQ","1","RTROIIdentificationCodeSequence"],"0x0088":["ST","1","ROIObservationDescription"],"0x00A0":["SQ","1","RelatedRTROIObservationsSequence"],"0x00A4":["CS","1","RTROIInterpretedType"],"0x00A6":["PN","1","ROIInterpreter"],"0x00B0":["SQ","1","ROIPhysicalPropertiesSequence"],"0x00B2":["CS","1","ROIPhysicalProperty"],"0x00B4":["DS","1","ROIPhysicalPropertyValue"],"0x00C0":["SQ","1","FrameOfReferenceRelationshipSequence"],"0x00C2":["UI","1","RelatedFrameOfReferenceUID"],"0x00C4":["CS","1","FrameOfReferenceTransformationType"],"0x00C6":["DS","16","FrameOfReferenceTransformationMatrix"],"0x00C8":["LO","1","FrameOfReferenceTransformationComment"]},"0x3008":{"0x0010":["SQ","1","MeasuredDoseReferenceSequence"],"0x0012":["ST","1","MeasuredDoseDescription"],"0x0014":["CS","1","MeasuredDoseType"],"0x0016":["DS","1","MeasuredDoseValue"],"0x0020":["SQ","1","TreatmentSessionBeamSequence"],"0x0022":["IS","1","CurrentFractionNumber"],"0x0024":["DA","1","TreatmentControlPointDate"],"0x0025":["TM","1","TreatmentControlPointTime"],"0x002A":["CS","1","TreatmentTerminationStatus"],"0x002B":["SH","1","TreatmentTerminationCode"],"0x002C":["CS","1","TreatmentVerificationStatus"],"0x0030":["SQ","1","ReferencedTreatmentRecordSequence"],"0x0032":["DS","1","SpecifiedPrimaryMeterset"],"0x0033":["DS","1","SpecifiedSecondaryMeterset"],"0x0036":["DS","1","DeliveredPrimaryMeterset"],"0x0037":["DS","1","DeliveredSecondaryMeterset"],"0x003A":["DS","1","SpecifiedTreatmentTime"],"0x003B":["DS","1","DeliveredTreatmentTime"],"0x0040":["SQ","1","ControlPointDeliverySequence"],"0x0042":["DS","1","SpecifiedMeterset"],"0x0044":["DS","1","DeliveredMeterset"],"0x0048":["DS","1","DoseRateDelivered"],"0x0050":["SQ","1","TreatmentSummaryCalculatedDoseReferenceSequence"],"0x0052":["DS","1","CumulativeDosetoDoseReference"],"0x0054":["DA","1","FirstTreatmentDate"],"0x0056":["DA","1","MostRecentTreatmentDate"],"0x005A":["IS","1","NumberofFractionsDelivered"],"0x0060":["SQ","1","OverrideSequence"],"0x0062":["AT","1","OverrideParameterPointer"],"0x0064":["IS","1","MeasuredDoseReferenceNumber"],"0x0066":["ST","1","OverrideReason"],"0x0070":["SQ","1","CalculatedDoseReferenceSequence"],"0x0072":["IS","1","CalculatedDoseReferenceNumber"],"0x0074":["ST","1","CalculatedDoseReferenceDescription"],"0x0076":["DS","1","CalculatedDoseReferenceDoseValue"],"0x0078":["DS","1","StartMeterset"],"0x007A":["DS","1","EndMeterset"],"0x0080":["SQ","1","ReferencedMeasuredDoseReferenceSequence"],"0x0082":["IS","1","ReferencedMeasuredDoseReferenceNumber"],"0x0090":["SQ","1","ReferencedCalculatedDoseReferenceSequence"],"0x0092":["IS","1","ReferencedCalculatedDoseReferenceNumber"],"0x00A0":["SQ","1","BeamLimitingDeviceLeafPairsSequence"],"0x00B0":["SQ","1","RecordedWedgeSequence"],"0x00C0":["SQ","1","RecordedCompensatorSequence"],"0x00D0":["SQ","1","RecordedBlockSequence"],"0x00E0":["SQ","1","TreatmentSummaryMeasuredDoseReferenceSequence"],"0x0100":["SQ","1","RecordedSourceSequence"],"0x0105":["LO","1","SourceSerialNumber"],"0x0110":["SQ","1","TreatmentSessionApplicationSetupSequence"],"0x0116":["CS","1","ApplicationSetupCheck"],"0x0120":["SQ","1","RecordedBrachyAccessoryDeviceSequence"],"0x0122":["IS","1","ReferencedBrachyAccessoryDeviceNumber"],"0x0130":["SQ","1","RecordedChannelSequence"],"0x0132":["DS","1","SpecifiedChannelTotalTime"],"0x0134":["DS","1","DeliveredChannelTotalTime"],"0x0136":["IS","1","SpecifiedNumberofPulses"],"0x0138":["IS","1","DeliveredNumberofPulses"],"0x013A":["DS","1","SpecifiedPulseRepetitionInterval"],"0x013C":["DS","1","DeliveredPulseRepetitionInterval"],"0x0140":["SQ","1","RecordedSourceApplicatorSequence"],"0x0142":["IS","1","ReferencedSourceApplicatorNumber"],"0x0150":["SQ","1","RecordedChannelShieldSequence"],"0x0152":["IS","1","ReferencedChannelShieldNumber"],"0x0160":["SQ","1","BrachyControlPointDeliveredSequence"],"0x0162":["DA","1","SafePositionExitDate"],"0x0164":["TM","1","SafePositionExitTime"],"0x0166":["DA","1","SafePositionReturnDate"],"0x0168":["TM","1","SafePositionReturnTime"],"0x0200":["CS","1","CurrentTreatmentStatus"],"0x0202":["ST","1","TreatmentStatusComment"],"0x0220":["SQ","1","FractionGroupSummarySequence"],"0x0223":["IS","1","ReferencedFractionNumber"],"0x0224":["CS","1","FractionGroupType"],"0x0230":["CS","1","BeamStopperPosition"],"0x0240":["SQ","1","FractionStatusSummarySequence"],"0x0250":["DA","1","TreatmentDate"],"0x0251":["TM","1","TreatmentTime"]},"0x300A":{"0x0000":["UL","1","RTPlanGroupLength"],"0x0002":["SH","1","RTPlanLabel"],"0x0003":["LO","1","RTPlanName"],"0x0004":["ST","1","RTPlanDescription"],"0x0006":["DA","1","RTPlanDate"],"0x0007":["TM","1","RTPlanTime"],"0x0009":["LO","1-n","TreatmentProtocols"],"0x000A":["CS","1","TreatmentIntent"],"0x000B":["LO","1-n","TreatmentSites"],"0x000C":["CS","1","RTPlanGeometry"],"0x000E":["ST","1","PrescriptionDescription"],"0x0010":["SQ","1","DoseReferenceSequence"],"0x0012":["IS","1","DoseReferenceNumber"],"0x0014":["CS","1","DoseReferenceStructureType"],"0x0015":["CS","1","NominalBeamEnergyUnit"],"0x0016":["LO","1","DoseReferenceDescription"],"0x0018":["DS","3","DoseReferencePointCoordinates"],"0x001A":["DS","1","NominalPriorDose"],"0x0020":["CS","1","DoseReferenceType"],"0x0021":["DS","1","ConstraintWeight"],"0x0022":["DS","1","DeliveryWarningDose"],"0x0023":["DS","1","DeliveryMaximumDose"],"0x0025":["DS","1","TargetMinimumDose"],"0x0026":["DS","1","TargetPrescriptionDose"],"0x0027":["DS","1","TargetMaximumDose"],"0x0028":["DS","1","TargetUnderdoseVolumeFraction"],"0x002A":["DS","1","OrganAtRiskFullVolumeDose"],"0x002B":["DS","1","OrganAtRiskLimitDose"],"0x002C":["DS","1","OrganAtRiskMaximumDose"],"0x002D":["DS","1","OrganAtRiskOverdoseVolumeFraction"],"0x0040":["SQ","1","ToleranceTableSequence"],"0x0042":["IS","1","ToleranceTableNumber"],"0x0043":["SH","1","ToleranceTableLabel"],"0x0044":["DS","1","GantryAngleTolerance"],"0x0046":["DS","1","BeamLimitingDeviceAngleTolerance"],"0x0048":["SQ","1","BeamLimitingDeviceToleranceSequence"],"0x004A":["DS","1","BeamLimitingDevicePositionTolerance"],"0x004C":["DS","1","PatientSupportAngleTolerance"],"0x004E":["DS","1","TableTopEccentricAngleTolerance"],"0x0051":["DS","1","TableTopVerticalPositionTolerance"],"0x0052":["DS","1","TableTopLongitudinalPositionTolerance"],"0x0053":["DS","1","TableTopLateralPositionTolerance"],"0x0055":["CS","1","RTPlanRelationship"],"0x0070":["SQ","1","FractionGroupSequence"],"0x0071":["IS","1","FractionGroupNumber"],"0x0078":["IS","1","NumberOfFractionsPlanned"],"0x0079":["IS","1","NumberOfFractionsPatternDigistsPerDay"],"0x007A":["IS","1","RepeatFractionCycleLength"],"0x007B":["LT","1","FractionPattern"],"0x0080":["IS","1","NumberOfBeams"],"0x0082":["DS","3","BeamDoseSpecificationPoint"],"0x0084":["DS","1","BeamDose"],"0x0086":["DS","1","BeamMeterset"],"0x00A0":["IS","1","NumberOfBrachyApplicationSetups"],"0x00A2":["DS","3","BrachyApplicationSetupDoseSpecificationPoint"],"0x00A4":["DS","1","BrachyApplicationSetupDose"],"0x00B0":["SQ","1","BeamSequence"],"0x00B2":["SH","1","TreatmentMachineName"],"0x00B3":["CS","1","PrimaryDosimeterUnit"],"0x00B4":["DS","1","SourceAxisDistance"],"0x00B6":["SQ","1","BeamLimitingDeviceSequence"],"0x00B8":["CS","1","RTBeamLimitingDeviceType"],"0x00BA":["DS","1","SourceToBeamLimitingDeviceDistance"],"0x00BC":["IS","1","NumberOfLeafJawPairs"],"0x00BE":["DS","3-n","LeafPositionBoundaries"],"0x00C0":["IS","1","BeamNumber"],"0x00C2":["LO","1","BeamName"],"0x00C3":["ST","1","BeamDescription"],"0x00C4":["CS","1","BeamType"],"0x00C6":["CS","1","RadiationType"],"0x00C8":["IS","1","ReferenceImageNumber"],"0x00CA":["SQ","1","PlannedVerificationImageSequence"],"0x00CC":["LO","1-n","ImagingDeviceSpecificAcquisitionParameters"],"0x00CE":["CS","1","TreatmentDeliveryType"],"0x00D0":["IS","1","NumberOfWedges"],"0x00D1":["SQ","1","WedgeSequence"],"0x00D2":["IS","1","WedgeNumber"],"0x00D3":["CS","1","WedgeType"],"0x00D4":["SH","1","WedgeID"],"0x00D5":["IS","1","WedgeAngle"],"0x00D6":["DS","1","WedgeFactor"],"0x00D8":["DS","1","WedgeOrientation"],"0x00DA":["DS","1","SourceToWedgeTrayDistance"],"0x00E0":["IS","1","NumberOfCompensators"],"0x00E1":["SH","1","MaterialID"],"0x00E2":["DS","1","TotalCompensatorTrayFactor"],"0x00E3":["SQ","1","CompensatorSequence"],"0x00E4":["IS","1","CompensatorNumber"],"0x00E5":["SH","1","CompensatorID"],"0x00E6":["DS","1","SourceToCompensatorTrayDistance"],"0x00E7":["IS","1","CompensatorRows"],"0x00E8":["IS","1","CompensatorColumns"],"0x00E9":["DS","2","CompensatorPixelSpacing"],"0x00EA":["DS","2","CompensatorPosition"],"0x00EB":["DS","1-n","CompensatorTransmissionData"],"0x00EC":["DS","1-n","CompensatorThicknessData"],"0x00ED":["IS","1","NumberOfBoli"],"0x00EE":["CS","1","CompensatorType"],"0x00F0":["IS","1","NumberOfBlocks"],"0x00F2":["DS","1","TotalBlockTrayFactor"],"0x00F4":["SQ","1","BlockSequence"],"0x00F5":["SH","1","BlockTrayID"],"0x00F6":["DS","1","SourceToBlockTrayDistance"],"0x00F8":["CS","1","BlockType"],"0x00FA":["CS","1","BlockDivergence"],"0x00FC":["IS","1","BlockNumber"],"0x00FE":["LO","1","BlockName"],"0x0100":["DS","1","BlockThickness"],"0x0102":["DS","1","BlockTransmission"],"0x0104":["IS","1","BlockNumberOfPoints"],"0x0106":["DS","2-2n","BlockData"],"0x0107":["SQ","1","ApplicatorSequence"],"0x0108":["SH","1","ApplicatorID"],"0x0109":["CS","1","ApplicatorType"],"0x010A":["LO","1","ApplicatorDescription"],"0x010C":["DS","1","CumulativeDoseReferenceCoefficient"],"0x010E":["DS","1","FinalCumulativeMetersetWeight"],"0x0110":["IS","1","NumberOfControlPoints"],"0x0111":["SQ","1","ControlPointSequence"],"0x0112":["IS","1","ControlPointIndex"],"0x0114":["DS","1","NominalBeamEnergy"],"0x0115":["DS","1","DoseRateSet"],"0x0116":["SQ","1","WedgePositionSequence"],"0x0118":["CS","1","WedgePosition"],"0x011A":["SQ","1","BeamLimitingDevicePositionSequence"],"0x011C":["DS","2-2n","LeafJawPositions"],"0x011E":["DS","1","GantryAngle"],"0x011F":["CS","1","GantryRotationDirection"],"0x0120":["DS","1","BeamLimitingDeviceAngle"],"0x0121":["CS","1","BeamLimitingDeviceRotationDirection"],"0x0122":["DS","1","PatientSupportAngle"],"0x0123":["CS","1","PatientSupportRotationDirection"],"0x0124":["DS","1","TableTopEccentricAxisDistance"],"0x0125":["DS","1","TableTopEccentricAngle"],"0x0126":["CS","1","TableTopEccentricRotationDirection"],"0x0128":["DS","1","TableTopVerticalPosition"],"0x0129":["DS","1","TableTopLongitudinalPosition"],"0x012A":["DS","1","TableTopLateralPosition"],"0x012C":["DS","3","IsocenterPosition"],"0x012E":["DS","3","SurfaceEntryPoint"],"0x0130":["DS","1","SourceToSurfaceDistance"],"0x0134":["DS","1","CumulativeMetersetWeight"],"0x0140":["FL","1","TableTopPitchAngle"],"0x0142":["CS","1","TableTopPitchRotationDirection"],"0x0144":["FL","1","TableTopRollAngle"],"0x0146":["CS","1","TableTopRollRotationDirection"],"0x0148":["FL","1","HeadFixationAngle"],"0x014A":["FL","1","GantryPitchAngle"],"0x014C":["CS","1","GantryPitchRotationDirection"],"0x014E":["FL","1","GantryPitchAngleTolerance"],"0x0180":["SQ","1","PatientSetupSequence"],"0x0182":["IS","1","PatientSetupNumber"],"0x0184":["LO","1","PatientAdditionalPosition"],"0x0190":["SQ","1","FixationDeviceSequence"],"0x0192":["CS","1","FixationDeviceType"],"0x0194":["SH","1","FixationDeviceLabel"],"0x0196":["ST","1","FixationDeviceDescription"],"0x0198":["SH","1","FixationDevicePosition"],"0x01A0":["SQ","1","ShieldingDeviceSequence"],"0x01A2":["CS","1","ShieldingDeviceType"],"0x01A4":["SH","1","ShieldingDeviceLabel"],"0x01A6":["ST","1","ShieldingDeviceDescription"],"0x01A8":["SH","1","ShieldingDevicePosition"],"0x01B0":["CS","1","SetupTechnique"],"0x01B2":["ST","1","SetupTechniqueDescription"],"0x01B4":["SQ","1","SetupDeviceSequence"],"0x01B6":["CS","1","SetupDeviceType"],"0x01B8":["SH","1","SetupDeviceLabel"],"0x01BA":["ST","1","SetupDeviceDescription"],"0x01BC":["DS","1","SetupDeviceParameter"],"0x01D0":["ST","1","SetupReferenceDescription"],"0x01D2":["DS","1","TableTopVerticalSetupDisplacement"],"0x01D4":["DS","1","TableTopLongitudinalSetupDisplacement"],"0x01D6":["DS","1","TableTopLateralSetupDisplacement"],"0x0200":["CS","1","BrachyTreatmentTechnique"],"0x0202":["CS","1","BrachyTreatmentType"],"0x0206":["SQ","1","TreatmentMachineSequence"],"0x0210":["SQ","1","SourceSequence"],"0x0212":["IS","1","SourceNumber"],"0x0214":["CS","1","SourceType"],"0x0216":["LO","1","SourceManufacturer"],"0x0218":["DS","1","ActiveSourceDiameter"],"0x021A":["DS","1","ActiveSourceLength"],"0x0222":["DS","1","SourceEncapsulationNominalThickness"],"0x0224":["DS","1","SourceEncapsulationNominalTransmission"],"0x0226":["LO","1","SourceIsotopeName"],"0x0228":["DS","1","SourceIsotopeHalfLife"],"0x022A":["DS","1","ReferenceAirKermaRate"],"0x022C":["DA","1","AirKermaRateReferenceDate"],"0x022E":["TM","1","AirKermaRateReferenceTime"],"0x0230":["SQ","1","ApplicationSetupSequence"],"0x0232":["CS","1","ApplicationSetupType"],"0x0234":["IS","1","ApplicationSetupNumber"],"0x0236":["LO","1","ApplicationSetupName"],"0x0238":["LO","1","ApplicationSetupManufacturer"],"0x0240":["IS","1","TemplateNumber"],"0x0242":["SH","1","TemplateType"],"0x0244":["LO","1","TemplateName"],"0x0250":["DS","1","TotalReferenceAirKerma"],"0x0260":["SQ","1","BrachyAccessoryDeviceSequence"],"0x0262":["IS","1","BrachyAccessoryDeviceNumber"],"0x0263":["SH","1","BrachyAccessoryDeviceID"],"0x0264":["CS","1","BrachyAccessoryDeviceType"],"0x0266":["LO","1","BrachyAccessoryDeviceName"],"0x026A":["DS","1","BrachyAccessoryDeviceNominalThickness"],"0x026C":["DS","1","BrachyAccessoryDeviceNominalTransmission"],"0x0280":["SQ","1","ChannelSequence"],"0x0282":["IS","1","ChannelNumber"],"0x0284":["DS","1","ChannelLength"],"0x0286":["DS","1","ChannelTotalTime"],"0x0288":["CS","1","SourceMovementType"],"0x028A":["IS","1","NumberOfPulses"],"0x028C":["DS","1","PulseRepetitionInterval"],"0x0290":["IS","1","SourceApplicatorNumber"],"0x0291":["SH","1","SourceApplicatorID"],"0x0292":["CS","1","SourceApplicatorType"],"0x0294":["LO","1","SourceApplicatorName"],"0x0296":["DS","1","SourceApplicatorLength"],"0x0298":["LO","1","SourceApplicatorManufacturer"],"0x029C":["DS","1","SourceApplicatorWallNominalThickness"],"0x029E":["DS","1","SourceApplicatorWallNominalTransmission"],"0x02A0":["DS","1","SourceApplicatorStepSize"],"0x02A2":["IS","1","TransferTubeNumber"],"0x02A4":["DS","1","TransferTubeLength"],"0x02B0":["SQ","1","ChannelShieldSequence"],"0x02B2":["IS","1","ChannelShieldNumber"],"0x02B3":["SH","1","ChannelShieldID"],"0x02B4":["LO","1","ChannelShieldName"],"0x02B8":["DS","1","ChannelShieldNominalThickness"],"0x02BA":["DS","1","ChannelShieldNominalTransmission"],"0x02C8":["DS","1","FinalCumulativeTimeWeight"],"0x02D0":["SQ","1","BrachyControlPointSequence"],"0x02D2":["DS","1","ControlPointRelativePosition"],"0x02D4":["DS","3","ControlPointDPosition"],"0x02D6":["DS","1","CumulativeTimeWeight"]},"0x300C":{"0x0000":["UL","1","RTRelationshipGroupLength"],"0x0002":["SQ","1","ReferencedRTPlanSequence"],"0x0004":["SQ","1","ReferencedBeamSequence"],"0x0006":["IS","1","ReferencedBeamNumber"],"0x0007":["IS","1","ReferencedReferenceImageNumber"],"0x0008":["DS","1","StartCumulativeMetersetWeight"],"0x0009":["DS","1","EndCumulativeMetersetWeight"],"0x000A":["SQ","1","ReferencedBrachyApplicationSetupSequence"],"0x000C":["IS","1","ReferencedBrachyApplicationSetupNumber"],"0x000E":["IS","1","ReferencedSourceNumber"],"0x0020":["SQ","1","ReferencedFractionGroupSequence"],"0x0022":["IS","1","ReferencedFractionGroupNumber"],"0x0040":["SQ","1","ReferencedVerificationImageSequence"],"0x0042":["SQ","1","ReferencedReferenceImageSequence"],"0x0050":["SQ","1","ReferencedDoseReferenceSequence"],"0x0051":["IS","1","ReferencedDoseReferenceNumber"],"0x0055":["SQ","1","BrachyReferencedDoseReferenceSequence"],"0x0060":["SQ","1","ReferencedStructureSetSequence"],"0x006A":["IS","1","ReferencedPatientSetupNumber"],"0x0080":["SQ","1","ReferencedDoseSequence"],"0x00A0":["IS","1","ReferencedToleranceTableNumber"],"0x00B0":["SQ","1","ReferencedBolusSequence"],"0x00C0":["IS","1","ReferencedWedgeNumber"],"0x00D0":["IS","1","ReferencedCompensatorNumber"],"0x00E0":["IS","1","ReferencedBlockNumber"],"0x00F0":["IS","1","ReferencedControlPointIndex"]},"0x300E":{"0x0000":["UL","1","RTApprovalGroupLength"],"0x0002":["CS","1","ApprovalStatus"],"0x0004":["DA","1","ReviewDate"],"0x0005":["TM","1","ReviewTime"],"0x0008":["PN","1","ReviewerName"]},"0x4000":{"0x0000":["UL","1","TextGroupLength"],"0x0010":["LT","1-n","TextArbitrary"],"0x4000":["LT","1-n","TextComments"]},"0x4008":{"0x0000":["UL","1","ResultsGroupLength"],"0x0040":["SH","1","ResultsID"],"0x0042":["LO","1","ResultsIDIssuer"],"0x0050":["SQ","1","ReferencedInterpretationSequence"],"0x0100":["DA","1","InterpretationRecordedDate"],"0x0101":["TM","1","InterpretationRecordedTime"],"0x0102":["PN","1","InterpretationRecorder"],"0x0103":["LO","1","ReferenceToRecordedSound"],"0x0108":["DA","1","InterpretationTranscriptionDate"],"0x0109":["TM","1","InterpretationTranscriptionTime"],"0x010A":["PN","1","InterpretationTranscriber"],"0x010B":["ST","1","InterpretationText"],"0x010C":["PN","1","InterpretationAuthor"],"0x0111":["SQ","1","InterpretationApproverSequence"],"0x0112":["DA","1","InterpretationApprovalDate"],"0x0113":["TM","1","InterpretationApprovalTime"],"0x0114":["PN","1","PhysicianApprovingInterpretation"],"0x0115":["LT","1","InterpretationDiagnosisDescription"],"0x0117":["SQ","1","DiagnosisCodeSequence"],"0x0118":["SQ","1","ResultsDistributionListSequence"],"0x0119":["PN","1","DistributionName"],"0x011A":["LO","1","DistributionAddress"],"0x0200":["SH","1","InterpretationID"],"0x0202":["LO","1","InterpretationIDIssuer"],"0x0210":["CS","1","InterpretationTypeID"],"0x0212":["CS","1","InterpretationStatusID"],"0x0300":["ST","1","Impressions"],"0x4000":["ST","1","ResultsComments"]},"0x5000":{"0x0000":["UL","1","CurveGroupLength"],"0x0005":["US","1","CurveDimensions"],"0x0010":["US","1","NumberOfPoints"],"0x0020":["CS","1","TypeOfData"],"0x0022":["LO","1","CurveDescription"],"0x0030":["SH","1-n","AxisUnits"],"0x0040":["SH","1-n","AxisLabels"],"0x0103":["US","1","DataValueRepresentation"],"0x0104":["US","1-n","MinimumCoordinateValue"],"0x0105":["US","1-n","MaximumCoordinateValue"],"0x0106":["SH","1-n","CurveRange"],"0x0110":["US","1","CurveDataDescriptor"],"0x0112":["US","1","CoordinateStartValue"],"0x0114":["US","1","CoordinateStepValue"],"0x2000":["US","1","AudioType"],"0x2002":["US","1","AudioSampleFormat"],"0x2004":["US","1","NumberOfChannels"],"0x2006":["UL","1","NumberOfSamples"],
"0x2008":["UL","1","SampleRate"],"0x200A":["UL","1","TotalTime"],"0x200C":["OX","1","AudioSampleData"],"0x200E":["LT","1","AudioComments"],"0x3000":["OX","1","CurveData"]},"0x5400":{"0x0100":["SQ","1","WaveformSequence"],"0x0110":["OW/OB","1","ChannelMinimumValue"],"0x0112":["OW/OB","1","ChannelMaximumValue"],"0x1004":["US","1","WaveformBitsAllocated"],"0x1006":["CS","1","WaveformSampleInterpretation"],"0x100A":["OW/OB","1","WaveformPaddingValue"],"0x1010":["OW/OB","1","WaveformData"]},"0x6000":{"0x0000":["UL","1","OverlayGroupLength"],"0x0010":["US","1","OverlayRows"],"0x0011":["US","1","OverlayColumns"],"0x0012":["US","1","OverlayPlanes"],"0x0015":["IS","1","OverlayNumberOfFrames"],"0x0040":["CS","1","OverlayType"],"0x0050":["SS","2","OverlayOrigin"],"0x0051":["US","1","OverlayImageFrameOrigin"],"0x0052":["US","1","OverlayPlaneOrigin"],"0x0060":["CS","1","OverlayCompressionCode"],"0x0061":["SH","1","OverlayCompressionOriginator"],"0x0062":["SH","1","OverlayCompressionLabel"],"0x0063":["SH","1","OverlayCompressionDescription"],"0x0066":["AT","1-n","OverlayCompressionStepPointers"],"0x0068":["US","1","OverlayRepeatInterval"],"0x0069":["US","1","OverlayBitsGrouped"],"0x0100":["US","1","OverlayBitsAllocated"],"0x0102":["US","1","OverlayBitPosition"],"0x0110":["CS","1","OverlayFormat"],"0x0200":["US","1","OverlayLocation"],"0x0800":["CS","1-n","OverlayCodeLabel"],"0x0802":["US","1","OverlayNumberOfTables"],"0x0803":["AT","1-n","OverlayCodeTableLocation"],"0x0804":["US","1","OverlayBitsForCodeWord"],"0x1100":["US","1","OverlayDescriptorGray"],"0x1101":["US","1","OverlayDescriptorRed"],"0x1102":["US","1","OverlayDescriptorGreen"],"0x1103":["US","1","OverlayDescriptorBlue"],"0x1200":["US","1-n","OverlayGray"],"0x1201":["US","1-n","OverlayRed"],"0x1202":["US","1-n","OverlayGreen"],"0x1203":["US","1-n","OverlayBlue"],"0x1301":["IS","1","ROIArea"],"0x1302":["DS","1","ROIMean"],"0x1303":["DS","1","ROIStandardDeviation"],"0x3000":["OW","1","OverlayData"],"0x4000":["LT","1-n","OverlayComments"]},"0x7F00":{"0x0000":["UL","1","VariablePixelDataGroupLength"],"0x0010":["OX","1","VariablePixelData"],"0x0011":["AT","1","VariableNextDataGroup"],"0x0020":["OW","1-n","VariableCoefficientsSDVN"],"0x0030":["OW","1-n","VariableCoefficientsSDHN"],"0x0040":["OW","1-n","VariableCoefficientsSDDN"]},"0x7FE0":{"0x0000":["UL","1","PixelDataGroupLength"],"0x0010":["OX","1","PixelData"],"0x0020":["OW","1-n","CoefficientsSDVN"],"0x0030":["OW","1-n","CoefficientsSDHN"],"0x0040":["OW","1-n","CoefficientsSDDN"]},"0xFFFC":{"0xFFFC":["OB","1","DataSetTrailingPadding"]},"0xFFFE":{"0xE000":["NONE","1","Item"],"0xE00D":["NONE","1","ItemDelimitationItem"],"0xE0DD":["NONE","1","SequenceDelimitationItem"]}};var dwv=dwv||{};dwv.browser=dwv.browser||{},dwv.browser.hasFileApi=function(){var a=-1!==navigator.appVersion.indexOf("Safari")&&-1===navigator.appVersion.indexOf("Chrome")&&(-1!==navigator.appVersion.indexOf("5.0.")||-1!==navigator.appVersion.indexOf("5.1."));return a?(console.warn("Assuming FileAPI support for Safari5..."),!0):"FileReader"in window},dwv.browser.hasXmlHttpRequest=function(){return"XMLHttpRequest"in window&&"withCredentials"in new XMLHttpRequest},dwv.browser.hasTypedArray=function(){return"Uint8Array"in window&&"Uint16Array"in window},dwv.browser.hasClampedArray=function(){return"Uint8ClampedArray"in window},dwv.browser.check=function(){var a="The application cannot be run.",b="";if(!dwv.browser.hasFileApi())throw b="The File APIs are not supported in this browser. ",alert(b+a),new Error(b);if(!dwv.browser.hasXmlHttpRequest())throw b="The XMLHttpRequest is not supported in this browser. ",alert(b+a),new Error(b);if(!dwv.browser.hasTypedArray())throw b="The Typed arrays are not supported in this browser. ",alert(b+a),new Error(b);dwv.browser.hasClampedArray()||console.warn("The Uint8ClampedArray is not supported in this browser. This may impair performance. ")};var dwv=dwv||{};dwv.gui=dwv.gui||{},dwv.gui.base=dwv.gui.base||{},dwv.gui.filter=dwv.gui.filter||{},dwv.gui.filter.base=dwv.gui.filter.base||{},dwv.gui.base.Filter=function(a){this.setup=function(b){var c=dwv.html.createHtmlSelect("filterSelect",b);c.onchange=a.onChangeFilter;var d=dwv.html.createHiddenElement("li","filterLi");d.setAttribute("class","ui-block-b"),d.appendChild(c),dwv.html.appendElement("toolList",d)},this.display=function(a){dwv.html.displayElement("filterLi",a)},this.initialise=function(){var a=document.getElementById("filterSelect");a.selectedIndex=0,dwv.gui.refreshSelect("#filterSelect")}},dwv.gui.base.Threshold=function(a){var b=new dwv.gui.Slider(a);this.setup=function(){var a=dwv.html.createHiddenElement("li","thresholdLi");a.setAttribute("class","ui-block-c");var c=document.getElementById("toolList");c.appendChild(a),b.append(),$("#toolList").trigger("create")},this.display=function(a){dwv.html.displayElement("thresholdLi",a)},this.initialise=function(){b.initialise()}},dwv.gui.filter.base.createFilterApplyButton=function(a){var b=document.createElement("button");return b.id="runFilterButton",b.onclick=a.onRunFilter,b.setAttribute("style","width:100%; margin-top:0.5em;"),b.setAttribute("class","ui-btn ui-btn-b"),b.appendChild(document.createTextNode("Apply")),b},dwv.gui.base.Sharpen=function(a){this.setup=function(){var b=dwv.html.createHiddenElement("li","sharpenLi");b.setAttribute("class","ui-block-c"),b.appendChild(dwv.gui.filter.base.createFilterApplyButton(a)),dwv.html.appendElement("toolList",b)},this.display=function(a){dwv.html.displayElement("sharpenLi",a)}},dwv.gui.base.Sobel=function(a){this.setup=function(){var b=dwv.html.createHiddenElement("li","sobelLi");b.setAttribute("class","ui-block-c"),b.appendChild(dwv.gui.filter.base.createFilterApplyButton(a)),dwv.html.appendElement("toolList",b)},this.display=function(a){dwv.html.displayElement("sobelLi",a)}};var dwv=dwv||{};dwv.gui=dwv.gui||{},dwv.gui.base=dwv.gui.base||{},dwv.gui.base.getWindowSize=function(){return{width:$(window).width(),height:$(window).height()-147}},dwv.gui.updateProgress=function(a){if(a.lengthComputable){var b=Math.round(a.loaded/a.total*100);dwv.gui.displayProgress(b)}},dwv.gui.base.displayProgress=function(a){100>a?$.mobile.loading("show",{text:a+"%",textVisible:!0,theme:"b"}):100===a&&$.mobile.loading("hide")},dwv.gui.base.refreshSelect=function(a){$(a).selectmenu&&$(a).selectmenu("refresh")},dwv.gui.setSelected=function(a,b){var c=document.getElementById(a);if(c){var d=0;for(d in c.options)if(c.options[d].text===b)break;c.selectedIndex=d,dwv.gui.refreshSelect("#"+a)}},dwv.gui.base.Slider=function(a){this.append=function(){var b=0,c=1,d=document.createElement("input");d.id="threshold-min",d.type="range",d.max=c,d.min=b,d.value=b;var e=document.createElement("input");e.id="threshold-max",e.type="range",e.max=c,e.min=b,e.value=c;var f=document.createElement("div");f.id="threshold-div",f.setAttribute("data-role","rangeslider"),f.appendChild(d),f.appendChild(e),f.setAttribute("data-mini","true"),document.getElementById("thresholdLi").appendChild(f),$("#threshold-div").on("change",function(){a.onChangeMinMax({min:$("#threshold-min").val(),max:$("#threshold-max").val()})}),$("#toolList").trigger("create")},this.initialise=function(){var b=a.getImage().getDataRange().min,c=a.getImage().getDataRange().max,d=document.getElementById("threshold-min");d.max=c,d.min=b,d.value=b;var e=document.getElementById("threshold-max");e.max=c,e.min=b,e.value=c,$("#toolList").trigger("create")}},dwv.gui.base.DicomTags=function(){this.initialise=function(a){var b=document.getElementById("tags");if(null!==b){for(;b.hasChildNodes();)b.removeChild(b.firstChild);a.PixelData&&(a.PixelData.value="...");var c=dwv.html.toTable(a);c.id="tagsTable",c.setAttribute("class","tagsList"),c.setAttribute("data-role","table"),c.setAttribute("data-mode","columntoggle"),b.appendChild(dwv.html.getHtmlSearchForm(c)),b.appendChild(c),$("#tags").trigger("create")}}};var dwv=dwv||{};dwv.gui=dwv.gui||{},dwv.gui.base=dwv.gui.base||{},dwv.gui.base.appendVersionHtml=function(a){var b=document.getElementsByClassName("dwv-version");if(b)for(var c=0;c<b.length;++c)b[c].appendChild(document.createTextNode(a))},dwv.gui.base.appendHelpHtml=function(a,b){var c="mouse";b&&(c="touch");for(var d=document.createElement("div"),e=window.location.pathname,f=e.substring(0,e.lastIndexOf("/")),g=null,h=Object.keys(a),i=0;i<h.length;++i){g=a[h[i]];var j=document.createElement("h3");j.appendChild(document.createTextNode(g.getHelp().title));var k=document.createElement("div"),l=document.createElement("p");if(l.appendChild(document.createTextNode(g.getHelp().brief)),k.appendChild(l),g.getHelp()[c])for(var m=Object.keys(g.getHelp()[c]),n=0;n<m.length;++n){var o=g.getHelp()[c][m[n]],p=document.createElement("img");p.src=f+"/../../resources/"+m[n]+".png",p.style["float"]="left",p.style.margin="0px 15px 15px 0px";var q=document.createElement("br");q.style.clear="both";var r=document.createElement("p");r.appendChild(p),r.appendChild(document.createTextNode(o)),r.appendChild(q),k.appendChild(r)}if(b){var s=document.createElement("div");s.setAttribute("data-role","collapsible"),s.appendChild(j),s.appendChild(k),d.appendChild(s)}else d.id="accordion",d.appendChild(j),d.appendChild(k)}var t=document.getElementById("help"),u=document.createElement("a");u.href="https://github.com/ivmartel/dwv/wiki",u.title="DWV wiki on github.",u.appendChild(document.createTextNode("DWV"));var v=document.createElement("a"),w=document.URL.indexOf("?input=");v.href=document.URL.substr(0,w+7)+"http%3A%2F%2Fx.babymri.org%2F%3F53320924%26.dcm",v.title="Brain MRI in DWV.",v.target="_top",v.appendChild(document.createTextNode("MRI"));var x=document.createElement("a");x.href="http://www.babymri.org",x.title="babymri.org",x.appendChild(document.createTextNode("babymri.org"));var y=document.createElement("p");y.appendChild(u),y.appendChild(document.createTextNode(" can load DICOM data either from a local file or from an URL. All DICOM tags are available in a searchable table, press the 'tags' or grid button. You can choose to display the image information overlay by pressing the 'info' or i button. For some example data, check this ")),y.appendChild(v),y.appendChild(document.createTextNode(" from the ")),y.appendChild(x),y.appendChild(document.createTextNode(" database.")),t.appendChild(y);var z=document.createElement("p");z.appendChild(document.createTextNode("Each tool defines the possible user interactions. The default tool is the window/level one. Here are the available tools:")),t.appendChild(z),t.appendChild(d)};var dwv=dwv||{};dwv.html=dwv.html||{},dwv.html.appendCell=function(a,b){var c=a.insertCell(-1),d=b;(b instanceof Array||b instanceof Uint8Array||b instanceof Uint16Array||b instanceof Uint32Array)&&(b.length>10&&(b=Array.prototype.slice.call(b,0,10),b[10]="..."),d=Array.prototype.join.call(b,", ")),c.appendChild(document.createTextNode(d))},dwv.html.appendHCell=function(a,b){var c=document.createElement("th");"Value"!==b&&"Name"!==b&&c.setAttribute("data-priority","1"),c.appendChild(document.createTextNode(b)),a.appendChild(c)},dwv.html.appendRowForArray=function(a,b,c,d,e){for(var f=null,g=0;g<b.length;++g){var h=b[g];"number"==typeof h||"string"==typeof h||null===h||void 0===h||c>=d?(f||(f=a.insertRow(-1)),dwv.html.appendCell(f,h)):dwv.html.appendRow(a,h,c+g,d,e)}},dwv.html.appendRowForObject=function(a,b,c,d,e){for(var f=Object.keys(b),g=null,h=0;h<f.length;++h){var i=b[f[h]];"number"==typeof i||"string"==typeof i||null===i||void 0===i||c>=d?(g||(g=a.insertRow(-1)),0===h&&e&&dwv.html.appendCell(g,e),dwv.html.appendCell(g,i)):dwv.html.appendRow(a,i,c+h,d,f[h])}if(2===c){var j=a.createTHead(),k=j.insertRow(-1);e&&dwv.html.appendHCell(k,"Name");for(var l=0;l<f.length;++l)dwv.html.appendHCell(k,dwv.utils.capitaliseFirstLetter(f[l]))}},dwv.html.appendRow=function(a,b,c,d,e){if(b instanceof Array)dwv.html.appendRowForArray(a,b,c+1,d,e);else{if("object"!=typeof b)throw new Error("Unsupported input data type.");dwv.html.appendRowForObject(a,b,c+1,d,e)}},dwv.html.toTable=function(a){var b=document.createElement("table");return dwv.html.appendRow(b,a,0,2),b},dwv.html.getHtmlSearchForm=function(a){var b=document.createElement("form");b.setAttribute("class","filter");var c=document.createElement("input");return c.onkeyup=function(){dwv.html.filterTable(c,a)},b.appendChild(c),b},dwv.html.filterTable=function(a,b){dwv.html.dehighlight(b);for(var c=a.value.toLowerCase().split(" "),d=0,e=0,f=1;f<b.rows.length;++f){e="";for(var g=0;g<c.length;++g)d=b.rows[f].innerHTML.replace(/<[^>]+>/g,"").toLowerCase(),d.indexOf(c[g])<0?e="none":c[g].length&&dwv.html.highlight(c[g],b.rows[f]),b.rows[f].style.display=e}},dwv.html.dehighlight=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(c.attributes&&c.attributes["class"]&&"highlighted"===c.attributes["class"].value)return void c.parentNode.parentNode.replaceChild(document.createTextNode(c.parentNode.innerHTML.replace(/<[^>]+>/g,"")),c.parentNode);3!==c.nodeType&&dwv.html.dehighlight(c)}},dwv.html.highlight=function(a,b){for(var c=0;c<b.childNodes.length;c++){var d=b.childNodes[c];if(3===d.nodeType){var e=d.data,f=e.toLowerCase();if(f.indexOf(a)>=0){var g=document.createElement("span");d.parentNode.replaceChild(g,d);for(var h;-1!==(h=f.indexOf(a));)g.appendChild(document.createTextNode(e.substr(0,h))),g.appendChild(dwv.html.createHighlightNode(document.createTextNode(e.substr(h,a.length)))),e=e.substr(h+a.length),f=f.substr(h+a.length);g.appendChild(document.createTextNode(e))}}else dwv.html.highlight(a,d)}},dwv.html.createHighlightNode=function(a){var b=document.createElement("span");return b.setAttribute("class","highlighted"),b.attributes["class"].value="highlighted",b.appendChild(a),b},dwv.html.cleanNode=function(a){for(;a.hasChildNodes();)a.removeChild(a.firstChild)},dwv.html.removeNode=function(a){var b=document.getElementById(a);if(b){dwv.html.cleanNode(b);var c=b.parentNode;c.removeChild(b)}},dwv.html.createHtmlSelect=function(a,b){var c=document.createElement("select");c.id=a,c.name=a;var d;if(b instanceof Array)for(var e in b)d=document.createElement("option"),d.value=b[e],d.appendChild(document.createTextNode(dwv.utils.capitaliseFirstLetter(b[e]))),c.appendChild(d);else{if("object"!=typeof b)throw new Error("Unsupported input list type.");for(var f in b)d=document.createElement("option"),d.value=f,d.appendChild(document.createTextNode(dwv.utils.capitaliseFirstLetter(f))),c.appendChild(d)}return c},dwv.html.getUriParam=function(a){var b=dwv.utils.splitQueryString(a);return 0===Object.keys(b).length?null:b.query},dwv.html.decodeKeyValueUri=function(a,b){var c=[],d="key";b&&(d=b);var e=decodeURIComponent(a),f=dwv.utils.splitQueryString(e);if(0===Object.keys(f).length)c.push(e);else{for(var g=Object.keys(f.query),h=null,i=0;i<g.length;++i)if(f.query[g[i]]instanceof Array){h=g[i];break}if(h){var j=f.query[h],k=f.base;"file"!==h&&(k+="?");for(var l=!1,m=0;m<g.length;++m)g[m]!==h&&(l&&(k+="&"),k+=g[m]+"="+f.query[g[m]],l=!0);for(var n,o=0;o<j.length;++o)n=k,l&&(n+="&"),"key"===d&&(n+=h+"="),n+=j[o],c.push(n)}else c.push(e)}return c},dwv.html.decodeManifestUri=function(a,b,c){var d=function(){console.warn("RequestError while receiving manifest: "+this.status)},e=function(){var a=dwv.html.decodeManifest(this.responseXML,b);c(a)},f=new XMLHttpRequest;f.open("GET",decodeURIComponent(a),!0),f.responseType="xml",f.onload=e,f.onerror=d,f.send(null)},dwv.html.decodeManifest=function(a,b){var c=[],d=a.getElementsByTagName("wado_query"),e=d[0].getAttribute("wadoURL"),f=e+"?requestType=WADO&contentType=application/dicom&",g=a.getElementsByTagName("Patient");g.length>1&&console.warn("More than one patient, loading first one.");var h=g[0].getElementsByTagName("Study");h.length>1&&console.warn("More than one study, loading first one.");var i=h[0].getAttribute("StudyInstanceUID"),j=h[0].getElementsByTagName("Series");j.length>1&&console.warn("More than one series, loading first one.");var k=j[0].getAttribute("SeriesInstanceUID"),l=j[0].getElementsByTagName("Instance"),m=l.length;m>b&&(m=b);for(var n=0;m>n;++n){var o=l[n].getAttribute("SOPInstanceUID"),p=f+"&studyUID="+i+"&seriesUID="+k+"&objectUID="+o;c.push(p)}return c},dwv.html.displayElement=function(a,b){var c=document.getElementById(a);c&&(c.style.display=b?"":"none")},dwv.html.toggleDisplay=function(a){var b=document.getElementById(a);b&&("none"===b.style.display?b.style.display="":b.style.display="none")},dwv.html.appendElement=function(a,b){var c=document.getElementById(a);b&&(c.appendChild(b),$("#"+a).trigger("create"))},dwv.html.createHiddenElement=function(a,b){var c=document.createElement(a);return c.id=b,c.style.display="none",c};var dwv=dwv||{};dwv.html=dwv.html||{},dwv.html.Layer=function(a){var b=null,c=null,d=null;this.getName=function(){return a},this.getCanvas=function(){return b},this.getContext=function(){return d},this.getOffset=function(){return $("#"+a).offset()};var e=null,f={x:0,y:0};this.getOrigin=function(){return f};var g={x:1,y:1};this.getZoom=function(){return g};var h={x:0,y:0};this.setWidth=function(a){b.width=a},this.setHeight=function(a){b.height=a},this.zoom=function(a,b,c,d){f.x=c-(c-f.x)*(a/g.x),f.y=d-(d-f.y)*(b/g.y),g.x=a,g.y=b},this.translate=function(a,b){h.x=a,h.y=b},this.setImageData=function(a){e=a,c.getContext("2d").putImageData(e,0,0)},this.resetLayout=function(a){f.x=0,f.y=0,g.x=a,g.y=a,h.x=0,h.y=0},this.displayToIndex=function(a){return{x:(a.x-f.x)/g.x-h.x,y:(a.y-f.y)/g.y-h.y}},this.draw=function(){d.save(),d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,b.width,b.height),d.restore(),d.setTransform(g.x,0,0,g.y,f.x+h.x*g.x,f.y+h.y*g.y),d.drawImage(c,0,0)},this.initialise=function(f,g){return(b=document.getElementById(a))?b.getContext?(d=b.getContext("2d"))?(b.width=f,b.height=g,d.clearRect(0,0,b.width,b.height),e=d.getImageData(0,0,b.width,b.height),c=document.createElement("canvas"),c.width=f,void(c.height=g)):void alert("Error: failed to get the 2D context for '"+a+"'."):void alert("Error: no canvas.getContext method for '"+a+"'."):void alert("Error: cannot find the canvas element for '"+a+"'.")},this.fillContext=function(){d.fillRect(0,0,b.width,b.height)},this.clear=function(){d.clearRect(0,0,b.width,b.height),e=d.getImageData(0,0,b.width,b.height),this.resetLayout()},this.merge=function(a){for(var c=a.getContext().getImageData(0,0,b.width,b.height),d=0,h=0,i=0,j=0,k=0,l=0;l<b.height;++l){h=parseInt(f.y+l*g.y,10)*b.width,j=l*b.width;for(var m=0;m<b.width;++m)d=4*(parseInt(f.x+m*g.x,10)+h),i=4*(m+j),k=c.data[d+3],0!==k&&(e.data[i]=c.data[d],e.data[i+1]=c.data[d+1],e.data[i+2]=c.data[d+2],e.data[i+3]=k)}a.clear(),this.draw()},this.setLineColour=function(a){d.fillStyle=a,d.strokeStyle=a},this.setStyleDisplay=function(a){a===!0?b.style.display="":b.style.display="none"},this.isVisible=function(){return"none"===b.style.display?!1:!0},this.align=function(a){b.style.top=a.getCanvas().offsetTop,b.style.left=a.getCanvas().offsetLeft}},dwv.html.getEventOffset=function(a){var b=[],c=0,d=0;if(a.targetTouches){for(var e=0,f=0,g=a.targetTouches[0].target.offsetParent;g;)isNaN(g.offsetLeft)||(e+=g.offsetLeft),isNaN(g.offsetTop)||(f+=g.offsetTop),g=g.offsetParent;for(var h=null,i=0;i<a.targetTouches.length;++i)h=a.targetTouches[i],c=h.pageX-e,d=h.pageY-f,b.push({x:c,y:d})}else c=void 0===a.offsetX?a.layerX:a.offsetX,d=void 0===a.offsetY?a.layerY:a.offsetY,b.push({x:c,y:d});return b};var dwv=dwv||{};dwv.gui=dwv.gui||{},dwv.gui.base=dwv.gui.base||{},dwv.gui.base.Loadbox=function(a,b){this.setup=function(){var b=dwv.html.createHtmlSelect("loaderSelect",a.getLoaders());b.onchange=a.onChangeLoader;for(var c=document.getElementById("loaderlist");c.hasChildNodes();)c.removeChild(c.firstChild);c.appendChild(b),$("#loaderlist").trigger("create")},this.displayLoader=function(a){for(var c=Object.keys(b),d=0;d<c.length;++d)c[d]===a?b[c[d]].display(!0):b[c[d]].display(!1)}},dwv.gui.base.FileLoad=function(a){this.setup=function(){var b=document.createElement("input");b.onchange=a.onChangeFiles,b.type="file",b.multiple=!0,b.id="imagefiles",b.setAttribute("data-clear-btn","true"),b.setAttribute("data-mini","true");var c=document.createElement("div");c.id="imagefilesdiv",c.style.display="none",c.appendChild(b);var d=document.getElementById("loaderlist");d.appendChild(c),$("#loaderlist").trigger("create")},this.display=function(a){var b=document.getElementById("imagefilesdiv");b.style.display=a?"":"none"}},dwv.gui.base.UrlLoad=function(a){this.setup=function(){var b=document.createElement("input");b.onchange=a.onChangeURL,b.type="url",b.id="imageurl",b.setAttribute("data-clear-btn","true"),b.setAttribute("data-mini","true");var c=document.createElement("div");c.id="imageurldiv",c.style.display="none",c.appendChild(b);var d=document.getElementById("loaderlist");d.appendChild(c),$("#loaderlist").trigger("create")},this.display=function(a){var b=document.getElementById("imageurldiv");b.style.display=a?"":"none"}};var dwv=dwv||{};dwv.html=dwv.html||{},dwv.html.Style=function(){var a=12,b="Verdana",c="#fff",d="",e=1,f=2;this.getFontFamily=function(){return b},this.getFontSize=function(){return a},this.getStrokeWidth=function(){return f},this.getTextColour=function(){return c},this.getLineColour=function(){return d},this.setLineColour=function(a){d=a},this.setScale=function(a){e=a},this.scale=function(a){return a/e}},dwv.html.Style.prototype.getFontStr=function(){return"normal "+this.getFontSize()+"px sans-serif"},dwv.html.Style.prototype.getLineHeight=function(){return this.getFontSize()+this.getFontSize()/5},dwv.html.Style.prototype.getScaledFontSize=function(){return this.scale(this.getFontSize())},dwv.html.Style.prototype.getScaledStrokeWidth=function(){return this.scale(this.getStrokeWidth())};var dwv=dwv||{};dwv.gui=dwv.gui||{},dwv.gui.base=dwv.gui.base||{},dwv.gui.base.Toolbox=function(a){this.setup=function(b){var c=dwv.html.createHtmlSelect("toolSelect",b);c.onchange=a.onChangeTool;var d=document.createElement("li");d.id="toolLi",d.style.display="none",d.appendChild(c),d.setAttribute("class","ui-block-a");for(var e=document.getElementById("toolList");e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(d),$("#toolList").trigger("create")},this.display=function(a){dwv.html.displayElement("toolLi",a)},this.initialise=function(a){for(var b=document.getElementById("toolSelect"),c=b.options,d=-1,e=0;e<c.length;++e)a[e]?(-1===d&&(d=e),c[e].style.display=""):c[e].style.display="none";b.selectedIndex=d,dwv.gui.refreshSelect("#toolSelect")}},dwv.gui.base.WindowLevel=function(a){this.setup=function(){var b=dwv.html.createHtmlSelect("presetSelect",[]);b.onchange=a.onChangeWindowLevelPreset;var c=dwv.html.createHtmlSelect("colourMapSelect",dwv.tool.colourMaps);c.onchange=a.onChangeColourMap;var d=document.createElement("li");d.id="wlLi",d.style.display="none",d.appendChild(b),d.setAttribute("class","ui-block-b");var e=document.createElement("li");e.id="cmLi",e.style.display="none",e.appendChild(c),e.setAttribute("class","ui-block-c");var f=document.getElementById("toolList");f.appendChild(d),f.appendChild(e),$("#toolList").trigger("create")},this.display=function(a){dwv.html.displayElement("wlLi",a),dwv.html.displayElement("cmLi",a)},this.initialise=function(){var b=dwv.html.createHtmlSelect("presetSelect",a.getViewController().getPresets());b.onchange=a.onChangeWindowLevelPreset,b.title="Select w/l preset.";var c=document.getElementById("wlLi");dwv.html.cleanNode(c),c.appendChild(b),$("#toolList").trigger("create");var d=document.getElementById("colourMapSelect");d.selectedIndex=0,"MONOCHROME1"===a.getImage().getPhotometricInterpretation()&&(d.selectedIndex=1),dwv.gui.refreshSelect("#colourMapSelect")}},dwv.gui.base.Draw=function(a){var b=["Yellow","Red","White","Green","Blue","Lime","Fuchsia","Black"];this.getColours=function(){return b},this.setup=function(c){var d=dwv.html.createHtmlSelect("shapeSelect",c);d.onchange=a.onChangeShape;var e=dwv.html.createHtmlSelect("colourSelect",b);e.onchange=a.onChangeLineColour;var f=document.createElement("li");f.id="shapeLi",f.style.display="none",f.appendChild(d),f.setAttribute("class","ui-block-c");var g=document.createElement("li");g.id="colourLi",g.style.display="none",g.appendChild(e),g.setAttribute("class","ui-block-b");var h=document.getElementById("toolList");h.appendChild(f),h.appendChild(g),$("#toolList").trigger("create")},this.display=function(a){dwv.html.displayElement("colourLi",a),dwv.html.displayElement("shapeLi",a)},this.initialise=function(){var a=document.getElementById("shapeSelect");a.selectedIndex=0,dwv.gui.refreshSelect("#shapeSelect");var b=document.getElementById("colourSelect");b.selectedIndex=0,dwv.gui.refreshSelect("#colourSelect")}},dwv.gui.base.Livewire=function(a){var b=["Yellow","Red","White","Green","Blue","Lime","Fuchsia","Black"];this.getColours=function(){return b},this.setup=function(){var c=dwv.html.createHtmlSelect("lwColourSelect",b);c.onchange=a.onChangeLineColour;var d=document.createElement("li");d.id="lwColourLi",d.style.display="none",d.setAttribute("class","ui-block-b"),d.appendChild(c);var e=document.getElementById("toolList");e.appendChild(d),$("#toolList").trigger("create")},this.display=function(a){dwv.html.displayElement("lwColourLi",a)},this.initialise=function(){var a=document.getElementById("lwColourSelect");a.selectedIndex=0,dwv.gui.refreshSelect("#lwColourSelect")}},dwv.gui.base.ZoomAndPan=function(a){this.setup=function(){var b=document.createElement("button");b.id="zoomResetButton",b.name="zoomResetButton",b.onclick=a.onZoomReset,b.setAttribute("style","width:100%; margin-top:0.5em;"),b.setAttribute("class","ui-btn ui-btn-b");var c=document.createTextNode("Reset");b.appendChild(c);var d=document.createElement("li");d.id="zoomLi",d.style.display="none",d.setAttribute("class","ui-block-c"),d.appendChild(b);var e=document.getElementById("toolList");e.appendChild(d),$("#toolList").trigger("create")},this.display=function(a){dwv.html.displayElement("zoomLi",a)}},dwv.gui.base.Scroll=function(){this.setup=function(){var a=document.createElement("li");a.id="scrollLi",a.style.display="none",a.setAttribute("class","ui-block-c");var b=document.getElementById("toolList");b.appendChild(a),$("#toolList").trigger("create")},this.display=function(a){dwv.html.displayElement("scrollLi",a)}};var dwv=dwv||{};dwv.gui=dwv.gui||{},dwv.gui.base=dwv.gui.base||{},dwv.gui.base.Undo=function(){this.setup=function(){var a=document.createElement("p");a.appendChild(document.createTextNode("History:")),a.appendChild(document.createElement("br"));var b=document.createElement("select");b.id="history_list",b.name="history_list",b.multiple="multiple",a.appendChild(b);for(var c=document.getElementById("history");c.hasChildNodes();)c.removeChild(c.firstChild);c.appendChild(a)},this.initialise=function(){var a=document.getElementById("history_list");if(a&&0!==a.length)for(var b=a.length-1;b>=0;--b)a.remove(b)},this.addCommandToUndoHtml=function(a){var b=document.getElementById("history_list"),c=b.length-(b.selectedIndex+1);if(c>0)for(var d=0;c>d;++d)b.remove(b.length-1);var e=document.createElement("option");e.text=a,e.value=a,b.add(e),b.selectedIndex++},this.enableInUndoHtml=function(a){var b,c=document.getElementById("history_list");a?(c.selectedIndex++,b=c.options[c.selectedIndex],b.disabled=!1):(b=c.options[c.selectedIndex],b.disabled=!0,c.selectedIndex--)}};var dwv=dwv||{};dwv.image=dwv.image||{},dwv.image.filter=dwv.image.filter||{},dwv.image.filter.Threshold=function(){var a=0,b=0;this.getMin=function(){return a},this.setMin=function(b){a=b},this.getMax=function(){return b},this.setMax=function(a){b=a},this.getName=function(){return"Threshold"};var c=null;this.setOriginalImage=function(a){c=a},this.getOriginalImage=function(){return c}},dwv.image.filter.Threshold.prototype.update=function(){var a=this.getOriginalImage(),b=a.getDataRange().min,c=this,d=function(a){return a<c.getMin()||a>c.getMax()?b:a};return a.transform(d)},dwv.image.filter.Sharpen=function(){this.getName=function(){return"Sharpen"};var a=null;this.setOriginalImage=function(b){a=b},this.getOriginalImage=function(){return a}},dwv.image.filter.Sharpen.prototype.update=function(){var a=this.getOriginalImage();return a.convolute2D([0,-1,0,-1,5,-1,0,-1,0])},dwv.image.filter.Sobel=function(){this.getName=function(){return"Sobel"};var a=null;this.setOriginalImage=function(b){a=b},this.getOriginalImage=function(){return a}},dwv.image.filter.Sobel.prototype.update=function(){var a=this.getOriginalImage(),b=a.convolute2D([1,0,-1,2,0,-2,1,0,-1]),c=a.convolute2D([1,2,1,0,0,0,-1,-2,-1]);return b.compose(c,function(a,b){return Math.sqrt(a*a+b*b)})};var dwv=dwv||{};dwv.image=dwv.image||{},dwv.image.Size=function(a,b,c){this.getNumberOfColumns=function(){return a},this.getNumberOfRows=function(){return b},this.getNumberOfSlices=function(){return c||1}},dwv.image.Size.prototype.getSliceSize=function(){return this.getNumberOfColumns()*this.getNumberOfRows()},dwv.image.Size.prototype.getTotalSize=function(){return this.getSliceSize()*this.getNumberOfSlices()},dwv.image.Size.prototype.equals=function(a){return null!==a&&this.getNumberOfColumns()===a.getNumberOfColumns()&&this.getNumberOfRows()===a.getNumberOfRows()&&this.getNumberOfSlices()===a.getNumberOfSlices()},dwv.image.Size.prototype.isInBounds=function(a,b,c){return 0>a||a>this.getNumberOfColumns()-1||0>b||b>this.getNumberOfRows()-1||0>c||c>this.getNumberOfSlices()-1?!1:!0},dwv.image.Spacing=function(a,b,c){this.getColumnSpacing=function(){return a},this.getRowSpacing=function(){return b},this.getSliceSpacing=function(){return c||1}},dwv.image.Spacing.prototype.equals=function(a){return null!==a&&this.getColumnSpacing()===a.getColumnSpacing()&&this.getRowSpacing()===a.getRowSpacing()&&this.getSliceSpacing()===a.getSliceSpacing()},dwv.image.Geometry=function(a,b,c){"undefined"==typeof a&&(a=new dwv.math.Point3D(0,0,0));var d=[a];this.getOrigin=function(){return a},this.getOrigins=function(){return d},this.getSize=function(){return b},this.getSpacing=function(){return c},this.getSliceIndex=function(a){for(var b=0,c=Math.abs(d[0].getZ()-a.getZ()),e=0,f=0;f<d.length;++f)e=Math.abs(d[f].getZ()-a.getZ()),c>e&&(c=e,b=f);e=d[b].getZ()-a.getZ();var g=e>0?b:b+1;return g},this.appendOrigin=function(a,c){d.splice(c,0,a),b=new dwv.image.Size(b.getNumberOfColumns(),b.getNumberOfRows(),b.getNumberOfSlices()+1)}},dwv.image.Geometry.prototype.equals=function(a){return null!==a&&this.getOrigin()===a.getOrigin()&&this.getSize()===a.getSize()&&this.getSpacing()===a.getSpacing()},dwv.image.Geometry.prototype.indexToOffset=function(a){var b=this.getSize();return a.getI()+a.getJ()*b.getNumberOfColumns()+a.getK()*b.getSliceSize()},dwv.image.Geometry.prototype.indexToWorld=function(a){var b=this.getOrigin(),c=this.getSpacing();return new dwv.math.Point3D(b.getX()+a.getI()*c.getColumnSpacing(),b.getY()+a.getJ()*c.getRowSpacing(),b.getZ()+a.getK()*c.getSliceSpacing())},dwv.image.Geometry.prototype.worldToIndex=function(a){var b=this.getOrigin(),c=this.getSpacing();return new dwv.math.Point3D(a.getX()/c.getColumnSpacing()-b.getX(),a.getY()/c.getRowSpacing()-b.getY(),a.getZ()/c.getSliceSpacing()-b.getZ())};var dwv=dwv||{};dwv.image=dwv.image||{},dwv.image.RescaleSlopeAndIntercept=function(a,b){this.getSlope=function(){return a},this.getIntercept=function(){return b},this.apply=function(c){return c*a+b}},dwv.image.RescaleSlopeAndIntercept.prototype.equals=function(a){return null!==a&&this.getSlope()===a.getSlope()&&this.getIntercept()===a.getIntercept()},dwv.image.RescaleSlopeAndIntercept.prototype.toString=function(){return this.getSlope()+", "+this.getIntercept()},dwv.image.Image=function(a,b){for(var c=[],d=0;d<a.getSize().getNumberOfSlices();++d)c.push(new dwv.image.RescaleSlopeAndIntercept(1,0));var e="MONOCHROME2",f=0,g=b.length/a.getSize().getTotalSize(),h={},i=new Int16Array(b),j=null,k=null,l=null;this.getGeometry=function(){return a},this.getBuffer=function(){return b},this.getRescaleSlopeAndIntercept=function(a){
return c[a]},this.setRescaleSlopeAndIntercept=function(a,b){"undefined"==typeof b&&(b=0),c[b]=a},this.getPhotometricInterpretation=function(){return e},this.setPhotometricInterpretation=function(a){e=a},this.getPlanarConfiguration=function(){return f},this.setPlanarConfiguration=function(a){f=a},this.getNumberOfComponents=function(){return g},this.getMeta=function(){return h},this.setMeta=function(a){h=a},this.getValueAtOffset=function(a){return b[a]},this.clone=function(){for(var a=new dwv.image.Image(this.getGeometry(),i),b=this.getGeometry().getSize().getNumberOfSlices(),c=0;b>c;++c)a.setRescaleSlopeAndIntercept(this.getRescaleSlopeAndIntercept(c),c);return a.setPhotometricInterpretation(this.getPhotometricInterpretation()),a.setPlanarConfiguration(this.getPlanarConfiguration()),a.setMeta(this.getMeta()),a},this.appendSlice=function(d){if(null===d)throw new Error("Cannot append null slice");var f=d.getGeometry().getSize(),g=a.getSize();if(1!==f.getNumberOfSlices())throw new Error("Cannot append more than one slice");if(g.getNumberOfColumns()!==f.getNumberOfColumns())throw new Error("Cannot append a slice with different number of columns");if(g.getNumberOfRows()!==f.getNumberOfRows())throw new Error("Cannot append a slice with different number of rows");if(e!==d.getPhotometricInterpretation())throw new Error("Cannot append a slice with different photometric interpretation");for(var j in h)if(h[j]!==d.getMeta()[j])throw new Error("Cannot append a slice with different "+j);var k=1;"RGB"===e&&(k=3);var l=k*g.getSliceSize(),m=new Int16Array(l*(g.getNumberOfSlices()+1)),n=a.getSliceIndex(d.getGeometry().getOrigin());if(0===n)m.set(d.getBuffer()),m.set(b,l);else if(n===g.getNumberOfSlices())m.set(b),m.set(d.getBuffer(),g.getNumberOfSlices()*l);else{var o=n*l;m.set(b.subarray(0,o-1)),m.set(d.getBuffer(),o),m.set(b.subarray(o),o+l)}a.appendOrigin(d.getGeometry().getOrigin(),n),c.splice(n,0,d.getRescaleSlopeAndIntercept(0)),b=m,i=new Int16Array(m)},this.getDataRange=function(){return j||(j=this.calculateDataRange()),j},this.getRescaledDataRange=function(){return k||(k=this.calculateRescaledDataRange()),k},this.getHistogram=function(){if(!l){var a=this.calculateHistogram();j=a.dataRange,k=a.rescaledDataRange,l=a.histogram}return l}},dwv.image.Image.prototype.getValue=function(a,b,c){var d=new dwv.math.Index3D(a,b,c);return this.getValueAtOffset(this.getGeometry().indexToOffset(d))},dwv.image.Image.prototype.getRescaledValue=function(a,b,c){return this.getRescaleSlopeAndIntercept(c).apply(this.getValue(a,b,c))},dwv.image.Image.prototype.calculateDataRange=function(){for(var a=this.getGeometry().getSize().getTotalSize(),b=this.getValueAtOffset(0),c=b,d=0,e=0;a>e;++e)d=this.getValueAtOffset(e),d>c&&(c=d),b>d&&(b=d);return{min:b,max:c}},dwv.image.Image.prototype.calculateRescaledDataRange=function(){for(var a=this.getGeometry().getSize(),b=this.getRescaledValue(0,0,0),c=b,d=0,e=0;e<a.getNumberOfSlices();++e)for(var f=0;f<a.getNumberOfRows();++f)for(var g=0;g<a.getNumberOfColumns();++g)d=this.getRescaledValue(g,f,e),d>c&&(c=d),b>d&&(b=d);return{min:b,max:c}},dwv.image.Image.prototype.calculateHistogram=function(){for(var a=this.getGeometry().getSize(),b=[],c=this.getValue(0,0,0),d=c,e=0,f=this.getRescaledValue(0,0,0),g=f,h=0,i=0;i<a.getNumberOfSlices();++i)for(var j=0;j<a.getNumberOfRows();++j)for(var k=0;k<a.getNumberOfColumns();++k)e=this.getValue(k,j,i),e>d&&(d=e),c>e&&(c=e),h=this.getRescaleSlopeAndIntercept(i).apply(e),h>g&&(g=h),f>h&&(f=h),b[h]=(b[h]||0)+1;for(var l={min:c,max:d},m={min:f,max:g},n=[],o=f;g>=o;++o)n.push([o,b[o]||0]);return{dataRange:l,rescaledDataRange:m,histogram:n}},dwv.image.Image.prototype.convolute2D=function(a){if(9!==a.length)throw new Error("The convolution matrix does not have a length of 9; it has "+a.length);var b=this.clone(),c=b.getBuffer(),d=this.getGeometry().getSize(),e=d.getNumberOfColumns(),f=d.getNumberOfRows(),g=d.getNumberOfSlices(),h=this.getNumberOfComponents(),i=1,j=1;3===h&&(0===this.getPlanarConfiguration()?i=3:j=d.getTotalSize());var k=[];k[0]=(-e-1)*i,k[1]=-e*i,k[2]=(-e+1)*i,k[3]=-i,k[4]=0,k[5]=1*i,k[6]=(e-1)*i,k[7]=e*i,k[8]=(e+1)*i;var l=[];l[0]=k[4],l[1]=k[4],l[2]=k[5],l[3]=k[4],l[4]=k[4],l[5]=k[5],l[6]=k[7],l[7]=k[7],l[8]=k[8];var m=[];m[0]=k[1],m[1]=k[1],m[2]=k[2],m[3]=k[4],m[4]=k[4],m[5]=k[5],m[6]=k[7],m[7]=k[7],m[8]=k[8];var n=[];n[0]=k[1],n[1]=k[1],n[2]=k[2],n[3]=k[4],n[4]=k[4],n[5]=k[5],n[6]=k[4],n[7]=k[4],n[8]=k[5];var o=[];o[0]=k[3],o[1]=k[4],o[2]=k[5],o[3]=k[3],o[4]=k[4],o[5]=k[5],o[6]=k[6],o[7]=k[7],o[8]=k[8];var p=[];p[0]=k[0],p[1]=k[1],p[2]=k[2],p[3]=k[3],p[4]=k[4],p[5]=k[5],p[6]=k[3],p[7]=k[4],p[8]=k[5];var q=[];q[0]=k[3],q[1]=k[4],q[2]=k[4],q[3]=k[3],q[4]=k[4],q[5]=k[4],q[6]=k[6],q[7]=k[7],q[8]=k[7];var r=[];r[0]=k[0],r[1]=k[1],r[2]=k[1],r[3]=k[3],r[4]=k[4],r[5]=k[4],r[6]=k[6],r[7]=k[7],r[8]=k[7];var s=[];s[0]=k[0],s[1]=k[1],s[2]=k[1],s[3]=k[3],s[4]=k[4],s[5]=k[4],s[6]=k[3],s[7]=k[4],s[8]=k[4];for(var t=0,u=0,v=[],w=0;h>w;w++){t=w*j;for(var x=0;g>x;x++)for(var y=0;f>y;y++)for(var z=0;e>z;z++){v=k,0===z&&0===y?v=l:0===z&&y===f-1?v=n:z===e-1&&0===y?v=q:z===e-1&&y===f-1?v=s:0===z&&y!==f-1&&0!==y?v=m:z===e-1&&y!==f-1&&0!==y?v=r:0!==z&&z!==e-1&&0===y?v=o:0!==z&&z!==e-1&&y===f-1&&(v=p),u=0;for(var A=0;9>A;++A)u+=this.getValueAtOffset(t+v[A])*a[A];c[t]=u,t+=i}}return b},dwv.image.Image.prototype.transform=function(a){for(var b=this.clone(),c=b.getBuffer(),d=0;d<c.length;++d)c[d]=a(b.getValueAtOffset(d));return b},dwv.image.Image.prototype.compose=function(a,b){for(var c=this.clone(),d=c.getBuffer(),e=0;e<d.length;++e)d[e]=Math.floor(b(this.getValueAtOffset(e),a.getValueAtOffset(e)));return c},dwv.image.Image.prototype.quantifyLine=function(a){var b=this.getGeometry().getSpacing(),c=a.getWorldLength(b.getColumnSpacing(),b.getRowSpacing());return{length:c}},dwv.image.Image.prototype.quantifyRect=function(a){for(var b=this.getGeometry().getSpacing(),c=a.getWorldSurface(b.getColumnSpacing(),b.getRowSpacing()),d=[],e=parseInt(a.getBegin().getY(),10),f=parseInt(a.getEnd().getY(),10),g=parseInt(a.getBegin().getX(),10),h=parseInt(a.getEnd().getX(),10),i=e;f>i;++i)for(var j=g;h>j;++j)d.push(this.getValue(j,i,0));var k=dwv.math.getStats(d);return{surface:c,min:k.min,max:k.max,mean:k.mean,stdDev:k.stdDev}},dwv.image.Image.prototype.quantifyEllipse=function(a){var b=this.getGeometry().getSpacing(),c=a.getWorldSurface(b.getColumnSpacing(),b.getRowSpacing());return{surface:c}},dwv.image.ImageFactory=function(){},dwv.image.ImageFactory.prototype.create=function(a,b){if(!a.Columns)throw new Error("Missing DICOM image number of columns");if(!a.Rows)throw new Error("Missing DICOM image number of rows");var c=new dwv.image.Size(a.Columns.value[0],a.Rows.value[0]),d=1,e=1;a.PixelSpacing?(d=parseFloat(a.PixelSpacing.value[0]),e=parseFloat(a.PixelSpacing.value[1])):a.ImagerPixelSpacing&&(d=parseFloat(a.ImagerPixelSpacing.value[0]),e=parseFloat(a.ImagerPixelSpacing.value[1]));var f=new dwv.image.Spacing(e,d),g=dwv.utils.cleanString(a.TransferSyntaxUID.value[0]),h=dwv.dicom.isJpeg2000TransferSyntax(g),i=new Int16Array(b.length),j=!1;a.PixelRepresentation&&1==a.PixelRepresentation.value[0]&&(j=!0);for(var k=0;k<b.length;++k)i[k]=b[k],j&&i[k]>=Math.pow(2,15)&&(i[k]-=Math.pow(2,16));var l=new Array(0,0,0);a.ImagePositionPatient&&(l=[parseFloat(a.ImagePositionPatient.value[0]),parseFloat(a.ImagePositionPatient.value[1]),parseFloat(a.ImagePositionPatient.value[2])]);var m=new dwv.math.Point3D(l[0],l[1],l[2]),n=new dwv.image.Geometry(m,c,f),o=new dwv.image.Image(n,i);if(a.PhotometricInterpretation){var p=dwv.utils.cleanString(a.PhotometricInterpretation.value[0]).toUpperCase();h&&p.match(/YBR/)&&(p="RGB"),o.setPhotometricInterpretation(p)}a.PlanarConfiguration&&o.setPlanarConfiguration(a.PlanarConfiguration.value[0]);var q=1;a.RescaleSlope&&(q=parseFloat(a.RescaleSlope.value[0]));var r=0;a.RescaleIntercept&&(r=parseFloat(a.RescaleIntercept.value[0]));var s=new dwv.image.RescaleSlopeAndIntercept(q,r);o.setRescaleSlopeAndIntercept(s);var t={};return a.Modality&&(t.Modality=a.Modality.value[0]),a.StudyInstanceUID&&(t.StudyInstanceUID=a.StudyInstanceUID.value[0]),a.SeriesInstanceUID&&(t.SeriesInstanceUID=a.SeriesInstanceUID.value[0]),a.BitsStored&&(t.BitsStored=parseInt(a.BitsStored.value[0],10)),o.setMeta(t),o};var dwv=dwv||{};dwv.image=dwv.image||{},dwv.image.lut=dwv.image.lut||{},dwv.image.lut.Rescale=function(a){var b=null;this.getRSI=function(){return a},this.initialise=function(c){var d=Math.pow(2,c);b=new Float32Array(d);for(var e=0;d>e;++e)b[e]=a.apply(e)},this.getLength=function(){return b.length},this.getValue=function(a){return b[a]}},dwv.image.lut.Window=function(a,b){var c=null;c=dwv.browser.hasClampedArray()?new Uint8ClampedArray(a.getLength()):new Uint8Array(a.getLength());var d=null,e=null,f=!1;this.getCenter=function(){return d},this.getWidth=function(){return e},this.isSigned=function(){return b},this.getRescaleLut=function(){return a},this.setCenterAndWidth=function(a,b){d=a,e=b,f=!0},this.update=function(){if(f){var g=c.length,h=d-.5;b&&(h+=a.getRSI().getSlope()*(g/2));var i=e-1,j=0;if(dwv.browser.hasClampedArray())for(var k=0;g>k;++k)j=255*((a.getValue(k)-h)/i+.5),c[k]=parseInt(j,10);else for(var l=255,m=0,n=0;g>n;++n)j=255*((a.getValue(n)-h)/i+.5),j=parseInt(j,10),m>=j?c[n]=m:j>l?c[n]=l:c[n]=j;f=!1}},this.getLength=function(){return c.length},this.getValue=function(a){var d=b?c.length/2:0;return c[a+d]}},dwv.image.lut.range_max=256,dwv.image.lut.buildLut=function(a){for(var b=[],c=0;c<dwv.image.lut.range_max;++c)b.push(a(c));return b},dwv.image.lut.max=function(){return dwv.image.lut.range_max-1},dwv.image.lut.maxFirstThird=function(a){return a<dwv.image.lut.range_max/3?dwv.image.lut.range_max-1:0},dwv.image.lut.maxSecondThird=function(a){var b=dwv.image.lut.range_max/3;return a>=b&&2*b>a?dwv.image.lut.range_max-1:0},dwv.image.lut.maxThirdThird=function(a){return a>=2*dwv.image.lut.range_max/3?dwv.image.lut.range_max-1:0},dwv.image.lut.toMaxFirstThird=function(a){var b=3*a;return b>dwv.image.lut.range_max-1?dwv.image.lut.range_max-1:b},dwv.image.lut.toMaxSecondThird=function(a){var b=dwv.image.lut.range_max/3,c=0;return a>=b&&(c=3*(a-b),c>dwv.image.lut.range_max-1)?dwv.image.lut.range_max-1:c},dwv.image.lut.toMaxThirdThird=function(a){var b=dwv.image.lut.range_max/3,c=0;return a>=2*b&&(c=3*(a-2*b),c>dwv.image.lut.range_max-1)?dwv.image.lut.range_max-1:c},dwv.image.lut.zero=function(){return 0},dwv.image.lut.id=function(a){return a},dwv.image.lut.invId=function(a){return dwv.image.lut.range_max-1-a},dwv.image.lut.plain={red:dwv.image.lut.buildLut(dwv.image.lut.id),green:dwv.image.lut.buildLut(dwv.image.lut.id),blue:dwv.image.lut.buildLut(dwv.image.lut.id)},dwv.image.lut.invPlain={red:dwv.image.lut.buildLut(dwv.image.lut.invId),green:dwv.image.lut.buildLut(dwv.image.lut.invId),blue:dwv.image.lut.buildLut(dwv.image.lut.invId)},dwv.image.lut.rainbow={blue:[0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255,247,239,231,223,215,207,199,191,183,175,167,159,151,143,135,127,119,111,103,95,87,79,71,63,55,47,39,31,23,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],green:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,16,24,32,40,48,56,64,72,80,88,96,104,112,120,128,136,144,152,160,168,176,184,192,200,208,216,224,232,240,248,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,251,249,247,245,243,241,239,237,235,233,231,229,227,225,223,221,219,217,215,213,211,209,207,205,203,201,199,197,195,193,192,189,186,183,180,177,174,171,168,165,162,159,156,153,150,147,144,141,138,135,132,129,126,123,120,117,114,111,108,105,102,99,96,93,90,87,84,81,78,75,72,69,66,63,60,57,54,51,48,45,42,39,36,33,30,27,24,21,18,15,12,9,6,3],red:[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,62,60,58,56,54,52,50,48,46,44,42,40,38,36,34,32,30,28,26,24,22,20,18,16,14,12,10,8,6,4,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},dwv.image.lut.hot={red:dwv.image.lut.buildLut(dwv.image.lut.toMaxFirstThird),green:dwv.image.lut.buildLut(dwv.image.lut.toMaxSecondThird),blue:dwv.image.lut.buildLut(dwv.image.lut.toMaxThirdThird)},dwv.image.lut.test={red:dwv.image.lut.buildLut(dwv.image.lut.id),green:dwv.image.lut.buildLut(dwv.image.lut.zero),blue:dwv.image.lut.buildLut(dwv.image.lut.zero)};var dwv=dwv||{};dwv.image=dwv.image||{},dwv.image.getDataFromImage=function(a){var b=document.createElement("canvas");b.width=a.width,b.height=a.height;var c=b.getContext("2d");c.drawImage(a,0,0,a.width,a.height);for(var d=c.getImageData(0,0,a.width,a.height),e=[],f=0,g=0;g<d.data.length;g+=4)e[f]=d.data[g],e[f+1]=d.data[g+1],e[f+2]=d.data[g+2],f+=3;var h=new dwv.image.Size(a.width,a.height),i=new dwv.image.Spacing(1,1),j=a.index?a.index:0,k=new dwv.math.Point3D(0,0,j),l=new dwv.image.Geometry(k,h,i),m=new dwv.image.Image(l,e);m.setPhotometricInterpretation("RGB");var n={};n.BitsStored=8,m.setMeta(n);var o=new dwv.image.View(m);o.setWindowLevelMinMax();var p={};return a.file&&(p.fileName={value:a.file.name},p.fileType={value:a.file.type},p.fileLastModifiedDate={value:a.file.lastModifiedDate}),p.imageWidth={value:a.width},p.imageHeight={value:a.height},{view:o,info:p}},dwv.image.getDataFromDicomBuffer=function(a){var b=new dwv.dicom.DicomParser;b.parse(a);var c=new dwv.image.ViewFactory,d=c.create(b.getDicomElements(),b.getPixelBuffer());return{view:d,info:b.getDicomElements()}};var dwv=dwv||{};dwv.image=dwv.image||{},dwv.image.View=function(a,b){function c(){var c=new dwv.image.lut.Rescale(a.getRescaleSlopeAndIntercept(0));c.initialise(a.getMeta().BitsStored);var d=new dwv.image.lut.Window(c,b);h.setWindowLut(d)}var d={},e=null,f=dwv.image.lut.plain,g={i:0,j:0,k:0};this.getImage=function(){return a},this.setImage=function(b){a=b},this.getWindowLut=function(b){if("undefined"==typeof b){var c=this.getCurrentPosition().k;b=a.getRescaleSlopeAndIntercept(c)}return d[b.toString()]},this.setWindowLut=function(a){var b=a.getRescaleLut().getRSI();d[b.toString()]=a};var h=this;c(),this.getWindowPresets=function(){return e},this.setWindowPresets=function(a){e=a,this.setWindowLevel(a[0].center,a[0].width)},this.getColourMap=function(){return f},this.setColourMap=function(a){f=a,"MONOCHROME1"===this.getImage().getPhotometricInterpretation()&&(f=dwv.image.lut.invPlain),this.fireEvent({type:"colourchange",wc:this.getWindowLut().getCenter(),ww:this.getWindowLut().getWidth()})},this.isSigned=function(){return b},this.getCurrentPosition=function(){return g},this.setCurrentPosition=function(b){if(!a.getGeometry().getSize().isInBounds(b.i,b.j,b.k))return!1;var c=g;return g=b,null!==a.getPhotometricInterpretation().match(/MONOCHROME/)?this.fireEvent({type:"positionchange",i:b.i,j:b.j,k:b.k,value:a.getRescaledValue(b.i,b.j,b.k)}):this.fireEvent({type:"positionchange",i:b.i,j:b.j,k:b.k}),c.k!==g.k&&this.fireEvent({type:"slicechange"}),!0},this.append=function(a){this.getImage().appendSlice(a.getImage()),this.setWindowLut(a.getWindowLut())},this.setWindowLevel=function(a,b){if(b>=1){for(var c in d)d[c].setCenterAndWidth(a,b);this.fireEvent({type:"wlchange",wc:a,ww:b})}},this.clone=function(){var a=new dwv.image.View(this.getImage());for(var b in d)a.setWindowLut(d[b]);return a.setListeners(this.getListeners()),a};var i={};this.getListeners=function(){return i},this.setListeners=function(a){i=a}},dwv.image.View.prototype.setWindowLevelMinMax=function(){var a=this.getImage().getRescaledDataRange(),b=a.min,c=a.max,d=c-b,e=b+d/2;this.setWindowLevel(e,d)},dwv.image.View.prototype.generateImageData=function(a){var b=this.getCurrentPosition().k,c=this.getImage(),d=0,e=c.getPhotometricInterpretation(),f=c.getPlanarConfiguration(),g=this.getWindowLut();g.update();var h=this.getColourMap(),i=0,j=c.getGeometry().getSize().getSliceSize(),k=0;switch(e){case"MONOCHROME1":case"MONOCHROME2":k=(b||0)*j;for(var l=k+j,m=k;l>m;++m)d=parseInt(g.getValue(c.getValueAtOffset(m)),10),a.data[i]=h.red[d],a.data[i+1]=h.green[d],a.data[i+2]=h.blue[d],a.data[i+3]=255,i+=4;break;case"RGB":if(0!==f&&1!==f)throw new Error("Unsupported planar configuration: "+f);k=3*(b||0)*j;var n=k,o=k+1,p=k+2,q=3;1===f&&(n=k,o=k+j,p=k+2*j,q=1);for(var r=0,s=0,t=0,u=0;j>u;++u)r=parseInt(g.getValue(c.getValueAtOffset(n)),10),s=parseInt(g.getValue(c.getValueAtOffset(o)),10),t=parseInt(g.getValue(c.getValueAtOffset(p)),10),a.data[i]=r,a.data[i+1]=s,a.data[i+2]=t,a.data[i+3]=255,i+=4,n+=q,o+=q,p+=q;break;default:throw new Error("Unsupported photometric interpretation: "+e)}},dwv.image.View.prototype.addEventListener=function(a,b){var c=this.getListeners();c[a]||(c[a]=[]),c[a].push(b)},dwv.image.View.prototype.removeEventListener=function(a,b){var c=this.getListeners();if(c[a])for(var d=0;d<c[a].length;++d)c[a][d]===b&&c[a].splice(d,1)},dwv.image.View.prototype.fireEvent=function(a){var b=this.getListeners();if(b[a.type])for(var c=0;c<b[a.type].length;++c)b[a.type][c](a)},dwv.image.ViewFactory=function(){},dwv.image.ViewFactory.prototype.create=function(a,b){var c=new dwv.image.ImageFactory,d=c.create(a,b),e=0;a.PixelRepresentation&&(e=a.PixelRepresentation.value[0]);var f=new dwv.image.View(d,e),g=[];if(a.WindowCenter&&a.WindowWidth)for(var h,i=0;i<a.WindowCenter.value.length;++i){var j=parseFloat(a.WindowWidth.value[i],10);0!==j&&(h=a.WindowCenterWidthExplanation?a.WindowCenterWidthExplanation.value[i]:"Default"+i,g.push({center:parseFloat(a.WindowCenter.value[i],10),width:j,name:h}))}return 0!==g.length?f.setWindowPresets(g):f.setWindowLevelMinMax(),f};var dwv=dwv||{};dwv.io=dwv.io||{},dwv.io.File=function(){var a=0,b=0;this.setNToLoad=function(b){a=b},this.addLoaded=function(){b++,b===a&&this.onloadend()}},dwv.io.File.prototype.onload=function(){},dwv.io.File.prototype.onloadend=function(){},dwv.io.File.prototype.onerror=function(){},dwv.io.File.createErrorHandler=function(a,b,c){return function(d){c({name:"RequestError",message:"An error occurred while reading the "+b+" file: "+a+" ("+d.getMessage()+")"})}},dwv.io.File.prototype.load=function(a){var b=this;this.setNToLoad(a.length);for(var c=function(a){b.onload(a),b.addLoaded()},d=function(a){try{c(dwv.image.getDataFromDicomBuffer(a.target.result))}catch(d){b.onerror(d)}var e={lengthComputable:!0,loaded:1,total:1};dwv.gui.updateProgress(e)},e=function(){try{c(dwv.image.getDataFromImage(this))}catch(a){b.onerror(a)}},f=function(a){try{c(a.target.result)}catch(d){b.onerror(d)}},g=function(a){var b=new Image;b.src=a.target.result,b.file=this.file,b.index=this.index,b.onload=e},h=0;h<a.length;++h){var i=a[h],j=new FileReader;"json"===i.name.split(".").pop().toLowerCase()?(j.onload=f,j.onprogress=dwv.gui.updateProgress,j.onerror=dwv.io.File.createErrorHandler(i,"text",b.onerror),j.readAsText(i)):i.type.match("image.*")?(j.file=i,j.index=h,j.onload=g,j.onprogress=dwv.gui.updateProgress,j.onerror=dwv.io.File.createErrorHandler(i,"image",b.onerror),j.readAsDataURL(i)):(j.onload=d,j.onprogress=dwv.gui.updateProgress,j.onerror=dwv.io.File.createErrorHandler(i,"DICOM",b.onerror),j.readAsArrayBuffer(i))}};var dwv=dwv||{};dwv.io=dwv.io||{},dwv.io.Url=function(){var a=0,b=0;this.setNToLoad=function(b){a=b},this.addLoaded=function(){b++,b===a&&this.onloadend()}},dwv.io.Url.prototype.onload=function(){},dwv.io.Url.prototype.onloadend=function(){},dwv.io.Url.prototype.onerror=function(){},dwv.io.Url.createErrorHandler=function(a,b,c){return function(){c({name:"RequestError",message:"An error occurred while retrieving the "+b+" file (via http): "+a+" (status: "+this.status+")"})}},dwv.io.Url.prototype.load=function(a){var b=this;this.setNToLoad(a.length);for(var c=function(a){b.onload(a),b.addLoaded()},d=function(a){try{c(dwv.image.getDataFromDicomBuffer(a))}catch(d){b.onerror(d)}},e=function(){try{c(dwv.image.getDataFromImage(this))}catch(a){b.onerror(a)}},f=function(){try{c(this.responseText)}catch(a){b.onerror(a)}},g=function(){var a=new DataView(this.response),b=4292411360===a.getUint32(0),c=2303741511===a.getUint32(0),f=1195984440===a.getUint32(0);if(!b&&!c&&!f&&this.responseURL){var g=this.responseURL.split(".").pop().toLowerCase();b="jpg"===g||"jpeg"===g,c="png"===g,f="gif"===g}if(b||c||f){for(var h=new Uint8Array(this.response),i="",j=0;j<h.byteLength;++j)i+=String.fromCharCode(h[j]);var k="unknown";b?k="jpeg":c?k="png":f&&(k="gif");var l=new Image;l.src="data:image/"+k+";base64,"+window.btoa(i),l.onload=e}else d(this.response)},h=0;h<a.length;++h){var i=a[h],j="json"===i.split(".").pop().toLowerCase(),k=new XMLHttpRequest;k.open("GET",i,!0),j?(k.onload=f,k.onerror=dwv.io.Url.createErrorHandler(i,"text",b.onerror)):(k.responseType="arraybuffer",k.onload=g,k.onerror=dwv.io.Url.createErrorHandler(i,"binary",b.onerror)),k.onprogress=dwv.gui.updateProgress,k.send(null)}};var dwv=dwv||{};dwv.math=dwv.math||{},dwv.math.BucketQueue=function(a,b){this.bucketCount=1<<a,this.mask=this.bucketCount-1,this.size=0,this.loc=0,this.cost="undefined"!=typeof b?b:function(a){return a},this.buckets=this.buildArray(this.bucketCount)},dwv.math.BucketQueue.prototype.push=function(a){var b=this.getBucket(a);a.next=this.buckets[b],this.buckets[b]=a,this.size++},dwv.math.BucketQueue.prototype.pop=function(){if(0===this.size)throw new Error("Cannot pop, bucketQueue is empty.");for(;null===this.buckets[this.loc];)this.loc=(this.loc+1)%this.bucketCount;var a=this.buckets[this.loc];return this.buckets[this.loc]=a.next,a.next=null,this.size--,a},dwv.math.BucketQueue.prototype.remove=function(a){if(!a)return!1;for(var b=this.getBucket(a),c=this.buckets[b];null!==c&&!a.equals(c.next);)c=c.next;return null===c?!1:(c.next=c.next.next,this.size--,!0)},dwv.math.BucketQueue.prototype.isEmpty=function(){return 0===this.size},dwv.math.BucketQueue.prototype.getBucket=function(a){return this.cost(a)&this.mask},dwv.math.BucketQueue.prototype.buildArray=function(a){for(var b=new Array(a),c=0;c<b.length;c++)b[c]=null;return b};var dwv=dwv||{};dwv.math=dwv.math||{},dwv.math.Point2D=function(a,b){this.getX=function(){return a},this.getY=function(){return b}},dwv.math.Point2D.prototype.equals=function(a){return null!==a&&this.getX()===a.getX()&&this.getY()===a.getY()},dwv.math.Point2D.prototype.toString=function(){return"("+this.getX()+", "+this.getY()+")"},dwv.math.FastPoint2D=function(a,b){this.x=a,this.y=b},dwv.math.FastPoint2D.prototype.equals=function(a){return null!==a&&this.x===a.x&&this.y===a.y},dwv.math.FastPoint2D.prototype.toString=function(){return"("+this.x+", "+this.y+")"},dwv.math.Point3D=function(a,b,c){this.getX=function(){return a},this.getY=function(){return b},this.getZ=function(){return c}},dwv.math.Point3D.prototype.equals=function(a){return null!==a&&this.getX()===a.getX()&&this.getY()===a.getY()&&this.getZ()===a.getZ()},dwv.math.Point3D.prototype.toString=function(){return"("+this.getX()+", "+this.getY()+", "+this.getZ()+")"},dwv.math.Index3D=function(a,b,c){this.getI=function(){return a},this.getJ=function(){return b},this.getK=function(){return c}},dwv.math.Index3D.prototype.equals=function(a){return null!==a&&this.getI()===a.getI()&&this.getJ()===a.getJ()&&this.getK()===a.getK()},dwv.math.Index3D.prototype.toString=function(){return"("+this.getI()+", "+this.getJ()+", "+this.getK()+")"};var dwv=dwv||{};dwv.math=dwv.math||{};var __twothirdpi=2/(3*Math.PI);dwv.math.computeGreyscale=function(a,b,c){for(var d=[],e=0;c>e;e++){d[e]=[];for(var f=0;b>f;f++){var g=4*(e*b+f);d[e][f]=(a[g]+a[g+1]+a[g+2])/765}}return d.dx=function(a,b){return a+1===this[b].length&&a--,this[b][a+1]-this[b][a]},d.dy=function(a,b){return b+1===this.length&&b--,this[b][a]-this[b+1][a]},d.gradMagnitude=function(a,b){var c=this.dx(a,b),d=this.dy(a,b);return Math.sqrt(c*c+d*d)},d.laplace=function(a,b){var c=-16*this[b][a];return c+=this[b-2][a],c+=this[b-1][a-1]+2*this[b-1][a]+this[b-1][a+1],c+=this[b][a-2]+2*this[b][a-1]+2*this[b][a+1]+this[b][a+2],c+=this[b+1][a-1]+2*this[b+1][a]+this[b+1][a+1],c+=this[b+2][a]},d},dwv.math.computeGradient=function(a){var b=[],c=0,d=0,e=0;for(e=0;e<a.length-1;e++){for(b[e]=[],d=0;d<a[e].length-1;d++)b[e][d]=a.gradMagnitude(d,e),c=Math.max(b[e][d],c);b[e][a[e].length-1]=b[e][a.length-2]}b[a.length-1]=[];for(var f=0;f<b[0].length;f++)b[a.length-1][f]=b[a.length-2][f];for(e=0;e<b.length;e++)for(d=0;d<b[e].length;d++)b[e][d]=1-b[e][d]/c;return b},dwv.math.computeLaplace=function(a){var b=[];b[0]=[],b[1]=[];for(var c=1;c<a.length;c++)b[0][c]=1,b[1][c]=1;for(var d=2;d<a.length-2;d++){b[d]=[],b[d][0]=1,b[d][1]=1;for(var e=2;e<a[d].length-2;e++)b[d][e]=a.laplace(e,d)>.33?0:1;b[d][a[d].length-2]=1,b[d][a[d].length-1]=1}b[a.length-2]=[],b[a.length-1]=[];for(var f=1;f<a.length;f++)b[a.length-2][f]=1,b[a.length-1][f]=1;return b},dwv.math.computeGradX=function(a){for(var b=[],c=0;c<a.length;c++){b[c]=[];for(var d=0;d<a[c].length-1;d++)b[c][d]=a.dx(d,c);b[c][a[c].length-1]=b[c][a[c].length-2]}return b},dwv.math.computeGradY=function(a){for(var b=[],c=0;c<a.length-1;c++){b[c]=[];for(var d=0;d<a[c].length;d++)b[c][d]=a.dy(d,c)}b[a.length-1]=[];for(var e=0;e<a[0].length;e++)b[a.length-1][e]=b[a.length-2][e];return b},dwv.math.gradUnitVector=function(a,b,c,d,e){var f=a[d][c],g=b[d][c],h=Math.sqrt(f*f+g*g);h=Math.max(h,1e-100),e.x=f/h,e.y=g/h},dwv.math.gradDirection=function(a,b,c,d,e,f){var g=new dwv.math.FastPoint2D(-1,-1),h=new dwv.math.FastPoint2D(-1,-1);dwv.math.gradUnitVector(a,b,c,d,g),dwv.math.gradUnitVector(a,b,e,f,h);var i=g.y*(e-c)-g.x*(f-d),j=h.y*(e-c)-h.x*(f-d);return 0>i&&(i=-i,j=-j),c!==e&&d!==f&&(i*=Math.SQRT1_2,j*=Math.SQRT1_2),__twothirdpi*(Math.acos(i)+Math.acos(j))},dwv.math.computeSides=function(a,b,c,d){var e={};e.inside=[],e.outside=[];for(var f=new dwv.math.FastPoint2D(-1,-1),g=0;g<b.length;g++){e.inside[g]=[],e.outside[g]=[];for(var h=0;h<b[g].length;h++){dwv.math.gradUnitVector(b,c,h,g,f);var i=Math.round(h+a*f.y),j=Math.round(g-a*f.x),k=Math.round(h-a*f.y),l=Math.round(g+a*f.x);i=Math.max(Math.min(i,b[g].length-1),0),k=Math.max(Math.min(k,b[g].length-1),0),j=Math.max(Math.min(j,b.length-1),0),l=Math.max(Math.min(l,b.length-1),0),e.inside[g][h]=d[j][i],e.outside[g][h]=d[l][k]}}return e},dwv.math.gaussianBlur=function(a,b){b[0]=.4*a[0]+.5*a[1]+.1*a[1],b[1]=.25*a[0]+.4*a[1]+.25*a[2]+.1*a[3];for(var c=2;c<a.length-2;c++)b[c]=.05*a[c-2]+.25*a[c-1]+.4*a[c]+.25*a[c+1]+.05*a[c+2];var d=a.length;b[d-2]=.25*a[d-1]+.4*a[d-2]+.25*a[d-3]+.1*a[d-4],b[d-1]=.4*a[d-1]+.5*a[d-2]+.1*a[d-3]},dwv.math.Scissors=function(){this.width=-1,this.height=-1,this.curPoint=null,this.searchGranBits=8,this.searchGran=1<<this.earchGranBits,this.pointsPerPost=500,this.greyscale=null,this.laplace=null,this.gradient=null,this.gradX=null,this.gradY=null,this.parents=null,this.working=!1,this.trained=!1,this.trainingPoints=null,this.edgeWidth=2,this.trainingLength=32,this.edgeGran=256,this.edgeTraining=null,this.gradPointsNeeded=32,this.gradGran=1024,this.gradTraining=null,this.insideGran=256,this.insideTraining=null,this.outsideGran=256,this.outsideTraining=null},dwv.math.Scissors.prototype.getTrainingIdx=function(a,b){return Math.round((a-1)*b)},dwv.math.Scissors.prototype.getTrainedEdge=function(a){return this.edgeTraining[this.getTrainingIdx(this.edgeGran,a)]},dwv.math.Scissors.prototype.getTrainedGrad=function(a){return this.gradTraining[this.getTrainingIdx(this.gradGran,a)]},dwv.math.Scissors.prototype.getTrainedInside=function(a){return this.insideTraining[this.getTrainingIdx(this.insideGran,a)]},dwv.math.Scissors.prototype.getTrainedOutside=function(a){return this.outsideTraining[this.getTrainingIdx(this.outsideGran,a)]},dwv.math.Scissors.prototype.setWorking=function(a){this.working=a},dwv.math.Scissors.prototype.setDimensions=function(a,b){this.width=a,this.height=b},dwv.math.Scissors.prototype.setData=function(a){if(-1===this.width||-1===this.height)throw new Error("Dimensions have not been set.");this.greyscale=dwv.math.computeGreyscale(a,this.width,this.height),this.laplace=dwv.math.computeLaplace(this.greyscale),this.gradient=dwv.math.computeGradient(this.greyscale),this.gradX=dwv.math.computeGradX(this.greyscale),this.gradY=dwv.math.computeGradY(this.greyscale);var b=dwv.math.computeSides(this.edgeWidth,this.gradX,this.gradY,this.greyscale);this.inside=b.inside,this.outside=b.outside,this.edgeTraining=[],this.gradTraining=[],this.insideTraining=[],this.outsideTraining=[]},dwv.math.Scissors.prototype.findTrainingPoints=function(a){var b=[];if(null!==this.parents)for(var c=0;c<this.trainingLength&&a;c++)b.push(a),a=this.parents[a.y][a.x];return b},dwv.math.Scissors.prototype.resetTraining=function(){this.trained=!1},dwv.math.Scissors.prototype.doTraining=function(a){if(this.trainingPoints=this.findTrainingPoints(a),!(this.trainingPoints.length<8)){var b=[];this.calculateTraining(b,this.edgeGran,this.greyscale,this.edgeTraining),this.calculateTraining(b,this.gradGran,this.gradient,this.gradTraining),this.calculateTraining(b,this.insideGran,this.inside,this.insideTraining),this.calculateTraining(b,this.outsideGran,this.outside,this.outsideTraining),this.trainingPoints.length<this.gradPointsNeeded&&this.addInStaticGrad(this.trainingPoints.length,this.gradPointsNeeded),this.trained=!0}},dwv.math.Scissors.prototype.calculateTraining=function(a,b,c,d){var e=0;for(a.length=b,e=0;b>e;e++)a[e]=0;var f=1;for(e=0;e<this.trainingPoints.length;e++){var g=this.trainingPoints[e],h=this.getTrainingIdx(b,c[g.y][g.x]);a[h]+=1,f=Math.max(f,a[h])}for(e=0;b>e;e++)a[e]=1-a[e]/f;dwv.math.gaussianBlur(a,d)},dwv.math.Scissors.prototype.addInStaticGrad=function(a,b){for(var c=0;c<this.gradGran;c++)this.gradTraining[c]=Math.min(this.gradTraining[c],1-c*(b-a)/(b*this.gradGran))},dwv.math.Scissors.prototype.gradDirection=function(a,b,c,d){return dwv.math.gradDirection(this.gradX,this.gradY,a,b,c,d)},dwv.math.Scissors.prototype.dist=function(a,b,c,d){var e=this.gradient[d][c];(a===c||b===d)&&(e*=Math.SQRT1_2);var f=this.laplace[d][c],g=this.gradDirection(a,b,c,d);if(this.trained){var h=this.getTrainedGrad(e),i=this.getTrainedEdge(this.greyscale[b][a]),j=this.getTrainedInside(this.inside[b][a]),k=this.getTrainedOutside(this.outside[b][a]);return.3*h+.3*f+.1*(g+i+j+k)}return.43*e+.43*f+.11*g},dwv.math.Scissors.prototype.adj=function(a){for(var b=[],c=Math.max(a.x-1,0),d=Math.max(a.y-1,0),e=Math.min(a.x+1,this.greyscale[0].length-1),f=Math.min(a.y+1,this.greyscale.length-1),g=0,h=d;f>=h;h++)for(var i=c;e>=i;i++)(i!==a.x||h!==a.y)&&(b[g++]=new dwv.math.FastPoint2D(i,h));return b},dwv.math.Scissors.prototype.setPoint=function(a){this.setWorking(!0),this.curPoint=a;var b=0,c=0;for(this.visited=[],c=0;c<this.height;c++)for(this.visited[c]=[],b=0;b<this.width;b++)this.visited[c][b]=!1;for(this.parents=[],c=0;c<this.height;c++)this.parents[c]=[];for(this.cost=[],c=0;c<this.height;c++)for(this.cost[c]=[],b=0;b<this.width;b++)this.cost[c][b]=Number.MAX_VALUE;
this.pq=new dwv.math.BucketQueue(this.searchGranBits,function(a){return Math.round(this.searchGran*this.costArr[a.y][a.x])}),this.pq.searchGran=this.searchGran,this.pq.costArr=this.cost,this.pq.push(a),this.cost[a.y][a.x]=0},dwv.math.Scissors.prototype.doWork=function(){if(this.working){this.timeout=null;for(var a=0,b=[];!this.pq.isEmpty()&&a<this.pointsPerPost;){var c=this.pq.pop();b.push(c),b.push(this.parents[c.y][c.x]),this.visited[c.y][c.x]=!0;for(var d=this.adj(c),e=0;e<d.length;e++){var f=d[e],g=this.cost[c.y][c.x]+this.dist(c.x,c.y,f.x,f.y);g<this.cost[f.y][f.x]&&(this.cost[f.y][f.x]!==Number.MAX_VALUE&&this.pq.remove(f),this.cost[f.y][f.x]=g,this.parents[f.y][f.x]=c,this.pq.push(f))}a++}return b}};var dwv=dwv||{};dwv.math=dwv.math||{},dwv.math.Circle=function(a,b){var c=Math.PI*b*b;this.getCenter=function(){return a},this.getRadius=function(){return b},this.getSurface=function(){return c},this.getWorldSurface=function(a,b){return c*a*b}},dwv.math.Ellipse=function(a,b,c){var d=Math.PI*b*c;this.getCenter=function(){return a},this.getA=function(){return b},this.getB=function(){return c},this.getSurface=function(){return d},this.getWorldSurface=function(a,b){return d*a*b}},dwv.math.Line=function(a,b){var c=b.getX()-a.getX(),d=b.getY()-a.getY(),e=Math.sqrt(c*c+d*d);this.getBegin=function(){return a},this.getEnd=function(){return b},this.getDeltaX=function(){return c},this.getDeltaY=function(){return d},this.getLength=function(){return e},this.getWorldLength=function(a,b){var e=c*a,f=d*b;return Math.sqrt(e*e+f*f)},this.getMidpoint=function(){return new dwv.math.Point2D(parseInt((a.getX()+b.getX())/2,10),parseInt((a.getY()+b.getY())/2,10))},this.getSlope=function(){return d/c},this.getInclination=function(){var a=180*Math.atan2(d,c)/Math.PI;return 180-a}},dwv.math.getAngle=function(a,b){var c=a.getDeltaX(),d=a.getDeltaY(),e=b.getDeltaX(),f=b.getDeltaY(),g=c*e+d*f,h=c*f-d*e,i=180*Math.atan2(h,g)/Math.PI;return 360-(180-i)},dwv.math.Rectangle=function(a,b){if(b.getX()<a.getX()){var c=a.getX();a=new dwv.math.Point2D(b.getX(),a.getY()),b=new dwv.math.Point2D(c,b.getY())}if(b.getY()<a.getY()){var d=a.getY();a=new dwv.math.Point2D(a.getX(),b.getY()),b=new dwv.math.Point2D(b.getX(),d)}var e=Math.abs(b.getX()-a.getX())*Math.abs(b.getY()-a.getY());this.getBegin=function(){return a},this.getEnd=function(){return b},this.getRealWidth=function(){return b.getX()-a.getX()},this.getRealHeight=function(){return b.getY()-a.getY()},this.getWidth=function(){return Math.abs(this.getRealWidth())},this.getHeight=function(){return Math.abs(this.getRealHeight())},this.getSurface=function(){return e},this.getWorldSurface=function(a,b){return e*a*b}},dwv.math.ROI=function(){var a=[];this.getPoint=function(b){return a[b]},this.getLength=function(){return a.length},this.addPoint=function(b){a.push(b)},this.addPoints=function(b){a=a.concat(b)}},dwv.math.Path=function(a,b){this.pointArray=a?a.slice():[],this.controlPointIndexArray=b?b.slice():[]},dwv.math.Path.prototype.getPoint=function(a){return this.pointArray[a]},dwv.math.Path.prototype.isControlPoint=function(a){var b=this.pointArray.indexOf(a);if(-1!==b)return-1!==this.controlPointIndexArray.indexOf(b);throw new Error("Error: isControlPoint called with not in list point.")},dwv.math.Path.prototype.getLength=function(){return this.pointArray.length},dwv.math.Path.prototype.addPoint=function(a){this.pointArray.push(a)},dwv.math.Path.prototype.addControlPoint=function(a){var b=this.pointArray.indexOf(a);if(-1===b)throw new Error("Error: addControlPoint called with no point in list point.");this.controlPointIndexArray.push(b)},dwv.math.Path.prototype.addPoints=function(a){this.pointArray=this.pointArray.concat(a)},dwv.math.Path.prototype.appenPath=function(a){var b=this.pointArray.length;this.pointArray=this.pointArray.concat(a.pointArray);for(var c=[],d=0;d<a.controlPointIndexArray.length;++d)c[d]=a.controlPointIndexArray[d]+b;this.controlPointIndexArray=this.controlPointIndexArray.concat(c)};var dwv=dwv||{};dwv.math=dwv.math||{},dwv.math.getStats=function(a){for(var b=a[0],c=b,d=0,e=0,f=0,g=0,h=0,i=0,j=0;j<a.length;++j)i=a[j],b>i?b=i:i>c&&(c=i),e+=i,f+=i*i;return d=e/a.length,h=f/a.length-d*d,g=Math.sqrt(h),{min:b,max:c,mean:d,stdDev:g}},dwv.math.IdGenerator=function(){var a=Math.floor(26*Math.random())+Date.now();this.get=function(){return a++}};var dwv=dwv||{};dwv.tool=dwv.tool||{};var Kinetic=Kinetic||{};dwv.tool.DrawGroupCommand=function(a,b,c){this.getName=function(){return"Draw-"+b},this.execute=function(){c.add(a),c.draw(),this.onExecute({type:"draw-create",id:a.id})},this.undo=function(){a.remove(),c.draw(),this.onUndo({type:"draw-delete",id:a.id})}},dwv.tool.DrawGroupCommand.prototype.onExecute=function(){},dwv.tool.DrawGroupCommand.prototype.onUndo=function(){},dwv.tool.MoveGroupCommand=function(a,b,c,d){this.getName=function(){return"Move-"+b},this.execute=function(){a.getChildren().each(function(a){a.x(a.x()+c.x),a.y(a.y()+c.y)}),d.draw(),this.onExecute({type:"draw-move",id:a.id})},this.undo=function(){a.getChildren().each(function(a){a.x(a.x()-c.x),a.y(a.y()-c.y)}),d.draw(),this.onUndo({type:"draw-move",id:a.id})}},dwv.tool.MoveGroupCommand.prototype.onExecute=function(){},dwv.tool.MoveGroupCommand.prototype.onUndo=function(){},dwv.tool.ChangeGroupCommand=function(a,b,c,d,e,f){this.getName=function(){return"Change-"+a},this.execute=function(){b(d,f),e.draw(),this.onExecute({type:"draw-change"})},this.undo=function(){b(c,f),e.draw(),this.onUndo({type:"draw-change"})}},dwv.tool.ChangeGroupCommand.prototype.onExecute=function(){},dwv.tool.ChangeGroupCommand.prototype.onUndo=function(){},dwv.tool.DeleteGroupCommand=function(a,b,c){this.getName=function(){return"Delete-"+b},this.execute=function(){a.remove(),c.draw(),this.onExecute({type:"draw-delete",id:a.id})},this.undo=function(){c.add(a),c.draw(),this.onUndo({type:"draw-create",id:a.id})}},dwv.tool.DeleteGroupCommand.prototype.onExecute=function(){},dwv.tool.DeleteGroupCommand.prototype.onUndo=function(){},dwv.tool.Draw=function(a,b){function c(a){a.off("mouseover"),a.off("mouseout"),a.draggable(!1),a.off("dragstart"),a.off("dragmove"),a.off("dragend")}function d(b){var c=a.getDrawStage();return{x:c.offset().x+b.x/c.scale().x,y:c.offset().y+b.y/c.scale().y}}function e(a){if("undefined"!=typeof q[a.type])for(var b=0;b<q[a.type].length;++b)q[a.type][b](a)}var f=this,g=null,h=!1;this.shapeFactoryList=b;var i=null,j=null;this.shapeName=0;var k=[],l=null,m=new dwv.tool.ShapeEditor(a);m.setDrawEventCallback(e);var n=new Kinetic.Group,o=new Kinetic.Line({points:[-10,-10,10,10],stroke:"red"}),p=new Kinetic.Line({points:[10,-10,-10,10],stroke:"red"});n.add(o),n.add(p);var q={},r=null,s=new dwv.math.IdGenerator;this.mousedown=function(b){var c=a.getDrawStage(),d=c.getIntersection({x:b._xs,y:b._ys});if(d){var e=d.getParent(),f=e.find(".shape")[0];f&&f!==m.getShape()&&(m.disable(),m.setShape(f),m.setImage(a.getImage()),m.enable())}else m.disable(),m.setShape(null),m.setImage(null),h=!0,k=[],l=new dwv.math.Point2D(b._x,b._y),k.push(l)},this.mousemove=function(b){if(h&&(Math.abs(b._x-l.getX())>0||Math.abs(b._y-l.getY())>0)){l=new dwv.math.Point2D(b._x,b._y),1!=k.length&&k.pop(),k.push(l);var c=new f.shapeFactoryList[f.shapeName];k.length<c.getNPoints()&&(clearTimeout(this.timer),this.timer=setTimeout(function(){k.push(l)},c.getTimeout())),j&&j.destroy(),j=c.create(k,a.getStyle(),a.getImage());var d=j.getChildren(function(a){return"shape"===a.name()})[0];d.listening(!1),r.hitGraphEnabled(!1),i=new dwv.tool.DrawGroupCommand(j,f.shapeName,r),i.execute()}},this.mouseup=function(){if(h&&k.length>1){j&&j.destroy();var b=new f.shapeFactoryList[f.shapeName],c=b.create(k,a.getStyle(),a.getImage());c.id(s.get()),r.hitGraphEnabled(!0),i=new dwv.tool.DrawGroupCommand(c,f.shapeName,r),i.onExecute=e,i.onUndo=e,i.execute(),a.getUndoStack().add(i);var d=c.getChildren(function(a){return"shape"===a.name()})[0];f.setShapeOn(d)}h=!1},this.mouseout=function(a){f.mouseup(a)},this.touchstart=function(a){f.mousedown(a)},this.touchmove=function(a){f.mousemove(a)},this.touchend=function(a){f.mouseup(a)},this.keydown=function(b){a.onKeydown(b)},this.setup=function(){g=new dwv.gui.Draw(a),g.setup(this.shapeFactoryList)},this.display=function(b){g&&g.display(b),m.disable(),m.setShape(null),m.setImage(null),document.body.style.cursor="default",a.getDrawStage().listening(b),r=a.getDrawLayer(),r.listening(b),r.hitGraphEnabled(b);for(var d=r.getChildren(),e=[],h=function(a){return"shape"===a.name()},i=0;i<d.length;++i)e.push(d[i].getChildren(h)[0]);b?(a.addLayerListeners(a.getDrawStage().getContent()),e.forEach(function(a){f.setShapeOn(a)})):(a.removeLayerListeners(a.getDrawStage().getContent()),e.forEach(function(a){c(a)})),r.draw()},this.setShapeOn=function(b){b.on("mouseover",function(){document.body.style.cursor="pointer"}),b.on("mouseout",function(){document.body.style.cursor="default"}),b.draggable(!0);var c=null,f=null,g="shape";b instanceof Kinetic.Line?g=4==b.points().length?"line":6==b.points().length?"protractor":"roi":b instanceof Kinetic.Rect?g="rectangle":b instanceof Kinetic.Ellipse&&(g="ellipse");var h=b.stroke();b.on("dragstart",function(b){var e=dwv.html.getEventOffset(b.evt)[0];c=d(e);var f=a.getDrawStage(),g=f.scale(),h={x:1/g.x,y:1/g.y};n.x(f.offset().x+256/g.x),n.y(f.offset().y+20/g.y),n.scale(h),r.add(n),m.setAnchorsActive(!1),r.draw()}),b.on("dragmove",function(a){var e,g=dwv.html.getEventOffset(a.evt)[0],i=d(g);e=f?{x:i.x-f.x,y:i.y-f.y}:{x:i.x-c.x,y:i.y-c.y},f=i,Math.abs(i.x-n.x())<10&&Math.abs(i.y-n.y())<10?(n.getChildren().each(function(a){a.stroke("orange")}),b.stroke("red")):(n.getChildren().each(function(a){a.stroke("red")}),b.stroke(h));var j=this.getParent();j.getChildren().each(function(a){a!==this&&(a.x(a.x()+e.x),a.y(a.y()+e.y))}),m.resetAnchors(),r.draw()}),b.on("dragend",function(){var d=f;if(f=null,Math.abs(d.x-n.x())<10&&Math.abs(d.y-n.y())<10){var i={x:d.x-c.x,y:d.y-c.y},j=this.getParent();j.getChildren().each(function(a){a.x(a.x()-i.x),a.y(a.y()-i.y)}),b.stroke(h),m.disable(),m.setShape(null),m.setImage(null),document.body.style.cursor="default";var k=new dwv.tool.DeleteGroupCommand(this.getParent(),g,r);k.onExecute=e,k.onUndo=e,k.execute(),a.getUndoStack().add(k)}else{var l={x:d.x-c.x,y:d.y-c.y};if(0!==l.x||0!==l.y){var o=new dwv.tool.MoveGroupCommand(this.getParent(),g,l,r);o.onExecute=e,o.onUndo=e,a.getUndoStack().add(o),e({type:"draw-move"})}m.setAnchorsActive(!0),m.resetAnchors()}n.remove(),r.draw()})},this.init=function(){var a=0;for(var b in this.shapeFactoryList){a=b;break}return this.setShapeName(a),g&&(this.setLineColour(g.getColours()[0]),g.initialise()),!0},this.addEventListener=function(a,b){"undefined"==typeof q[a]&&(q[a]=[]),q[a].push(b)},this.removeEventListener=function(a,b){if("undefined"!=typeof q[a])for(var c=0;c<q[a].length;++c)q[a][c]===b&&q[a].splice(c,1)},this.setLineColour=function(b){a.getStyle().setLineColour(b)}},dwv.tool.Draw.prototype.getHelp=function(){return{title:"Draw",brief:"Allows to draw shapes on the image. Choose the shape and its colour from the drop down menus. Once created, shapes can be edited by selecting them. Anchors will appear and allow specific shape edition. Drag the shape on the top red cross to delete it. All actions are undoable. ",mouse:{mouse_drag:"A single mouse drag draws the desired shape."},touch:{touch_drag:"A single touch drag draws the desired shape."}}},dwv.tool.Draw.prototype.setShapeName=function(a){if(!this.hasShape(a))throw new Error("Unknown shape: '"+a+"'");this.shapeName=a},dwv.tool.Draw.prototype.hasShape=function(a){return this.shapeFactoryList[a]};var dwv=dwv||{};dwv.tool=dwv.tool||{};var Kinetic=Kinetic||{};dwv.tool.ShapeEditor=function(a){function b(a){if(j&&j.getParent()){var b=j.getParent().find(".anchor");b.each(a)}}function c(a){b(function(b){b.visible(a)})}function d(){b(function(a){a.remove()})}function e(){if(j&&j.getLayer()){var a=j.getParent();if(j instanceof Kinetic.Line){var b=j.points();if(4===b.length||6===b.length){var c=b[0]+j.x(),d=b[1]+j.y(),e=b[2]+j.x(),g=b[3]+j.y();if(f(a,c,d,"begin"),4===b.length)m=dwv.tool.UpdateLine,f(a,e,g,"end");else{m=dwv.tool.UpdateProtractor,f(a,e,g,"mid");var h=b[4]+j.x(),i=b[5]+j.y();f(a,h,i,"end")}}else{m=dwv.tool.UpdateRoi;for(var k=0,l=0,n=0;n<b.length;n+=2)k=b[n]+j.x(),l=b[n+1]+j.y(),f(a,k,l,n)}}else if(j instanceof Kinetic.Rect){m=dwv.tool.UpdateRect;var o=j.x(),p=j.y(),q=j.width(),r=j.height();f(a,o,p,"topLeft"),f(a,o+q,p,"topRight"),f(a,o+q,p+r,"bottomRight"),f(a,o,p+r,"bottomLeft")}else if(j instanceof Kinetic.Ellipse){m=dwv.tool.UpdateEllipse;var s=j.x(),t=j.y(),u=j.radius();f(a,s-u.x,t-u.y,"topLeft"),f(a,s+u.x,t-u.y,"topRight"),f(a,s+u.x,t+u.y,"bottomRight"),f(a,s-u.x,t+u.y,"bottomLeft")}j.getLayer().add(a)}}function f(b,c,d,e){var f=new Kinetic.Circle({x:c,y:d,stroke:"#999",fillRed:100,fillBlue:100,fillGreen:100,fillAlpha:.7,strokeWidth:a.getStyle().getScaledStrokeWidth(),radius:a.getStyle().scale(6),name:"anchor",id:e,dragOnTop:!1,draggable:!0,visible:!1});h(f),b.add(f)}function g(a){var b=a.getParent(),c=a.id(),d=a.x(),e=a.y(),f={};return f.getParent=function(){return b},f.id=function(){return c},f.x=function(){return d},f.y=function(){return e},f}function h(b){var c=null,d="shape";j instanceof Kinetic.Line?d=4==j.points().length?"line":6==j.points().length?"protractor":"roi":j instanceof Kinetic.Rect?d="rectangle":j instanceof Kinetic.Ellipse&&(d="ellipse"),b.on("dragstart",function(){c=g(this)}),b.on("dragmove",function(){m&&m(this,k),this.getLayer()?this.getLayer().draw():console.warn("No layer to draw the anchor!")}),b.on("dragend",function(){var b=g(this),e=new dwv.tool.ChangeGroupCommand(d,m,c,b,this.getLayer(),k);e.onExecute=n,e.onUndo=n,e.execute(),a.getUndoStack().add(e),c=b}),b.on("mousedown touchstart",function(){this.moveToTop()}),b.on("mouseover",function(){document.body.style.cursor="pointer",this.stroke("#ddd"),this.getLayer()?this.getLayer().draw():console.warn("No layer to draw the anchor!")}),b.on("mouseout",function(){document.body.style.cursor="default",this.stroke("#999"),this.getLayer()?this.getLayer().draw():console.warn("No layer to draw the anchor!")})}function i(a){a.off("dragstart"),a.off("dragmove"),a.off("dragend"),a.off("mousedown touchstart"),a.off("mouseover"),a.off("mouseout")}var j=null,k=null,l=!1,m=null,n=null;this.setShape=function(a){j=a,j&&(d(),e())},this.setImage=function(a){k=a},this.getShape=function(){return j},this.isActive=function(){return l},this.setDrawEventCallback=function(a){n=a},this.enable=function(){l=!0,j&&(c(!0),j.getLayer()&&j.getLayer().draw())},this.disable=function(){l=!1,j&&(c(!1),j.getLayer()&&j.getLayer().draw())},this.resetAnchors=function(){d(),e(),c(!0)},this.setAnchorsActive=function(a){var c=null;c=a?function(a){h(a)}:function(a){i(a)},b(c)}};var dwv=dwv||{};dwv.tool=dwv.tool||{};var Kinetic=Kinetic||{};dwv.tool.EllipseFactory=function(){this.getNPoints=function(){return 2},this.getTimeout=function(){return 0}},dwv.tool.EllipseFactory.prototype.create=function(a,b,c){var d=Math.abs(a[0].getX()-a[1].getX()),e=Math.abs(a[0].getY()-a[1].getY()),f=new dwv.math.Ellipse(a[0],d,e),g=new Kinetic.Ellipse({x:f.getCenter().getX(),y:f.getCenter().getY(),radius:{x:f.getA(),y:f.getB()},stroke:b.getLineColour(),strokeWidth:b.getScaledStrokeWidth(),name:"shape"}),h=c.quantifyEllipse(f),i=h.surface/100,j=i.toPrecision(4)+" cm2",k=new Kinetic.Text({x:f.getCenter().getX(),y:f.getCenter().getY(),text:j,fontSize:b.getScaledFontSize(),fontFamily:b.getFontFamily(),fill:b.getLineColour(),name:"text"}),l=new Kinetic.Group;return l.name("ellipse-group"),l.add(g),l.add(k),l},dwv.tool.UpdateEllipse=function(a,b){var c=a.getParent(),d=c.getChildren(function(a){return"shape"===a.name()})[0],e=c.getChildren(function(a){return"text"===a.name()})[0],f=c.getChildren(function(a){return"topLeft"===a.id()})[0],g=c.getChildren(function(a){return"topRight"===a.id()})[0],h=c.getChildren(function(a){return"bottomRight"===a.id()})[0],i=c.getChildren(function(a){return"bottomLeft"===a.id()})[0];switch(a.id()){case"topLeft":f.x(a.x()),f.y(a.y()),g.y(a.y()),i.x(a.x());break;case"topRight":g.x(a.x()),g.y(a.y()),f.y(a.y()),h.x(a.x());break;case"bottomRight":h.x(a.x()),h.y(a.y()),i.y(a.y()),g.x(a.x());break;case"bottomLeft":i.x(a.x()),i.y(a.y()),h.y(a.y()),f.x(a.x());break;default:console.error("Unhandled anchor id: "+a.id())}var j=(g.x()-f.x())/2,k=(h.y()-g.y())/2,l={x:f.x()+j,y:g.y()+k};d.position(l);var m={x:Math.abs(j),y:Math.abs(k)};m&&d.radius(m);var n=new dwv.math.Ellipse(l,j,k),o=b.quantifyEllipse(n),p=o.surface/100,q=p.toPrecision(4)+" cm2",r={x:l.x,y:l.y};e.position(r),e.text(q)};var dwv=dwv||{};dwv.tool=dwv.tool||{},dwv.tool.Filter=function(a,b){var c=null;this.filterList=a,this.selectedFilter=0,this.defaultFilterName=0,this.displayed=!1,this.setup=function(){if(0!==Object.keys(this.filterList).length){c=new dwv.gui.Filter(b),c.setup(this.filterList);for(var a in this.filterList)this.filterList[a].setup()}},this.display=function(a){c&&c.display(a),this.displayed=a,this.selectedFilter.display(a)},this.init=function(){for(var a in this.filterList){this.defaultFilterName=a;break}this.setSelectedFilter(this.defaultFilterName);for(a in this.filterList)this.filterList[a].init();return c&&c.initialise(),!0},this.keydown=function(a){b.onKeydown(a)}},dwv.tool.Filter.prototype.getHelp=function(){return{title:"Filter",brief:"A few simple image filters are available: a Threshold filter to limit the image intensities between a chosen minimum and maximum, a Sharpen filter to convolute the image with a sharpen matrix, a Sobel filter to get the gradient of the image in both directions."}},dwv.tool.Filter.prototype.getSelectedFilter=function(){return this.selectedFilter},dwv.tool.Filter.prototype.setSelectedFilter=function(a){if(!this.hasFilter(a))throw new Error("Unknown filter: '"+a+"'");this.displayed&&this.selectedFilter.display(!1),this.selectedFilter=this.filterList[a],this.displayed&&this.selectedFilter.display(!0)},dwv.tool.Filter.prototype.getFilterList=function(){return this.filterList},dwv.tool.Filter.prototype.hasFilter=function(a){return this.filterList[a]},dwv.tool.filter=dwv.tool.filter||{},dwv.tool.filter.Threshold=function(a){var b=new dwv.gui.Threshold(a);this.setup=function(){b.setup()},this.display=function(a){b.display(a)},this.init=function(){b.initialise()},this.run=function(b){var c=new dwv.image.filter.Threshold;c.setMin(b.min),c.setMax(b.max);var d=new dwv.tool.RunFilterCommand(c,a);d.execute(),a.getUndoStack().add(d)}},dwv.tool.filter.Sharpen=function(a){var b=new dwv.gui.Sharpen(a);this.setup=function(){b.setup()},this.display=function(a){b.display(a)},this.init=function(){},this.run=function(){var b=new dwv.image.filter.Sharpen,c=new dwv.tool.RunFilterCommand(b,a);c.execute(),a.getUndoStack().add(c)}},dwv.tool.filter.Sobel=function(a){var b=new dwv.gui.Sobel(a);this.setup=function(){b.setup()},this.display=function(a){b.display(a)},this.init=function(){},dwv.tool.filter.Sobel.prototype.run=function(){var b=new dwv.image.filter.Sobel,c=new dwv.tool.RunFilterCommand(b,a);c.execute(),a.getUndoStack().add(c)}},dwv.tool.RunFilterCommand=function(a,b){this.getName=function(){return"Filter-"+a.getName()},this.execute=function(){a.setOriginalImage(b.getImage()),b.setImage(a.update()),b.render()},this.undo=function(){b.setImage(a.getOriginalImage()),b.render()}};var dwv=dwv||{};dwv.info=dwv.info||{},dwv.info.Windowing=function(a){this.create=function(){var b=a.getContainerDivId(),c=document.getElementById(b+"-infotr");dwv.html.removeNode(b+"-ulinfotr");var d=document.createElement("ul");d.id=b+"-ulinfotr";var e=document.createElement("li");e.id=b+"-liwcinfotr",d.appendChild(e);var f=document.createElement("li");f.id=b+"-liwwinfotr",d.appendChild(f),c.appendChild(d)},this.update=function(b){var c=a.getContainerDivId(),d=document.getElementById(c+"-liwcinfotr");dwv.html.cleanNode(d),d.appendChild(document.createTextNode("WindowCenter = "+b.wc));var e=document.getElementById(c+"-liwwinfotr");dwv.html.cleanNode(e),e.appendChild(document.createTextNode("WindowWidth = "+b.ww))}},dwv.info.Position=function(a){this.create=function(){var b=a.getContainerDivId(),c=document.getElementById(b+"-infotl");dwv.html.removeNode(b+"-ulinfotl");var d=document.createElement("ul");d.id=b+"-ulinfotl";var e=document.createElement("li");e.id=b+"-liposinfotl",d.appendChild(e);var f=document.createElement("li");f.id=b+"-livalueinfotl",d.appendChild(f),c.appendChild(d)},this.update=function(b){var c=a.getContainerDivId(),d=document.getElementById(c+"-liposinfotl");if(dwv.html.cleanNode(d),d.appendChild(document.createTextNode("Pos = "+b.i+", "+b.j+", "+b.k)),"undefined"!=typeof b.value){var e=document.getElementById(c+"-livalueinfotl");dwv.html.cleanNode(e),e.appendChild(document.createTextNode("Value = "+b.value))}}},dwv.info.MiniColourMap=function(a){this.create=function(){var b=a.getContainerDivId(),c=document.getElementById(b+"-infobr");dwv.html.removeNode(b+"-canvasinfobr");var d=document.createElement("canvas");d.id=b+"-canvasinfobr",d.width=98,d.height=10,c.appendChild(d)},this.update=function(b){for(var c,d=a.getContainerDivId(),e=b.wc,f=b.ww,g=document.getElementById(d+"-canvasinfobr"),h=g.getContext("2d"),i=a.getViewController().getColourMap(),j=h.getImageData(0,0,g.width,g.height),k=0,l=a.getImage().getRescaledDataRange().min,m=a.getImage().getRescaledDataRange().max-l,n=m/g.width,o=0,p=255,q=0,r=e-.5-(f-1)/2,s=e-.5+(f-1)/2,t=0;t<g.height;++t){k=l;for(var u=0;u<g.width;++u)r>=k?o=q:k>s?o=p:(o=((k-(e-.5))/(f-1)+.5)*(p-q)+q,o=parseInt(o,10)),c=4*(u+t*g.width),j.data[c]=i.red[o],j.data[c+1]=i.green[o],j.data[c+2]=i.blue[o],j.data[c+3]=255,k+=n}h.putImageData(j,0,0)}},dwv.info.Plot=function(a){this.create=function(){$.plot($("#"+a.getContainerDivId()+"-plot"),[a.getImage().getHistogram()],{bars:{show:!0},grid:{backgroundcolor:null},xaxis:{show:!0},yaxis:{show:!1}})},this.update=function(b){var c=b.wc,d=b.ww,e=parseInt((d-1)/2,10),f=parseInt(c-.5,10),g=f-e,h=f+e,i=[{color:"#faa",lineWidth:1,xaxis:{from:g,to:g}},{color:"#aaf",lineWidth:1,xaxis:{from:h,to:h}}];$.plot($("#"+a.getContainerDivId()+"-plot"),[a.getImage().getHistogram()],{bars:{show:!0},grid:{markings:i,backgroundcolour:null},xaxis:{show:!1},yaxis:{show:!1}})}};var dwv=dwv||{};dwv.tool=dwv.tool||{};var Kinetic=Kinetic||{};dwv.tool.LineFactory=function(){this.getNPoints=function(){return 2},this.getTimeout=function(){return 0}},dwv.tool.LineFactory.prototype.create=function(a,b,c){var d=new dwv.math.Line(a[0],a[1]),e=new Kinetic.Line({points:[d.getBegin().getX(),d.getBegin().getY(),d.getEnd().getX(),d.getEnd().getY()],stroke:b.getLineColour(),strokeWidth:b.getScaledStrokeWidth(),name:"shape"}),f=c.quantifyLine(d),g=f.length.toPrecision(4)+" mm",h=d.getBegin().getX()>d.getEnd().getX()?0:-1,i=d.getBegin().getY()>d.getEnd().getY()?-1:.5,j=new Kinetic.Text({x:d.getEnd().getX()+25*h,y:d.getEnd().getY()+15*i,text:g,fontSize:b.getScaledFontSize(),fontFamily:b.getFontFamily(),fill:b.getLineColour(),name:"text"}),k=new Kinetic.Group;return k.name("line-group"),k.add(e),k.add(j),k},dwv.tool.UpdateLine=function(a,b){var c=a.getParent(),d=c.getChildren(function(a){return"shape"===a.name()})[0],e=c.getChildren(function(a){return"text"===a.name()})[0],f=c.getChildren(function(a){return"begin"===a.id()})[0],g=c.getChildren(function(a){return"end"===a.id()})[0];switch(a.id()){case"begin":f.x(a.x()),f.y(a.y());break;case"end":g.x(a.x()),g.y(a.y())}var h=f.x()-d.x(),i=f.y()-d.y(),j=g.x()-d.x(),k=g.y()-d.y();d.points([h,i,j,k]);var l=new dwv.math.Point2D(f.x(),f.y()),m=new dwv.math.Point2D(g.x(),g.y()),n=new dwv.math.Line(l,m),o=b.quantifyLine(n),p=o.length.toPrecision(4)+" mm",q=n.getBegin().getX()>n.getEnd().getX()?0:-1,r=n.getBegin().getY()>n.getEnd().getY()?-1:.5,s={x:n.getEnd().getX()+25*q,y:n.getEnd().getY()+15*r};e.position(s),e.text(p)};var dwv=dwv||{};dwv.tool=dwv.tool||{};var Kinetic=Kinetic||{};dwv.tool.Livewire=function(a){function b(){for(var b=a.getImage().getGeometry().getSize().getNumberOfRows(),c=0;b>c;++c)j[c]=[]}function c(){h=new dwv.math.Path,i=new dwv.math.Path}var d=this,e=null;this.started=!1;var f=null,g=null;this.style=new dwv.html.Style;var h=new dwv.math.Path,i=new dwv.math.Path,j=[],k=5,l=new dwv.math.Scissors;this.mousedown=function(e){if(d.started)if(Math.abs(e._x-d.x0)<k&&Math.abs(e._y-d.y0)<k)d.mousemove(e),console.log("Done."),a.getUndoStack().add(f),d.started=!1;else{h=i,b();var g=new dwv.math.FastPoint2D(e._x,e._y);l.doTraining(g),h.addControlPoint(i.getPoint(0))}else{d.started=!0,d.x0=e._x,d.y0=e._y,c(),b();var j=new dwv.math.FastPoint2D(e._x,e._y);l.doTraining(j);var m=new dwv.math.Point2D(e._x,e._y);h.addPoint(m),h.addControlPoint(m)}},this.mousemove=function(b){if(d.started){var c=new dwv.math.FastPoint2D(b._x,b._y);l.setPoint(c);for(var e=0,k=!1;!j[c.y][c.x]&&!k;)if(console.log("Getting ready..."),e=l.doWork(),0===e.length)k=!0;else for(var m=0;m<e.length-1;m+=2){var n=e[m],o=e[m+1];j[n.y][n.x]=o}for(console.log("Ready!"),i=new dwv.math.Path,k=!1;c&&!k;)i.addPoint(new dwv.math.Point2D(c.x,c.y)),j[c.y]&&j[c.y][c.x]?c=j[c.y][c.x]:k=!0;i.appenPath(h),g&&g.destroy();var p=new dwv.tool.RoiFactory;g=p.create(i.pointArray,d.style),f=new dwv.tool.DrawGroupCommand(g,"livewire",a.getDrawLayer()),f.execute()}},this.mouseup=function(){},this.mouseout=function(a){d.mouseup(a)},this.touchstart=function(a){d.mousedown(a)},this.touchmove=function(a){d.mousemove(a)},this.touchend=function(a){d.mouseup(a)},this.keydown=function(b){a.onKeydown(b)},this.setup=function(){e=new dwv.gui.Livewire(a),e.setup()},this.display=function(a){e&&e.display(a),this.init()},this.init=function(){e&&(this.setLineColour(e.getColours()[0]),e.initialise());var b=a.getImage().getGeometry().getSize();return l.setDimensions(b.getNumberOfColumns(),b.getNumberOfRows()),l.setData(a.getImageData().data),!0}},dwv.tool.Livewire.prototype.getHelp=function(){return{title:"Livewire",brief:"The Livewire tool is a semi-automatic segmentation tool that proposes to the user paths that follow intensity edges.Click once to initialise and then move the mouse to see the proposed paths. Click again to build your contour. The process stops when you click on the first root point. BEWARE: the process can take time!"}},dwv.tool.Livewire.prototype.setLineColour=function(a){this.style.setLineColour(a)};var dwv=dwv||{};dwv.tool=dwv.tool||{};var Kinetic=Kinetic||{};dwv.tool.ProtractorFactory=function(){this.getNPoints=function(){return 3},this.getTimeout=function(){return 500}},dwv.tool.ProtractorFactory.prototype.create=function(a,b){for(var c=new dwv.math.Line(a[0],a[1]),d=[],e=0;e<a.length;++e)d.push(a[e].getX()),d.push(a[e].getY());var f=new Kinetic.Line({points:d,stroke:b.getLineColour(),strokeWidth:b.getScaledStrokeWidth(),name:"shape"}),g=new Kinetic.Group;if(g.name("protractor-group"),g.add(f),3==a.length){var h=new dwv.math.Line(a[1],a[2]),i=dwv.math.getAngle(c,h),j=c.getInclination();i>180&&(i=360-i,j+=i);var k=i.toPrecision(4)+"°",l=(c.getMidpoint().getX()+h.getMidpoint().getX())/2,m=(c.getMidpoint().getY()+h.getMidpoint().getY())/2,n=new Kinetic.Text({x:l,y:m-15,text:k,fontSize:b.getScaledFontSize(),fontFamily:b.getFontFamily(),fill:b.getLineColour(),name:"text"}),o=33*Math.min(c.getLength(),h.getLength())/100,p=new Kinetic.Arc({innerRadius:o,outerRadius:o,stroke:b.getLineColour(),strokeWidth:b.getScaledStrokeWidth(),angle:i,rotationDeg:-j,x:a[1].getX(),y:a[1].getY(),name:"arc"});g.add(n),g.add(p)}return g},dwv.tool.UpdateProtractor=function(a){var b=a.getParent(),c=b.getChildren(function(a){return"shape"===a.name()})[0],d=b.getChildren(function(a){return"text"===a.name()})[0],e=b.getChildren(function(a){return"arc"===a.name()})[0],f=b.getChildren(function(a){return"begin"===a.id()})[0],g=b.getChildren(function(a){return"mid"===a.id()})[0],h=b.getChildren(function(a){return"end"===a.id()})[0];switch(a.id()){case"begin":f.x(a.x()),f.y(a.y());break;case"mid":g.x(a.x()),g.y(a.y());break;case"end":h.x(a.x()),h.y(a.y())}var i=f.x()-c.x(),j=f.y()-c.y(),k=g.x()-c.x(),l=g.y()-c.y(),m=h.x()-c.x(),n=h.y()-c.y();c.points([i,j,k,l,m,n]);var o=new dwv.math.Point2D(f.x(),f.y()),p=new dwv.math.Point2D(g.x(),g.y()),q=new dwv.math.Point2D(h.x(),h.y()),r=new dwv.math.Line(o,p),s=new dwv.math.Line(p,q),t=dwv.math.getAngle(r,s),u=r.getInclination();t>180&&(t=360-t,u+=t);var v=t.toPrecision(4)+"°",w=(r.getMidpoint().getX()+s.getMidpoint().getX())/2,x=(r.getMidpoint().getY()+s.getMidpoint().getY())/2,y={x:w,y:x-15};d.position(y),d.text(v);var z=33*Math.min(r.getLength(),s.getLength())/100;e.innerRadius(z),e.outerRadius(z),e.angle(t),e.rotation(-u);var A={x:g.x(),y:g.y()};e.position(A)};var dwv=dwv||{};dwv.tool=dwv.tool||{};var Kinetic=Kinetic||{};dwv.tool.RectangleFactory=function(){this.getNPoints=function(){return 2},this.getTimeout=function(){return 0}},dwv.tool.RectangleFactory.prototype.create=function(a,b,c){var d=new dwv.math.Rectangle(a[0],a[1]),e=new Kinetic.Rect({x:d.getBegin().getX(),y:d.getBegin().getY(),width:d.getWidth(),height:d.getHeight(),stroke:b.getLineColour(),strokeWidth:b.getScaledStrokeWidth(),name:"shape"}),f=c.quantifyRect(d),g=f.surface/100,h=g.toPrecision(4)+" cm2",i=new Kinetic.Text({x:d.getBegin().getX(),y:d.getEnd().getY()+10,text:h,fontSize:b.getScaledFontSize(),fontFamily:b.getFontFamily(),fill:b.getLineColour(),name:"text"}),j=new Kinetic.Group;return j.name("rectangle-group"),j.add(e),j.add(i),j},dwv.tool.UpdateRect=function(a,b){var c=a.getParent(),d=c.getChildren(function(a){return"shape"===a.name()})[0],e=c.getChildren(function(a){return"text"===a.name()})[0],f=c.getChildren(function(a){return"topLeft"===a.id()})[0],g=c.getChildren(function(a){return"topRight"===a.id()})[0],h=c.getChildren(function(a){return"bottomRight"===a.id()})[0],i=c.getChildren(function(a){return"bottomLeft"===a.id()})[0];switch(a.id()){case"topLeft":f.x(a.x()),f.y(a.y()),g.y(a.y()),i.x(a.x());break;case"topRight":g.x(a.x()),g.y(a.y()),f.y(a.y()),h.x(a.x());break;case"bottomRight":h.x(a.x()),h.y(a.y()),i.y(a.y()),g.x(a.x());break;case"bottomLeft":i.x(a.x()),i.y(a.y()),h.y(a.y()),f.x(a.x());break;default:console.error("Unhandled anchor id: "+a.id())}d.position(f.position());var j=g.x()-f.x(),k=i.y()-f.y();j&&k&&d.size({width:j,height:k});var l=new dwv.math.Point2D(f.x(),f.y()),m=new dwv.math.Point2D(h.x(),h.y()),n=new dwv.math.Rectangle(l,m),o=b.quantifyRect(n),p=o.surface/100,q=p.toPrecision(4)+" cm2",r={x:n.getBegin().getX(),y:n.getEnd().getY()+10};e.position(r),e.text(q)};var dwv=dwv||{};dwv.tool=dwv.tool||{};var Kinetic=Kinetic||{};dwv.tool.RoiFactory=function(){this.getNPoints=function(){return 50},this.getTimeout=function(){return 100}},dwv.tool.RoiFactory.prototype.create=function(a,b){var c=new dwv.math.ROI;c.addPoints(a);for(var d=[],e=0;e<c.getLength();++e)d.push(c.getPoint(e).getX()),d.push(c.getPoint(e).getY());var f=new Kinetic.Line({points:d,stroke:b.getLineColour(),strokeWidth:b.getScaledStrokeWidth(),name:"shape",closed:!0}),g=new Kinetic.Group;return g.name("roi-group"),g.add(f),g},dwv.tool.UpdateRoi=function(a){var b=a.getParent(),c=b.getChildren(function(a){return"shape"===a.name()})[0],d=b.getChildren(function(b){return b.id()===a.id()})[0];d.x(a.x()),d.y(a.y());var e=c.points();e[a.id()]=a.x()-c.x(),e[a.id()+1]=a.y()-c.y(),c.points(e)};var dwv=dwv||{};dwv.tool=dwv.tool||{},dwv.tool.Scroll=function(a){var b=this,c=null;this.started=!1,this.mousedown=function(a){b.started=!0,b.x0=a._x,b.y0=a._y},this.mousemove=function(c){if(b.started){var d=c._y-b.y0;Math.abs(d)<15||(d>0?a.getViewController().incrementSliceNb():a.getViewController().decrementSliceNb(),b.x0=c._x,b.y0=c._y)}},this.mouseup=function(){b.started&&(b.started=!1)},this.mouseout=function(a){b.mouseup(a)},this.touchstart=function(a){b.mousedown(a)},this.touchmove=function(a){b.mousemove(a)},this.touchend=function(a){b.mouseup(a)},this.DOMMouseScroll=function(b){b.detail<0?a.getViewController().incrementSliceNb():a.getViewController().decrementSliceNb()},this.mousewheel=function(b){
b.wheelDelta>0?a.getViewController().incrementSliceNb():a.getViewController().decrementSliceNb()},this.keydown=function(b){a.onKeydown(b)},this.setup=function(){c=new dwv.gui.Scroll(a),c.setup()},this.display=function(a){c&&c.display(a)},this.init=function(){return 1===a.getNSlicesToLoad()?!1:!0}},dwv.tool.Scroll.prototype.getHelp=function(){return{title:"Scroll",brief:"The scroll tool allows to scroll through slices.",mouse:{mouse_drag:"A single vertical mouse drag changes the current slice."},touch:{touch_drag:"A single vertical touch drag changes the current slice."}}};var dwv=dwv||{};dwv.tool=dwv.tool||{},dwv.tool.Toolbox=function(a,b){var c=null,d=null,e=null;this.getToolList=function(){return a},this.getSelectedTool=function(){return d},this.setup=function(){if(0!==Object.keys(a).length){c=new dwv.gui.Toolbox(b),c.setup(a);for(var d in a)a[d].setup()}},this.display=function(b){0!==Object.keys(a).length&&c&&c.display(b)},this.init=function(){var b=Object.keys(a);if(0!==b.length){e="";var d=[],f=null;for(var g in a)f=a[g].init(),f&&""===e&&(e=g),d.push(f);this.setSelectedTool(e),c&&c.initialise(d)}},this.setSelectedTool=function(b){if(!this.hasTool(b))throw new Error("Unknown tool: '"+b+"'");d&&d.display(!1),d=a[b],d.display(!0)},this.reset=function(){d&&d.display(!1),d=null,e=null}},dwv.tool.Toolbox.prototype.hasTool=function(a){return this.getToolList()[a]};var dwv=dwv||{};dwv.tool=dwv.tool||{},dwv.tool.UndoStack=function(){var a=new dwv.gui.Undo,b=[];this.getStack=function(){return b};var c=0;this.add=function(d){b=b.slice(0,c),b.push(d),++c,a.addCommandToUndoHtml(d.getName())},this.undo=function(){c>0&&(--c,b[c].undo(),a.enableInUndoHtml(!1))},this.redo=function(){c<b.length&&(b[c].execute(),++c,a.enableInUndoHtml(!0))},this.setup=function(){a.setup()},this.initialise=function(){a.initialise()}};var dwv=dwv||{};dwv.tool=dwv.tool||{},dwv.tool.WindowLevel=function(a){var b=this,c=null;this.started=!1,this.mousedown=function(c){b.started=!0,b.x0=c._x,b.y0=c._y,a.getViewController().setCurrentPosition2D(c._x,c._y)},this.mousemove=function(c){if(b.started){var d=c._x-b.x0,e=b.y0-c._y,f=parseInt(a.getViewController().getWindowLevel().center,10)+e,g=parseInt(a.getViewController().getWindowLevel().width,10)+d;a.getViewController().setWindowLevel(f,g),b.x0=c._x,b.y0=c._y}},this.mouseup=function(){if(b.started){b.started=!1;var d=parseInt(a.getViewController().getWindowLevel().center,10),e=parseInt(a.getViewController().getWindowLevel().width,10);a.getViewController().getPresets().manual={center:d,width:e},c&&(c.initialise(),dwv.gui.setSelected("presetSelect","Manual"))}},this.mouseout=function(a){b.mouseup(a)},this.touchstart=function(a){b.mousedown(a)},this.touchmove=function(a){b.mousemove(a)},this.touchend=function(a){b.mouseup(a)},this.dblclick=function(b){a.getViewController().setWindowLevel(parseInt(a.getImage().getRescaledValue(b._x,b._y,a.getViewController().getCurrentPosition().k),10),parseInt(a.getViewController().getWindowLevel().width,10))},this.keydown=function(b){a.onKeydown(b)},this.setup=function(){c=new dwv.gui.WindowLevel(a),c.setup()},this.display=function(b){c&&(null!==a.getImage().getPhotometricInterpretation().match(/MONOCHROME/)?c.display(b):c.display(!1))},this.init=function(){return c&&c.initialise(),!0}},dwv.tool.WindowLevel.prototype.getHelp=function(){return{title:"Window/Level",brief:"Changes the Window and Level of the image.",mouse:{mouse_drag:"A single mouse drag changes the window in the horizontal direction and the level in the vertical one.",double_click:"A double click will center the window and level on the clicked intensity."},touch:{touch_drag:"A single touch drag changes the window in the horizontal direction and the level in the vertical one."}}};var dwv=dwv||{};dwv.tool=dwv.tool||{},dwv.tool.ZoomAndPan=function(a){var b=this,c=null;this.started=!1,this.mousedown=function(a){b.started=!0,b.x0=a._xs,b.y0=a._ys},this.twotouchdown=function(a){b.started=!0,b.x0=a._x,b.y0=a._y;var c=new dwv.math.Point2D(a._x,a._y),d=new dwv.math.Point2D(a._x1,a._y1);b.line0=new dwv.math.Line(c,d),b.midPoint=b.line0.getMidpoint()},this.mousemove=function(c){if(b.started){var d=c._xs-b.x0,e=c._ys-b.y0;a.stepTranslate(d,e),b.x0=c._xs,b.y0=c._ys}},this.twotouchmove=function(c){if(b.started){var d=new dwv.math.Point2D(c._x,c._y),e=new dwv.math.Point2D(c._x1,c._y1),f=new dwv.math.Line(d,e),g=f.getLength()/b.line0.getLength();if(1===g){var h=c._y-b.y0;if(Math.abs(h)<15)return;h>0?a.getViewController().incrementSliceNb():a.getViewController().decrementSliceNb()}else{var i=(g-1)/2;Math.abs(i)%.1<=.05&&a.stepZoom(i,c._xs,c._ys)}}},this.mouseup=function(){b.started&&(b.started=!1)},this.mouseout=function(a){b.mouseup(a)},this.touchstart=function(a){var c=a.targetTouches;1===c.length?b.mousedown(a):2===c.length&&b.twotouchdown(a)},this.touchmove=function(a){var c=a.targetTouches;1===c.length?b.mousemove(a):2===c.length&&b.twotouchmove(a)},this.touchend=function(a){b.mouseup(a)},this.DOMMouseScroll=function(b){var c=-b.detail/30;a.stepZoom(c,b._xs,b._ys)},this.mousewheel=function(b){var c=b.wheelDelta/1200;a.stepZoom(c,b._xs,b._ys)},this.keydown=function(b){a.onKeydown(b)},this.setup=function(){c=new dwv.gui.ZoomAndPan(a),c.setup()},this.display=function(a){c&&c.display(a)}},dwv.tool.ZoomAndPan.prototype.getHelp=function(){return{title:"Zoom/Pan",brief:"The Zoom/Pan tool allows to zoom and pan the image.",mouse:{mouse_wheel:"The mouse wheel is used to zoom the image.",mouse_drag:"A single mouse drag drags the image in the desired direction."},touch:{twotouch_pinch:"A pinch in or out allows to zoom the image.",touch_drag:"A single touch drag drags the image in the desired direction."}}},dwv.tool.ZoomAndPan.prototype.init=function(){return!0};var dwv=dwv||{};dwv.utils=dwv.utils||{},dwv.utils.capitaliseFirstLetter=function(a){var b=a;return a&&(b=a.charAt(0).toUpperCase()+a.slice(1)),b},dwv.utils.cleanString=function(a){var b=a;return a&&(b=a.trim(),b[b.length-1]===String.fromCharCode("u200B")&&(b=b.substring(0,b.length-1))),b},dwv.utils.splitQueryString=function(a){var b={},c=null;if(a&&-1!==(c=a.indexOf("?"))){b.base=a.substr(0,c);var d=a.indexOf("#");-1===d&&(d=a.length);var e=a.substr(c+1,d-1-c);b.query=dwv.utils.splitKeyValueString(e)}return b},dwv.utils.splitKeyValueString=function(a){var b={};if(a)for(var c=a.split("&"),d=0;d<c.length;++d){var e=c[d].split("=");b[e[0]]?(b[e[0]]instanceof Array||(b[e[0]]=[b[e[0]]]),b[e[0]].push(e[1])):b[e[0]]=e[1]}return b};