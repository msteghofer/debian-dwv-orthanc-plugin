cmake_minimum_required(VERSION 2.8)

project(DwvOrthancPlugin)

if (${CMAKE_COMPILER_IS_GNUCXX})
  set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wall -pedantic -Werror")
  set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -pedantic -Werror")
endif()

# Orthanc dependency
set(ORTHANC_DIR "" CACHE FILEPATH "Path of the Orthanc sources.")
if(ORTHANC_DIR STREQUAL "")
  message(FATAL_ERROR "Please set the ORTHANC_DIR variable.")
endif()
# plugin definition
include_directories(${ORTHANC_DIR}/Plugins/Include/)
# for OrthancException used in EmbedResources
include_directories(${ORTHANC_DIR}/Core/)
include_directories(${ORTHANC_DIR}/OrthancCppClient/SharedLibrary/Laaw/)

# create resources file
include(${CMAKE_SOURCE_DIR}/Resources/CMake/AutoGeneratedCode.cmake)
EmbedResources( DWV_EXPLORER ${CMAKE_CURRENT_SOURCE_DIR}/Explorer )

# create library
add_library(${PROJECT_NAME} SHARED Plugin.cpp ${AUTOGENERATED_SOURCES})

if (${CMAKE_SYSTEM_NAME} STREQUAL "Linux")
  # Linking with "pthread" is necessary, otherwise the software crashes
  # http://sourceware.org/bugzilla/show_bug.cgi?id=10652#c17
  target_link_libraries(${PROJECT_NAME} pthread dl)
endif()
